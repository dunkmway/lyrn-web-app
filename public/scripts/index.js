/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const r=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,l=r>>2,u=(3&r)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),i.push(n[l],n[u],n[h],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(s>>10)),e[i++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new i;const l=s<<2|o>>4;if(r.push(l),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]},a=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class c{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function l(){try{return"object"==typeof indexedDB}catch(t){return!1}}function u(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class h extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,h.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,d.prototype.create)}}class d{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],s=r?function(t,e){return t.replace(f,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new h(i,o,n)}}const f=/\{\$([^}]+)}/g;function p(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const n=t[r],s=e[r];if(g(n)&&g(s)){if(!p(n,s))return!1}else if(n!==s)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function g(t){return null!==t&&"object"==typeof t}const m=1e3,y=2,v=144e5,w=.5;function E(t,e=m,n=y){const i=e*Math.pow(n,t),r=Math.round(w*i*(Math.random()-.5)*2);return Math.min(v,i+r)}function b(t){return t&&t._delegate?t._delegate:t}class I{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const T="[DEFAULT]";class _{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new c;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:T})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=T){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=T){return this.instances.has(t)}getOptions(t=T){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&t(s,i),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===T?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=T){return this.component?this.component.multipleInstances?t:T:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class S{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new _(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const C=[];var A,D;(D=A||(A={}))[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";const k={debug:A.DEBUG,verbose:A.VERBOSE,info:A.INFO,warn:A.WARN,error:A.ERROR,silent:A.SILENT},N=A.INFO,O={[A.DEBUG]:"log",[A.VERBOSE]:"log",[A.INFO]:"info",[A.WARN]:"warn",[A.ERROR]:"error"},L=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),r=O[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${i}]  ${t.name}:`,...n)};class R{constructor(t){this.name=t,this._logLevel=N,this._logHandler=L,this._userLogHandler=null,C.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in A))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?k[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,A.DEBUG,...t),this._logHandler(this,A.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,A.VERBOSE,...t),this._logHandler(this,A.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,A.INFO,...t),this._logHandler(this,A.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,A.WARN,...t),this._logHandler(this,A.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,A.ERROR,...t),this._logHandler(this,A.ERROR,...t)}}const P=(t,e)=>e.some((e=>t instanceof e));let x,M;const F=new WeakMap,V=new WeakMap,U=new WeakMap,j=new WeakMap,B=new WeakMap;let $={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return V.get(t);if("objectStoreNames"===e)return t.objectStoreNames||U.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return z(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function q(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(M||(M=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(H(this),t),z(F.get(this))}:function(...t){return z(e.apply(H(this),t))}:function(t,...n){const i=e.call(H(this),t,...n);return U.set(i,t.sort?t.sort():[t]),z(i)}:(t instanceof IDBTransaction&&function(t){if(V.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));V.set(t,e)}(t),P(t,x||(x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,$):t);var e}function z(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(z(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&F.set(e,t)})).catch((()=>{})),B.set(e,t),e}(t);if(j.has(t))return j.get(t);const e=q(t);return e!==t&&(j.set(t,e),B.set(e,t)),e}const H=t=>B.get(t),K=["get","getKey","getAll","getAllKeys","count"],G=["put","add","delete","clear"],Q=new Map;function W(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Q.get(e))return Q.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=G.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!K.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return Q.set(e,s),s}var X;X=$,$={...X,get:(t,e,n)=>W(t,e)||X.get(t,e,n),has:(t,e)=>!!W(t,e)||X.has(t,e)};class J{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const Y="@firebase/app",Z="0.9.15",tt=new R("@firebase/app"),et="[DEFAULT]",nt={[Y]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},it=new Map,rt=new Map;function st(t,e){try{t.container.addComponent(e)}catch(n){tt.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ot(t){const e=t.name;if(rt.has(e))return tt.debug(`There were multiple attempts to register component ${e}.`),!1;rt.set(e,t);for(const e of it.values())st(e,t);return!0}function at(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const ct=new d("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class lt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new I("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ct.create("app-deleted",{appName:this._name})}}function ut(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:et,automaticDataCollectionEnabled:!1},e),r=i.name;if("string"!=typeof r||!r)throw ct.create("bad-app-name",{appName:String(r)});if(n||(n=a()),!n)throw ct.create("no-options");const s=it.get(r);if(s){if(p(n,s.options)&&p(i,s.config))return s;throw ct.create("duplicate-app",{appName:r})}const o=new S(r);for(const t of rt.values())o.addComponent(t);const c=new lt(n,i,o);return it.set(r,c),c}function ht(t=et){const e=it.get(t);if(!e&&t===et&&a())return ut();if(!e)throw ct.create("no-app",{appName:t});return e}function dt(t,e,n){var i;let r=null!==(i=nt[t])&&void 0!==i?i:t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${r}" with version "${e}":`];return s&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void tt.warn(t.join(" "))}ot(new I(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const ft="firebase-heartbeat-database",pt=1,gt="firebase-heartbeat-store";let mt=null;function yt(){return mt||(mt=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=z(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(z(o.result),t.oldVersion,t.newVersion,z(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(ft,pt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(gt)}}).catch((t=>{throw ct.create("idb-open",{originalErrorMessage:t.message})}))),mt}async function vt(t,e){try{const n=(await yt()).transaction(gt,"readwrite"),i=n.objectStore(gt);await i.put(e,wt(t)),await n.done}catch(t){if(t instanceof h)tt.warn(t.message);else{const e=ct.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}function wt(t){return`${t.name}!${t.options.appId}`}class Et{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new It(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=bt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=bt(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const r of t){const t=n.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),Tt(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Tt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function bt(){return(new Date).toISOString().substring(0,10)}class It{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!l()&&u().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await yt();return await e.transaction(gt).objectStore(gt).get(wt(t))}catch(t){if(t instanceof h)tt.warn(t.message);else{const e=ct.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});tt.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return vt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Tt(t){return r(JSON.stringify({version:2,heartbeats:t})).length}ot(new I("platform-logger",(t=>new J(t)),"PRIVATE")),ot(new I("heartbeat",(t=>new Et(t)),"PRIVATE")),dt(Y,Z,""),dt(Y,Z,"esm2017"),dt("fire-js",""),dt("firebase","10.1.0","app");const _t=(t,e)=>e.some((e=>t instanceof e));let St,Ct;const At=new WeakMap,Dt=new WeakMap,kt=new WeakMap,Nt=new WeakMap,Ot=new WeakMap;let Lt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Dt.get(t);if("objectStoreNames"===e)return t.objectStoreNames||kt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Pt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Rt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Ct||(Ct=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(xt(this),t),Pt(At.get(this))}:function(...t){return Pt(e.apply(xt(this),t))}:function(t,...n){const i=e.call(xt(this),t,...n);return kt.set(i,t.sort?t.sort():[t]),Pt(i)}:(t instanceof IDBTransaction&&function(t){if(Dt.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));Dt.set(t,e)}(t),_t(t,St||(St=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Lt):t);var e}function Pt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(Pt(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&At.set(e,t)})).catch((()=>{})),Ot.set(e,t),e}(t);if(Nt.has(t))return Nt.get(t);const e=Rt(t);return e!==t&&(Nt.set(t,e),Ot.set(e,t)),e}const xt=t=>Ot.get(t),Mt=["get","getKey","getAll","getAllKeys","count"],Ft=["put","add","delete","clear"],Vt=new Map;function Ut(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Vt.get(e))return Vt.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=Ft.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Mt.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return Vt.set(e,s),s}Lt=(t=>({...t,get:(e,n,i)=>Ut(e,n)||t.get(e,n,i),has:(e,n)=>!!Ut(e,n)||t.has(e,n)}))(Lt);const jt="@firebase/installations",Bt="0.6.4",$t=1e4,qt=`w:${Bt}`,zt="FIS_v2",Ht="https://firebaseinstallations.googleapis.com/v1",Kt=36e5,Gt=new d("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Qt(t){return t instanceof h&&t.code.includes("request-failed")}function Wt({projectId:t}){return`${Ht}/projects/${t}/installations`}function Xt(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function Jt(t,e){const n=(await e.json()).error;return Gt.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function Yt({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function Zt(t){const e=await t();return e.status>=500&&e.status<600?t():e}function te(t){return new Promise((e=>{setTimeout(e,t)}))}const ee=/^[cdef][\w-]{21}$/,ne="";function ie(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return ee.test(e)?e:ne}catch(t){return ne}}function re(t){return`${t.appName}!${t.appId}`}const se=new Map;function oe(t,e){const n=re(t);ae(n,e),function(t,e){const n=(!ce&&"BroadcastChannel"in self&&(ce=new BroadcastChannel("[Firebase] FID Change"),ce.onmessage=t=>{ae(t.data.key,t.data.fid)}),ce);n&&n.postMessage({key:t,fid:e}),0===se.size&&ce&&(ce.close(),ce=null)}(n,e)}function ae(t,e){const n=se.get(t);if(n)for(const t of n)t(e)}let ce=null;const le="firebase-installations-database",ue=1,he="firebase-installations-store";let de=null;function fe(){return de||(de=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=Pt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Pt(o.result),t.oldVersion,t.newVersion,Pt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}(le,ue,{upgrade:(t,e)=>{0===e&&t.createObjectStore(he)}})),de}async function pe(t,e){const n=re(t),i=(await fe()).transaction(he,"readwrite"),r=i.objectStore(he),s=await r.get(n);return await r.put(e,n),await i.done,s&&s.fid===e.fid||oe(t,e.fid),e}async function ge(t){const e=re(t),n=(await fe()).transaction(he,"readwrite");await n.objectStore(he).delete(e),await n.done}async function me(t,e){const n=re(t),i=(await fe()).transaction(he,"readwrite"),r=i.objectStore(he),s=await r.get(n),o=e(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||oe(t,o.fid),o}async function ye(t){let e;const n=await me(t.appConfig,(n=>{const i=function(t){return Ee(t||{fid:ie(),registrationStatus:0})}(n),r=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(Gt.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=Wt(t),r=Yt(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={fid:n,authVersion:zt,appId:t.appId,sdkVersion:qt},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Zt((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:Xt(t.authToken)}}throw await Jt("Create Installation",c)}(t,e);return pe(t.appConfig,n)}catch(n){throw Qt(n)&&409===n.customData.serverCode?await ge(t.appConfig):await pe(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:ve(t)}:{installationEntry:e}}(t,i);return e=r.registrationPromise,r.installationEntry}));return n.fid===ne?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function ve(t){let e=await we(t.appConfig);for(;1===e.registrationStatus;)await te(100),e=await we(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await ye(t);return n||e}return e}function we(t){return me(t,(t=>{if(!t)throw Gt.create("installation-not-found");return Ee(t)}))}function Ee(t){return 1===(e=t).registrationStatus&&e.registrationTime+$t<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function be({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${Wt(t)}/${e}/authTokens:generate`}(t,n),r=function(t,{refreshToken:e}){const n=Yt(t);return n.append("Authorization",function(t){return`${zt} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={installation:{sdkVersion:qt,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await Zt((()=>fetch(i,a)));if(c.ok)return Xt(await c.json());throw await Jt("Generate Auth Token",c)}async function Ie(t,e=!1){let n;const i=await me(t.appConfig,(i=>{if(!_e(i))throw Gt.create("not-registered");const r=i.authToken;if(!e&&(2===(s=r).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+Kt}(s)))return i;var s;if(1===r.requestStatus)return n=async function(t,e){let n=await Te(t.appConfig);for(;1===n.authToken.requestStatus;)await te(100),n=await Te(t.appConfig);const i=n.authToken;return 0===i.requestStatus?Ie(t,e):i}(t,e),i;{if(!navigator.onLine)throw Gt.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await be(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await pe(t.appConfig,i),n}catch(n){if(!Qt(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await pe(t.appConfig,n)}else await ge(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function Te(t){return me(t,(t=>{if(!_e(t))throw Gt.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+$t<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function _e(t){return void 0!==t&&2===t.registrationStatus}function Se(t){return Gt.create("missing-app-config-values",{valueName:t})}const Ce="installations";ot(new I(Ce,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Se("App Configuration");if(!t.name)throw Se("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Se(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:at(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),ot(new I("installations-internal",(t=>{const e=at(t.getProvider("app").getImmediate(),Ce).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await ye(e);return i?i.catch(console.error):Ie(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await ye(t);e&&await e}(n),(await Ie(n,e)).token}(e,t)}}),"PRIVATE")),dt(jt,Bt),dt(jt,Bt,"esm2017");const Ae="analytics",De="firebase_id",ke="origin",Ne=6e4,Oe="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Le="https://www.googletagmanager.com/gtag/js",Re=new R("@firebase/analytics"),Pe=new d("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function xe(t){if(!t.startsWith(Le)){const e=Pe.create("invalid-gtag-resource",{gtagURL:t});return Re.warn(e.message),""}return t}function Me(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Fe=30,Ve=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Ue(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function je(t,e=Ve,n){const{appId:i,apiKey:r,measurementId:s}=t.options;if(!i)throw Pe.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw Pe.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new $e;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Ne),Be({appId:i,apiKey:r,measurementId:s},o,a,e)}async function Be(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=Ve){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(n,r);t.addEventListener((()=>{clearTimeout(s),i(Pe.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return Re.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,r={method:"GET",headers:Ue(i)},s=Oe.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw Pe.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return r.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof h&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(r.deleteThrottleMetadata(o),a)return Re.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const l=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?E(n,r.intervalMillis,Fe):E(n,r.intervalMillis),u={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return r.setThrottleMetadata(o,u),Re.debug(`Calling attemptFetch again in ${l} millis`),Be(t,u,i,r)}}class $e{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let qe,ze;async function He(t,e,n,i,r,s,o){var a;const c=je(t);c.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&Re.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>Re.error(t))),e.push(c);const h=async function(){if(!l())return Re.warn(Pe.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await u()}catch(t){return Re.warn(Pe.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[d,f]=await Promise.all([c,h]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Le)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:xe}),i=document.createElement("script"),r=`${Le}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,d.measurementId),ze&&(r("consent","default",ze),ze=void 0),r("js",new Date);const p=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return p[ke]="firebase",p.update=!0,null!=f&&(p[De]=f),r("config",d.measurementId,p),qe&&(r("set",qe),qe=void 0),d.measurementId}class Ke{constructor(t){this.app=t}_delete(){return delete Ge[this.app.options.appId],Promise.resolve()}}let Ge={},Qe=[];const We={};let Xe,Je,Ye="dataLayer",Ze=!1;function tn(t,e,n){!function(){const t=[];if(function(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=Pe.create("invalid-analytics-context",{errorInfo:e});Re.warn(n.message)}}();const i=t.options.appId;if(!i)throw Pe.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw Pe.create("no-api-key");Re.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Ge[i])throw Pe.create("already-exists",{id:i});if(!Ze){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(Ye);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,r){let s=function(...t){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(t,e,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(t,e,n,i,r){try{let s=[];if(r&&r.send_to){let t=r.send_to;Array.isArray(t)||(t=[t]);const i=await Me(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),r=t&&e[t.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",i,r||{})}catch(t){Re.error(t)}}(t,e,n,i,r)}else if("config"===r){const[r,o]=s;await async function(t,e,n,i,r,s){const o=i[r];try{if(o)await e[o];else{const t=(await Me(n)).find((t=>t.measurementId===r));t&&await e[t.appId]}}catch(t){Re.error(t)}t("config",r,s)}(t,e,n,i,r,o)}else if("consent"===r){const[e]=s;t("consent","update",e)}else if("get"===r){const[e,n,i]=s;t("get",e,n,i)}else if("set"===r){const[e]=s;t("set",e)}else t(r,...s)}catch(t){Re.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[r]}}(Ge,Qe,We,Ye,"gtag");Je=t,Xe=e,Ze=!0}return Ge[i]=He(t,Qe,We,e,Xe,Ye,n),new Ke(t)}const en="@firebase/analytics",nn="0.10.0";ot(new I(Ae,((t,{options:e})=>tn(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),ot(new I("analytics-internal",(function(t){try{const e=t.getProvider(Ae).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=b(t),async function(t,e,n,i,r){if(r&&r.global)t("event",n,i);else{const r=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(Je,Ge[t.app.options.appId],e,n,i).catch((t=>Re.error(t)))}(e,t,n,i)}}catch(t){throw Pe.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),dt(en,nn),dt(en,nn,"esm2017");const rn=ut({apiKey:"AIzaSyD8GSMZzjbubQ7AGcQKIV-enpDYpz_07mo",authDomain:"lyrn-web-app.firebaseapp.com",projectId:"lyrn-web-app",storageBucket:"lyrn-web-app.appspot.com",messagingSenderId:"80732012862",appId:"1:80732012862:web:22ffb978c80a1d2a0f2c6f",measurementId:"G-F2QZT3W2CX"});!function(t=ht()){const e=at(t=b(t),Ae);e.isInitialized()?e.getImmediate():function(t,e={}){const n=at(t,Ae);if(n.isInitialized()){const t=n.getImmediate();if(p(e,n.getOptions()))return t;throw Pe.create("already-initialized")}n.initialize({options:e})}(t)}(rn),"localhost"===location.hostname||location.hostname;const sn=rn,on="type.googleapis.com/google.protobuf.Int64Value",an="type.googleapis.com/google.protobuf.UInt64Value";function cn(t,e){const n={};for(const i in t)t.hasOwnProperty(i)&&(n[i]=e(t[i]));return n}function ln(t){if(null==t)return null;if(t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&isFinite(t))return t;if(!0===t||!1===t)return t;if("[object String]"===Object.prototype.toString.call(t))return t;if(t instanceof Date)return t.toISOString();if(Array.isArray(t))return t.map((t=>ln(t)));if("function"==typeof t||"object"==typeof t)return cn(t,(t=>ln(t)));throw new Error("Data cannot be encoded in JSON: "+t)}function un(t){if(null==t)return t;if(t["@type"])switch(t["@type"]){case on:case an:{const e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e}default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map((t=>un(t))):"function"==typeof t||"object"==typeof t?cn(t,(t=>un(t))):t}const hn="functions",dn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class fn extends h{constructor(t,e,n){super(`${hn}/${t}`,e||""),this.details=n}}class pn{constructor(t,e,n){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then((t=>this.auth=t),(()=>{})),this.messaging||e.get().then((t=>this.messaging=t),(()=>{})),this.appCheck||n.get().then((t=>this.appCheck=t),(()=>{}))}async getAuthToken(){if(this.auth)try{const t=await this.auth.getToken();return null==t?void 0:t.accessToken}catch(t){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(t){return}}async getAppCheckToken(t){if(this.appCheck){const e=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(t){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(t)}}}const gn="us-central1";class mn{constructor(t,e,n,i,r=gn,s){this.app=t,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new pn(e,n,i),this.cancelAllRequests=new Promise((t=>{this.deleteService=()=>Promise.resolve(t())}));try{const t=new URL(r);this.customDomain=t.origin,this.region=gn}catch(t){this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(t){const e=this.app.options.projectId;return null!==this.emulatorOrigin?`${this.emulatorOrigin}/${e}/${this.region}/${t}`:null!==this.customDomain?`${this.customDomain}/${t}`:`https://${this.region}-${e}.cloudfunctions.net/${t}`}}function yn(t,e,n){return i=>function(t,e,n,i){const r=t._url(e);return async function(t,e,n,i){const r={data:n=ln(n)},s={},o=await t.contextProvider.getContext(i.limitedUseAppCheckTokens);o.authToken&&(s.Authorization="Bearer "+o.authToken),o.messagingToken&&(s["Firebase-Instance-ID-Token"]=o.messagingToken),null!==o.appCheckToken&&(s["X-Firebase-AppCheck"]=o.appCheckToken);const a=function(t){let e=null;return{promise:new Promise(((n,i)=>{e=setTimeout((()=>{i(new fn("deadline-exceeded","deadline-exceeded"))}),t)})),cancel:()=>{e&&clearTimeout(e)}}}(i.timeout||7e4),c=await Promise.race([vn(e,r,s,t.fetchImpl),a.promise,t.cancelAllRequests]);if(a.cancel(),!c)throw new fn("cancelled","Firebase Functions instance was deleted.");const l=function(t,e){let n,i=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),r=i;try{const t=e&&e.error;if(t){const e=t.status;if("string"==typeof e){if(!dn[e])return new fn("internal","internal");i=dn[e],r=e}const s=t.message;"string"==typeof s&&(r=s),n=t.details,void 0!==n&&(n=un(n))}}catch(t){}return"ok"===i?null:new fn(i,r,n)}(c.status,c.json);if(l)throw l;if(!c.json)throw new fn("internal","Response is not valid JSON object.");let u=c.json.data;if(void 0===u&&(u=c.json.result),void 0===u)throw new fn("internal","Response is missing data field.");return{data:un(u)}}(t,r,n,i)}(t,e,i,n||{})}async function vn(t,e,n,i){let r;n["Content-Type"]="application/json";try{r=await i(t,{method:"POST",body:JSON.stringify(e),headers:n})}catch(t){return{status:0,json:null}}let s=null;try{s=await r.json()}catch(t){}return{status:r.status,json:s}}const wn="@firebase/functions",En="0.10.0";function bn(t,e,n){return yn(b(t),e,n)}var In;In=fetch.bind(self),ot(new I(hn,((t,{instanceIdentifier:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),r=t.getProvider("messaging-internal"),s=t.getProvider("app-check-internal");return new mn(n,i,r,s,e,In)}),"PUBLIC").setMultipleInstances(!0)),dt(wn,En,void 0),dt(wn,En,"esm2017");var Tn,_n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Sn={},Cn=Cn||{},An=_n||self;function Dn(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function kn(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Nn="closure_uid_"+(1e9*Math.random()>>>0),On=0;function Ln(t,e,n){return t.call.apply(t.bind,arguments)}function Rn(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Pn(t,e,n){return(Pn=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ln:Rn).apply(null,arguments)}function xn(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Mn(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[n].apply(t,r)}}function Fn(){this.s=this.s,this.o=this.o}Fn.prototype.s=!1,Fn.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,Nn)&&t[Nn]||(t[Nn]=++On))},Fn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Vn=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Un(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function jn(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(Dn(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let r=0;r<i;r++)t[e+r]=n[r]}else t.push(n)}}function Bn(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Bn.prototype.h=function(){this.defaultPrevented=!0};var $n=function(){if(!An.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{An.addEventListener("test",(()=>{}),e),An.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function qn(t){return/^[\s\xa0]*$/.test(t)}function zn(){var t=An.navigator;return t&&(t=t.userAgent)?t:""}function Hn(t){return-1!=zn().indexOf(t)}function Kn(t){return Kn[" "](t),t}Kn[" "]=function(){};var Gn,Qn,Wn,Xn=Hn("Opera"),Jn=Hn("Trident")||Hn("MSIE"),Yn=Hn("Edge"),Zn=Yn||Jn,ti=Hn("Gecko")&&!(-1!=zn().toLowerCase().indexOf("webkit")&&!Hn("Edge"))&&!(Hn("Trident")||Hn("MSIE"))&&!Hn("Edge"),ei=-1!=zn().toLowerCase().indexOf("webkit")&&!Hn("Edge");function ni(){var t=An.document;return t?t.documentMode:void 0}t:{var ii="",ri=(Qn=zn(),ti?/rv:([^\);]+)(\)|;)/.exec(Qn):Yn?/Edge\/([\d\.]+)/.exec(Qn):Jn?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Qn):ei?/WebKit\/(\S+)/.exec(Qn):Xn?/(?:Version)[ \/]?(\S+)/.exec(Qn):void 0);if(ri&&(ii=ri?ri[1]:""),Jn){var si=ni();if(null!=si&&si>parseFloat(ii)){Gn=String(si);break t}}Gn=ii}An.document&&Jn?Wn=ni()||parseInt(Gn,10)||void 0:Wn=void 0;var oi=Wn;function ai(t,e){if(Bn.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(ti){t:{try{Kn(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ci[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ai.$.h.call(this)}}Mn(ai,Bn);var ci={2:"touch",3:"pen",4:"mouse"};ai.prototype.h=function(){ai.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var li="closure_listenable_"+(1e6*Math.random()|0),ui=0;function hi(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=r,this.key=++ui,this.fa=this.ia=!1}function di(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function fi(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function pi(t){const e={};for(const n in t)e[n]=t[n];return e}const gi="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function mi(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<gi.length;e++)n=gi[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function yi(t){this.src=t,this.g={},this.h=0}function vi(t,e){var n=e.type;if(n in t.g){var i,r=t.g[n],s=Vn(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(di(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function wi(t,e,n,i){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==i)return r}return-1}yi.prototype.add=function(t,e,n,i,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=wi(t,e,i,r);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new hi(e,this.src,s,!!i,r)).ia=n,t.push(e)),e};var Ei="closure_lm_"+(1e6*Math.random()|0),bi={};function Ii(t,e,n,i,r){if(i&&i.once)return _i(t,e,n,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Ii(t,e[s],n,i,r);return null}return n=Oi(n),t&&t[li]?t.O(e,n,kn(i)?!!i.capture:!!i,r):Ti(t,e,n,!1,i,r)}function Ti(t,e,n,i,r,s){if(!e)throw Error("Invalid event type");var o=kn(r)?!!r.capture:!!r,a=ki(t);if(a||(t[Ei]=a=new yi(t)),(n=a.add(e,n,i,o,s)).proxy)return n;if(i=function(){const t=Di;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)$n||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(Ai(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function _i(t,e,n,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)_i(t,e[s],n,i,r);return null}return n=Oi(n),t&&t[li]?t.P(e,n,kn(i)?!!i.capture:!!i,r):Ti(t,e,n,!0,i,r)}function Si(t,e,n,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)Si(t,e[s],n,i,r);else i=kn(i)?!!i.capture:!!i,n=Oi(n),t&&t[li]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=wi(s=t.g[e],n,i,r))&&(di(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=ki(t))&&(e=t.g[e.toString()],t=-1,e&&(t=wi(e,n,i,r)),(n=-1<t?e[t]:null)&&Ci(n))}function Ci(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[li])vi(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(Ai(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=ki(e))?(vi(n,t),0==n.h&&(n.src=null,e[Ei]=null)):di(t)}}}function Ai(t){return t in bi?bi[t]:bi[t]="on"+t}function Di(t,e){if(t.fa)t=!0;else{e=new ai(e,this);var n=t.listener,i=t.la||t.src;t.ia&&Ci(t),t=n.call(i,e)}return t}function ki(t){return(t=t[Ei])instanceof yi?t:null}var Ni="__closure_events_fn_"+(1e9*Math.random()>>>0);function Oi(t){return"function"==typeof t?t:(t[Ni]||(t[Ni]=function(e){return t.handleEvent(e)}),t[Ni])}function Li(){Fn.call(this),this.i=new yi(this),this.S=this,this.J=null}function Ri(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new Bn(e,t);else if(e instanceof Bn)e.target=e.target||t;else{var r=e;mi(e=new Bn(i,t),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];r=Pi(o,i,!0,e)&&r}if(r=Pi(o=e.g=t,i,!0,e)&&r,r=Pi(o,i,!1,e)&&r,n)for(s=0;s<n.length;s++)r=Pi(o=e.g=n[s],i,!1,e)&&r}function Pi(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&vi(t.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}Mn(Li,Fn),Li.prototype[li]=!0,Li.prototype.removeEventListener=function(t,e,n,i){Si(this,t,e,n,i)},Li.prototype.N=function(){if(Li.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)di(n[i]);delete e.g[t],e.h--}}this.J=null},Li.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},Li.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var xi=An.JSON.stringify;function Mi(){var t=qi;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var Fi=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Vi),(t=>t.reset()));class Vi{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Ui(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function ji(t){An.setTimeout((()=>{throw t}),0)}let Bi,$i=!1,qi=new class{constructor(){this.h=this.g=null}add(t,e){const n=Fi.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},zi=()=>{const t=An.Promise.resolve(void 0);Bi=()=>{t.then(Hi)}};var Hi=()=>{for(var t;t=Mi();){try{t.h.call(t.g)}catch(t){ji(t)}var e=Fi;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}$i=!1};function Ki(t,e){Li.call(this),this.h=t||1,this.g=e||An,this.j=Pn(this.qb,this),this.l=Date.now()}function Gi(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Qi(t,e,n){if("function"==typeof t)n&&(t=Pn(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Pn(t.handleEvent,t)}return 2147483647<Number(e)?-1:An.setTimeout(t,e||0)}function Wi(t){t.g=Qi((()=>{t.g=null,t.i&&(t.i=!1,Wi(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Mn(Ki,Li),(Tn=Ki.prototype).ga=!1,Tn.T=null,Tn.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ri(this,"tick"),this.ga&&(Gi(this),this.start()))}},Tn.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Tn.N=function(){Ki.$.N.call(this),Gi(this),delete this.g};class Xi extends Fn{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Wi(this)}N(){super.N(),this.g&&(An.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ji(t){Fn.call(this),this.h=t,this.g={}}Mn(Ji,Fn);var Yi=[];function Zi(t,e,n,i){Array.isArray(n)||(n&&(Yi[0]=n.toString()),n=Yi);for(var r=0;r<n.length;r++){var s=Ii(e,n[r],i||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function tr(t){fi(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Ci(t)}),t),t.g={}}function er(){this.g=!0}function nr(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return xi(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}Ji.prototype.N=function(){Ji.$.N.call(this),tr(this)},Ji.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},er.prototype.Ea=function(){this.g=!1},er.prototype.info=function(){};var ir={},rr=null;function sr(){return rr=rr||new Li}function or(t){Bn.call(this,ir.Ta,t)}function ar(t){const e=sr();Ri(e,new or(e))}function cr(t,e){Bn.call(this,ir.STAT_EVENT,t),this.stat=e}function lr(t){const e=sr();Ri(e,new cr(e,t))}function ur(t,e){Bn.call(this,ir.Ua,t),this.size=e}function hr(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return An.setTimeout((function(){t()}),e)}ir.Ta="serverreachability",Mn(or,Bn),ir.STAT_EVENT="statevent",Mn(cr,Bn),ir.Ua="timingevent",Mn(ur,Bn);var dr={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},fr={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function pr(){}function gr(t){return t.h||(t.h=t.i())}function mr(){}pr.prototype.h=null;var yr,vr={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function wr(){Bn.call(this,"d")}function Er(){Bn.call(this,"c")}function br(){}function Ir(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new Ji(this),this.P=_r,t=Zn?125:void 0,this.V=new Ki(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Tr}function Tr(){this.i=null,this.g="",this.h=!1}Mn(wr,Bn),Mn(Er,Bn),Mn(br,pr),br.prototype.g=function(){return new XMLHttpRequest},br.prototype.i=function(){return{}},yr=new br;var _r=45e3,Sr={},Cr={};function Ar(t,e,n){t.L=1,t.v=Kr(Br(e)),t.s=n,t.S=!0,Dr(t,null)}function Dr(t,e){t.G=Date.now(),Lr(t),t.A=Br(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),ss(n.i,"t",i),t.C=0,n=t.l.J,t.h=new Tr,t.g=ro(t.l,n?e:null,!t.s),0<t.O&&(t.M=new Xi(Pn(t.Pa,t,t.g),t.O)),Zi(t.U,t.g,"readystatechange",t.nb),e=t.I?pi(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),ar(),function(t,e,n,i,r,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&"type"==h[1]?o+(u+"=")+l+"&":o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function kr(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function Nr(t,e,n){let i,r=!0;for(;!t.J&&t.C<n.length;){if(i=Or(t,n),i==Cr){4==e&&(t.o=4,lr(14),r=!1),nr(t.j,t.m,null,"[Incomplete Response]");break}if(i==Sr){t.o=4,lr(15),nr(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}nr(t.j,t.m,i,null),Fr(t,i)}kr(t)&&i!=Cr&&i!=Sr&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,lr(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xs(e),e.M=!0,lr(11))):(nr(t.j,t.m,n,"[Invalid Chunked Response]"),Mr(t),xr(t))}function Or(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?Cr:(n=Number(e.substring(n,i)),isNaN(n)?Sr:(i+=1)+n>e.length?Cr:(e=e.slice(i,i+n),t.C=i+n,e))}function Lr(t){t.Y=Date.now()+t.P,Rr(t,t.P)}function Rr(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=hr(Pn(t.lb,t),e)}function Pr(t){t.B&&(An.clearTimeout(t.B),t.B=null)}function xr(t){0==t.l.H||t.J||Zs(t.l,t)}function Mr(t){Pr(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Gi(t.V),tr(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Fr(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||hs(n.i,t)))if(!t.K&&hs(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Ys(n),$s(n)}Ws(n),lr(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=hr(Pn(n.ib,n),6e3));if(1>=us(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else eo(n,11)}else if((t.K||n.g==t)&&Ys(n),!qn(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let l=r[e];if(n.V=l[0],l=l[1],2==n.H)if("c"==l[0]){n.K=l[1],n.pa=l[2];const e=l[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const r=l[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const u=l[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const h=t.g;if(h){const t=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=i.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ds(s,s.h),s.h=null))}if(i.F){const t=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,Hr(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=io(i,i.J?i.pa:null,i.Y),o.K){fs(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.B&&(Pr(a),Lr(a)),i.g=o}else Qs(i);0<n.j.length&&zs(n)}else"stop"!=l[0]&&"close"!=l[0]||eo(n,7);else 3==n.H&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?eo(n,7):Bs(n):"noop"!=l[0]&&n.h&&n.h.Aa(l),n.A=0)}ar()}catch(t){}}function Vr(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Dn(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(Dn(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(Dn(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],n&&n[s],t)}(Tn=Ir.prototype).setTimeout=function(t){this.P=t},Tn.nb=function(t){t=t.target;const e=this.M;e&&3==xs(t)?e.l():this.Pa(t)},Tn.Pa=function(t){try{if(t==this.g)t:{const u=xs(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||Zn||this.g&&(this.h.h||this.g.ja()||Ms(this.g)))){this.J||4!=u||7==e||ar(),Pr(this);var n=this.g.da();this.ca=n;e:if(kr(this)){var i=Ms(this.g);t="";var r=i.length,s=4==xs(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Mr(this),xr(this);var o="";break e}this.h.i=new An.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,r,s,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!qn(a)){var l=a;break e}}l=null}if(!(n=l)){this.i=!1,this.o=3,lr(12),Mr(this),xr(this);break t}nr(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Fr(this,n)}this.S?(Nr(this,u,o),Zn&&this.i&&3==u&&(Zi(this.U,this.V,"tick",this.mb),this.V.start())):(nr(this.j,this.m,o,null),Fr(this,o)),4==u&&Mr(this),this.i&&!this.J&&(4==u?Zs(this.l,this):(this.i=!1,Lr(this)))}else(function(t){const e={};t=(t.g&&2<=xs(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(qn(t[i]))continue;var n=Ui(t[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[r]||[];e[r]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,lr(12)):(this.o=0,lr(13)),Mr(this),xr(this)}}}catch(t){}},Tn.mb=function(){if(this.g){var t=xs(this.g),e=this.g.ja();this.C<e.length&&(Pr(this),Nr(this,t,e),this.i&&4!=t&&Lr(this))}},Tn.cancel=function(){this.J=!0,Mr(this)},Tn.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(ar(),lr(17)),Mr(this),this.o=2,xr(this)):Rr(this,this.Y-t)};var Ur=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function jr(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof jr){this.h=t.h,$r(this,t.j),this.s=t.s,this.g=t.g,qr(this,t.m),this.l=t.l;var e=t.i,n=new es;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),zr(this,n),this.o=t.o}else t&&(e=String(t).match(Ur))?(this.h=!1,$r(this,e[1]||"",!0),this.s=Gr(e[2]||""),this.g=Gr(e[3]||"",!0),qr(this,e[4]),this.l=Gr(e[5]||"",!0),zr(this,e[6]||"",!0),this.o=Gr(e[7]||"")):(this.h=!1,this.i=new es(null,this.h))}function Br(t){return new jr(t)}function $r(t,e,n){t.j=n?Gr(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function qr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function zr(t,e,n){e instanceof es?(t.i=e,function(t,e){e&&!t.j&&(ns(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(is(this,e),ss(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Qr(e,Zr)),t.i=new es(e,t.h))}function Hr(t,e,n){t.i.set(e,n)}function Kr(t){return Hr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Gr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Qr(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Wr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Wr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}jr.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Qr(e,Xr,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Qr(e,Xr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Qr(n,"/"==n.charAt(0)?Yr:Jr,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Qr(n,ts)),t.join("")};var Xr=/[#\/\?@]/g,Jr=/[#\?:]/g,Yr=/[#\?]/g,Zr=/[#\?@]/g,ts=/#/g;function es(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function ns(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var s=t[n].substring(0,i);r=t[n].substring(i+1)}else s=t[n];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function is(t,e){ns(t),e=os(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function rs(t,e){return ns(t),e=os(t,e),t.g.has(e)}function ss(t,e,n){is(t,e),0<n.length&&(t.i=null,t.g.set(os(t,e),Un(n)),t.h+=n.length)}function os(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function as(t){this.l=t||cs,t=An.PerformanceNavigationTiming?0<(t=An.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(An.g&&An.g.Ka&&An.g.Ka()&&An.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Tn=es.prototype).add=function(t,e){ns(this),this.i=null,t=os(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Tn.forEach=function(t,e){ns(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},Tn.ta=function(){ns(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const r=t[i];for(let t=0;t<r.length;t++)n.push(e[i])}return n},Tn.Z=function(t){ns(this);let e=[];if("string"==typeof t)rs(this,t)&&(e=e.concat(this.g.get(os(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},Tn.set=function(t,e){return ns(this),this.i=null,rs(this,t=os(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Tn.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},Tn.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),t.push(r)}}return this.i=t.join("&")};var cs=10;function ls(t){return!!t.h||!!t.g&&t.g.size>=t.j}function us(t){return t.h?1:t.g?t.g.size:0}function hs(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function ds(t,e){t.g?t.g.add(e):t.h=e}function fs(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ps(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Un(t.i)}as.prototype.cancel=function(){if(this.i=ps(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var gs=class{stringify(t){return An.JSON.stringify(t,void 0)}parse(t){return An.JSON.parse(t,void 0)}};function ms(){this.g=new gs}function ys(t,e,n){const i=n||"";try{Vr(t,(function(t,n){let r=t;kn(t)&&(r=xi(t)),e.push(i+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function vs(t,e,n,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(t){}}function ws(t){this.l=t.fc||null,this.j=t.ob||!1}function Es(t,e){Li.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=bs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Mn(ws,pr),ws.prototype.g=function(){return new Es(this.l,this.j)},ws.prototype.i=function(t){return function(){return t}}({}),Mn(Es,Li);var bs=0;function Is(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function Ts(t){t.readyState=4,t.l=null,t.j=null,t.A=null,_s(t)}function _s(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Tn=Es.prototype).open=function(t,e){if(this.readyState!=bs)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,_s(this)},Tn.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||An).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},Tn.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ts(this)),this.readyState=bs},Tn.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,_s(this)),this.g&&(this.readyState=3,_s(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==An.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Is(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},Tn.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ts(this):_s(this),3==this.readyState&&Is(this)}},Tn.Za=function(t){this.g&&(this.response=this.responseText=t,Ts(this))},Tn.Ya=function(t){this.g&&(this.response=t,Ts(this))},Tn.ka=function(){this.g&&Ts(this)},Tn.setRequestHeader=function(t,e){this.v.append(t,e)},Tn.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Tn.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Es.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Ss=An.JSON.parse;function Cs(t){Li.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=As,this.L=this.M=!1}Mn(Cs,Li);var As="",Ds=/^https?$/i,ks=["POST","PUT"];function Ns(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Os(t),Rs(t)}function Os(t){t.F||(t.F=!0,Ri(t,"complete"),Ri(t,"error"))}function Ls(t){if(t.h&&void 0!==Cn&&(!t.C[1]||4!=xs(t)||2!=t.da()))if(t.v&&4==xs(t))Qi(t.La,0,t);else if(Ri(t,"readystatechange"),4==xs(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var r=String(t.I).match(Ur)[1]||null;!r&&An.self&&An.self.location&&(r=An.self.location.protocol.slice(0,-1)),i=!Ds.test(r?r.toLowerCase():"")}n=i}if(n)Ri(t,"complete"),Ri(t,"success");else{t.m=6;try{var s=2<xs(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Os(t)}}finally{Rs(t)}}}function Rs(t,e){if(t.g){Ps(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ri(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function Ps(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(An.clearTimeout(t.A),t.A=null)}function xs(t){return t.g?t.g.readyState:0}function Ms(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case As:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Fs(t){let e="";return fi(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Vs(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=Fs(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Hr(t,e,n))}function Us(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function js(t){this.Ga=0,this.j=[],this.l=new er,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Us("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Us("baseRetryDelayMs",5e3,t),this.hb=Us("retryDelaySeedMs",1e4,t),this.eb=Us("forwardChannelMaxRetries",2,t),this.xa=Us("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new as(t&&t.concurrentRequestLimit),this.Ja=new ms,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Bs(t){if(qs(t),3==t.H){var e=t.W++,n=Br(t.I);if(Hr(n,"SID",t.K),Hr(n,"RID",e),Hr(n,"TYPE","terminate"),Ks(t,n),(e=new Ir(t,t.l,e)).L=2,e.v=Kr(Br(n)),n=!1,An.navigator&&An.navigator.sendBeacon)try{n=An.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&An.Image&&((new Image).src=e.v,n=!0),n||(e.g=ro(e.l,null),e.g.ha(e.v)),e.G=Date.now(),Lr(e)}no(t)}function $s(t){t.g&&(Xs(t),t.g.cancel(),t.g=null)}function qs(t){$s(t),t.u&&(An.clearTimeout(t.u),t.u=null),Ys(t),t.i.cancel(),t.m&&("number"==typeof t.m&&An.clearTimeout(t.m),t.m=null)}function zs(t){if(!ls(t.i)&&!t.m){t.m=!0;var e=t.Na;Bi||zi(),$i||(Bi(),$i=!0),qi.add(e,t),t.C=0}}function Hs(t,e){var n;n=e?e.m:t.W++;const i=Br(t.I);Hr(i,"SID",t.K),Hr(i,"RID",n),Hr(i,"AID",t.V),Ks(t,i),t.o&&t.s&&Vs(i,t.o,t.s),n=new Ir(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Gs(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),ds(t.i,n),Ar(n,i,e)}function Ks(t,e){t.na&&fi(t.na,(function(t,n){Hr(e,n,t)})),t.h&&Vr({},(function(t,n){Hr(e,n,t)}))}function Gs(t,e,n){n=Math.min(t.j.length,n);var i=t.h?Pn(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=e,0>n)e=Math.max(0,r[o].g-100),s=!1;else try{ys(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(s){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function Qs(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Bi||zi(),$i||(Bi(),$i=!0),qi.add(e,t),t.A=0}}function Ws(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=hr(Pn(t.Ma,t),to(t,t.A)),t.A++,0))}function Xs(t){null!=t.B&&(An.clearTimeout(t.B),t.B=null)}function Js(t){t.g=new Ir(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Br(t.wa);Hr(e,"RID","rpc"),Hr(e,"SID",t.K),Hr(e,"AID",t.V),Hr(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Hr(e,"TO",t.qa),Hr(e,"TYPE","xmlhttp"),Ks(t,e),t.o&&t.s&&Vs(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=Kr(Br(e)),n.s=null,n.S=!0,Dr(n,t)}function Ys(t){null!=t.v&&(An.clearTimeout(t.v),t.v=null)}function Zs(t,e){var n=null;if(t.g==e){Ys(t),Xs(t),t.g=null;var i=2}else{if(!hs(t.i,e))return;n=e.F,fs(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;Ri(i=sr(),new ur(i,n)),zs(t)}else Qs(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==i&&function(t,e){return!(us(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=hr(Pn(t.Na,t,e),to(t,t.C)),t.C++,0)))}(t,e)||2==i&&Ws(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:eo(t,5);break;case 4:eo(t,10);break;case 3:eo(t,6);break;default:eo(t,2)}}function to(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function eo(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=Pn(t.pb,t);n||(n=new jr("//www.google.com/images/cleardot.gif"),An.location&&"http"==An.location.protocol||$r(n,"https"),Kr(n)),function(t,e){const n=new er;if(An.Image){const i=new Image;i.onload=xn(vs,n,i,"TestLoadImage: loaded",!0,e),i.onerror=xn(vs,n,i,"TestLoadImage: error",!1,e),i.onabort=xn(vs,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=xn(vs,n,i,"TestLoadImage: timeout",!1,e),An.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else lr(2);t.H=0,t.h&&t.h.za(e),no(t),qs(t)}function no(t){if(t.H=0,t.ma=[],t.h){const e=ps(t.i);0==e.length&&0==t.j.length||(jn(t.ma,e),jn(t.ma,t.j),t.i.i.length=0,Un(t.j),t.j.length=0),t.h.ya()}}function io(t,e,n){var i=n instanceof jr?Br(n):new jr(n);if(""!=i.g)e&&(i.g=e+"."+i.g),qr(i,i.m);else{var r=An.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new jr(null);i&&$r(s,i),e&&(s.g=e),r&&qr(s,r),n&&(s.l=n),i=s}return n=t.F,e=t.Da,n&&e&&Hr(i,n,e),Hr(i,"VER",t.ra),Ks(t,i),i}function ro(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new Cs(new ws({ob:!0})):new Cs(t.va)).Oa(t.J),e}function so(){}function oo(){if(Jn&&!(10<=Number(oi)))throw Error("Environmental error: no available transport.")}function ao(t,e){Li.call(this),this.g=new js(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!qn(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!qn(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new uo(this)}function co(t){wr.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function lo(){Er.call(this),this.status=1}function uo(t){this.g=t}function ho(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function fo(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)i[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function po(t,e){this.h=e;for(var n=[],i=!0,r=t.length-1;0<=r;r--){var s=0|t[r];i&&s==e||(n[r]=s,i=!1)}this.g=n}(Tn=Cs.prototype).Oa=function(t){this.M=t},Tn.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():yr.g(),this.C=this.u?gr(this.u):gr(yr),this.g.onreadystatechange=Pn(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Ns(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=An.FormData&&t instanceof An.FormData,!(0<=Vn(ks,e))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Ps(this),0<this.B&&((this.L=function(t){return Jn&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Pn(this.ua,this)):this.A=Qi(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ns(this,t)}},Tn.ua=function(){void 0!==Cn&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ri(this,"timeout"),this.abort(8))},Tn.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ri(this,"complete"),Ri(this,"abort"),Rs(this))},Tn.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Rs(this,!0)),Cs.$.N.call(this)},Tn.La=function(){this.s||(this.G||this.v||this.l?Ls(this):this.kb())},Tn.kb=function(){Ls(this)},Tn.isActive=function(){return!!this.g},Tn.da=function(){try{return 2<xs(this)?this.g.status:-1}catch(t){return-1}},Tn.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},Tn.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Ss(e)}},Tn.Ia=function(){return this.m},Tn.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Tn=js.prototype).ra=8,Tn.H=1,Tn.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new Ir(this,this.l,t);let s=this.s;if(this.U&&(s?(s=pi(s),mi(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Gs(this,r,e),Hr(n=Br(this.I),"RID",t),Hr(n,"CVER",22),this.F&&Hr(n,"X-HTTP-Session-Id",this.F),Ks(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Fs(s)))+"&"+e:this.o&&Vs(n,this.o,s)),ds(this.i,r),this.bb&&Hr(n,"TYPE","init"),this.P?(Hr(n,"$req",e),Hr(n,"SID","null"),r.aa=!0,Ar(r,n,null)):Ar(r,n,e),this.H=2}}else 3==this.H&&(t?Hs(this,t):0==this.j.length||ls(this.i)||Hs(this))},Tn.Ma=function(){if(this.u=null,Js(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=hr(Pn(this.jb,this),t)}},Tn.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,lr(10),$s(this),Js(this))},Tn.ib=function(){null!=this.v&&(this.v=null,$s(this),Ws(this),lr(19))},Tn.pb=function(t){t?(this.l.info("Successfully pinged google.com"),lr(2)):(this.l.info("Failed to ping google.com"),lr(1))},Tn.isActive=function(){return!!this.h&&this.h.isActive(this)},(Tn=so.prototype).Ba=function(){},Tn.Aa=function(){},Tn.za=function(){},Tn.ya=function(){},Tn.isActive=function(){return!0},Tn.Va=function(){},oo.prototype.g=function(t,e){return new ao(t,e)},Mn(ao,Li),ao.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;lr(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=io(t,null,t.Y),zs(t)},ao.prototype.close=function(){Bs(this.g)},ao.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=xi(t),t=n);e.j.push(new class{constructor(t,e){this.g=t,this.map=e}}(e.fb++,t)),3==e.H&&zs(e)},ao.prototype.N=function(){this.g.h=null,delete this.j,Bs(this.g),delete this.g,ao.$.N.call(this)},Mn(co,wr),Mn(lo,Er),Mn(uo,so),uo.prototype.Ba=function(){Ri(this.g,"a")},uo.prototype.Aa=function(t){Ri(this.g,new co(t))},uo.prototype.za=function(t){Ri(this.g,new lo)},uo.prototype.ya=function(){Ri(this.g,"b")},Mn(ho,(function(){this.blockSize=-1})),ho.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ho.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=n;)fo(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(i[r++]=t.charCodeAt(s++),r==this.blockSize){fo(this,i),r=0;break}}else for(;s<e;)if(i[r++]=t[s++],r==this.blockSize){fo(this,i),r=0;break}}this.h=r,this.i+=e},ho.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var go={};function mo(t){return-128<=t&&128>t?function(t,e){var n=go;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new po([0|t],0>t?-1:0)}(t)}(t):new po([0|t],0>t?-1:0)}function yo(t){if(isNaN(t)||!isFinite(t))return wo;if(0>t)return _o(yo(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=vo;return new po(e,0)}var vo=4294967296,wo=mo(0),Eo=mo(1),bo=mo(16777216);function Io(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function To(t){return-1==t.h}function _o(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new po(n,~t.h).add(Eo)}function So(t,e){return t.add(_o(e))}function Co(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function Ao(t,e){this.g=t,this.h=e}function Do(t,e){if(Io(e))throw Error("division by zero");if(Io(t))return new Ao(wo,wo);if(To(t))return e=Do(_o(t),e),new Ao(_o(e.g),_o(e.h));if(To(e))return e=Do(t,_o(e)),new Ao(_o(e.g),e.h);if(30<t.g.length){if(To(t)||To(e))throw Error("slowDivide_ only works with positive integers.");for(var n=Eo,i=e;0>=i.X(t);)n=ko(n),i=ko(i);var r=No(n,1),s=No(i,1);for(i=No(i,2),n=No(n,2);!Io(i);){var o=s.add(i);0>=o.X(t)&&(r=r.add(n),s=o),i=No(i,1),n=No(n,1)}return e=So(t,r.R(e)),new Ao(r,e)}for(r=wo;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=yo(n)).R(e);To(o)||0<o.X(t);)o=(s=yo(n-=i)).R(e);Io(s)&&(s=Eo),r=r.add(s),t=So(t,o)}return new Ao(r,t)}function ko(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new po(n,t.h)}function No(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,r=[],s=0;s<i;s++)r[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new po(r,t.h)}(Tn=po.prototype).ea=function(){if(To(this))return-_o(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:vo+i)*e,e*=vo}return t},Tn.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(Io(this))return"0";if(To(this))return"-"+_o(this).toString(t);for(var e=yo(Math.pow(t,6)),n=this,i="";;){var r=Do(n,e).g,s=((0<(n=So(n,r.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(Io(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},Tn.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},Tn.X=function(t){return To(t=So(this,t))?-1:Io(t)?0:1},Tn.abs=function(){return To(this)?_o(this):this},Tn.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,r=0;r<=e;r++){var s=i+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new po(n,-2147483648&n[n.length-1]?-1:0)},Tn.R=function(t){if(Io(this)||Io(t))return wo;if(To(this))return To(t)?_o(this).R(_o(t)):_o(_o(this).R(t));if(To(t))return _o(this.R(_o(t)));if(0>this.X(bo)&&0>t.X(bo))return yo(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<t.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=t.D(r)>>>16,c=65535&t.D(r);n[2*i+2*r]+=o*c,Co(n,2*i+2*r),n[2*i+2*r+1]+=s*c,Co(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,Co(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,Co(n,2*i+2*r+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new po(n,0)},Tn.gb=function(t){return Do(this,t).h},Tn.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new po(n,this.h&t.h)},Tn.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new po(n,this.h|t.h)},Tn.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new po(n,this.h^t.h)},oo.prototype.createWebChannel=oo.prototype.g,ao.prototype.send=ao.prototype.u,ao.prototype.open=ao.prototype.m,ao.prototype.close=ao.prototype.close,dr.NO_ERROR=0,dr.TIMEOUT=8,dr.HTTP_ERROR=6,fr.COMPLETE="complete",mr.EventType=vr,vr.OPEN="a",vr.CLOSE="b",vr.ERROR="c",vr.MESSAGE="d",Li.prototype.listen=Li.prototype.O,Cs.prototype.listenOnce=Cs.prototype.P,Cs.prototype.getLastError=Cs.prototype.Sa,Cs.prototype.getLastErrorCode=Cs.prototype.Ia,Cs.prototype.getStatus=Cs.prototype.da,Cs.prototype.getResponseJson=Cs.prototype.Wa,Cs.prototype.getResponseText=Cs.prototype.ja,Cs.prototype.send=Cs.prototype.ha,Cs.prototype.setWithCredentials=Cs.prototype.Oa,ho.prototype.digest=ho.prototype.l,ho.prototype.reset=ho.prototype.reset,ho.prototype.update=ho.prototype.j,po.prototype.add=po.prototype.add,po.prototype.multiply=po.prototype.R,po.prototype.modulo=po.prototype.gb,po.prototype.compare=po.prototype.X,po.prototype.toNumber=po.prototype.ea,po.prototype.toString=po.prototype.toString,po.prototype.getBits=po.prototype.D,po.fromNumber=yo,po.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return _o(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=yo(Math.pow(n,8)),r=wo,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=yo(Math.pow(n,o)),r=r.R(o).add(yo(a))):r=(r=r.R(i)).add(yo(a))}return r};var Oo=Sn.createWebChannelTransport=function(){return new oo},Lo=Sn.getStatEventTarget=function(){return sr()},Ro=Sn.ErrorCode=dr,Po=Sn.EventType=fr,xo=Sn.Event=ir,Mo=Sn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Fo=Sn.FetchXmlHttpFactory=ws,Vo=Sn.WebChannel=mr,Uo=Sn.XhrIo=Cs,jo=(Sn.Md5=ho,Sn.Integer=po);const Bo="@firebase/firestore";class $o{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}$o.UNAUTHENTICATED=new $o(null),$o.GOOGLE_CREDENTIALS=new $o("google-credentials-uid"),$o.FIRST_PARTY=new $o("first-party-uid"),$o.MOCK_USER=new $o("mock-user");let qo="10.1.0";const zo=new R("@firebase/firestore");function Ho(){return zo.logLevel}function Ko(t,...e){if(zo.logLevel<=A.DEBUG){const n=e.map(Wo);zo.debug(`Firestore (${qo}): ${t}`,...n)}}function Go(t,...e){if(zo.logLevel<=A.ERROR){const n=e.map(Wo);zo.error(`Firestore (${qo}): ${t}`,...n)}}function Qo(t,...e){if(zo.logLevel<=A.WARN){const n=e.map(Wo);zo.warn(`Firestore (${qo}): ${t}`,...n)}}function Wo(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Xo(t="Unexpected state"){const e=`FIRESTORE (${qo}) INTERNAL ASSERTION FAILED: `+t;throw Go(e),new Error(e)}function Jo(t,e){t||Xo()}function Yo(t,e){return t}const Zo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ta extends h{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ea{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class na{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class ia{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e($o.UNAUTHENTICATED)))}shutdown(){}}class ra{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class sa{constructor(t){this.t=t,this.currentUser=$o.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new ea;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new ea,t.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{Ko("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Ko("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new ea)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Ko("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Jo("string"==typeof e.accessToken),new na(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Jo(null===t||"string"==typeof t),new $o(t)}}class oa{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=$o.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class aa{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new oa(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e($o.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ca{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class la{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&Ko("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,Ko("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{Ko("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?i(t):Ko("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Jo("string"==typeof t.token),this.R=t.token,new ca(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ua(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ha{static V(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ua(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function da(t,e){return t<e?-1:t>e?1:0}function fa(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class pa{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ta(Zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ta(Zo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ta(Zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ta(Zo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return pa.fromMillis(Date.now())}static fromDate(t){return pa.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new pa(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?da(this.nanoseconds,t.nanoseconds):da(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ga{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ga(t)}static min(){return new ga(new pa(0,0))}static max(){return new ga(new pa(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ma{constructor(t,e,n){void 0===e?e=0:e>t.length&&Xo(),void 0===n?n=t.length-e:n>t.length-e&&Xo(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ma.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ma?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),r=e.get(i);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ya extends ma{construct(t,e,n){return new ya(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new ta(Zo.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ya(e)}static emptyPath(){return new ya([])}}const va=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wa extends ma{construct(t,e,n){return new wa(t,e,n)}static isValidIdentifier(t){return va.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wa.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new wa(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const r=()=>{if(0===n.length)throw new ta(Zo.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new ta(Zo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new ta(Zo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(s=!s,i++):"."!==e||s?(n+=e,i++):(r(),i++)}if(r(),s)throw new ta(Zo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new wa(e)}static emptyPath(){return new wa([])}}class Ea{constructor(t){this.path=t}static fromPath(t){return new Ea(ya.fromString(t))}static fromName(t){return new Ea(ya.fromString(t).popFirst(5))}static empty(){return new Ea(ya.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ya.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ya.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new Ea(new ya(t.slice()))}}function ba(t){return new Ia(t.readTime,t.key,-1)}class Ia{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new Ia(ga.min(),Ea.empty(),-1)}static max(){return new Ia(ga.max(),Ea.empty(),-1)}}function Ta(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=Ea.comparator(t.documentKey,e.documentKey),0!==n?n:da(t.largestBatchId,e.largestBatchId))}const _a="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Sa{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Ca(t){if(t.code!==Zo.FAILED_PRECONDITION||t.message!==_a)throw t;Ko("LocalStore","Unexpectedly lost primary lease")}class Aa{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Xo(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Aa(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Aa?e:Aa.resolve(e)}catch(t){return Aa.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Aa.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Aa.reject(e)}static resolve(t){return new Aa(((e,n)=>{e(t)}))}static reject(t){return new Aa(((e,n)=>{n(t)}))}static waitFor(t){return new Aa(((e,n)=>{let i=0,r=0,s=!1;t.forEach((t=>{++i,t.next((()=>{++r,s&&r===i&&e()}),(t=>n(t)))})),s=!0,r===i&&e()}))}static or(t){let e=Aa.resolve(!1);for(const n of t)e=e.next((t=>t?Aa.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new Aa(((n,i)=>{const r=t.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===r&&n(s)}),(t=>i(t)))}}))}static doWhile(t,e){return new Aa(((n,i)=>{const r=()=>{!0===t()?e().next((()=>{r()}),i):n()};r()}))}}function Da(t){return"IndexedDbTransactionError"===t.name}class ka{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.oe(t),this._e=t=>e.writeSequenceNumber(t))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}function Na(t){return null==t}function Oa(t){return 0===t&&1/t==-1/0}ka.ae=-1;function La(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ra(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Pa(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class xa{constructor(t,e){this.comparator=t,this.root=e||Fa.EMPTY}insert(t,e){return new xa(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Fa.BLACK,null,null))}remove(t){return new xa(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Fa.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ma(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ma(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ma(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ma(this.root,t,this.comparator,!0)}}class Ma{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&i&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Fa{constructor(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:Fa.RED,this.left=null!=i?i:Fa.EMPTY,this.right=null!=r?r:Fa.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,r){return new Fa(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const r=n(t,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Fa.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return Fa.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Fa.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Fa.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Xo();if(this.right.isRed())throw Xo();const t=this.left.check();if(t!==this.right.check())throw Xo();return t+(this.isRed()?0:1)}}Fa.EMPTY=null,Fa.RED=!0,Fa.BLACK=!1,Fa.EMPTY=new class{constructor(){this.size=0}get key(){throw Xo()}get value(){throw Xo()}get color(){throw Xo()}get left(){throw Xo()}get right(){throw Xo()}copy(t,e,n,i,r){return this}insert(t,e,n){return new Fa(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Va{constructor(t){this.comparator=t,this.data=new xa(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ua(this.data.getIterator())}getIteratorFrom(t){return new Ua(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Va))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Va(this.comparator);return e.data=t,e}}class Ua{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ja{constructor(t){this.fields=t,t.sort(wa.comparator)}static empty(){return new ja([])}unionWith(t){let e=new Va(wa.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new ja(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return fa(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Ba extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class $a{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Ba("Invalid base64 string: "+t):t}}(t);return new $a(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new $a(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return da(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}$a.EMPTY_BYTE_STRING=new $a("");const qa=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function za(t){if(Jo(!!t),"string"==typeof t){let e=0;const n=qa.exec(t);if(Jo(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ha(t.seconds),nanos:Ha(t.nanos)}}function Ha(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ka(t){return"string"==typeof t?$a.fromBase64String(t):$a.fromUint8Array(t)}function Ga(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Qa(t){const e=t.mapValue.fields.__previous_value__;return Ga(e)?Qa(e):e}function Wa(t){const e=za(t.mapValue.fields.__local_write_time__.timestampValue);return new pa(e.seconds,e.nanos)}class Xa{constructor(t,e,n,i,r,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class Ja{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Ja("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Ja&&t.projectId===this.projectId&&t.database===this.database}}const Ya={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function Za(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ga(t)?4:uc(t)?9007199254740991:10:Xo()}function tc(t,e){if(t===e)return!0;const n=Za(t);if(n!==Za(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Wa(t).isEqual(Wa(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=za(t.timestampValue),i=za(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ka(t.bytesValue).isEqual(Ka(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Ha(t.geoPointValue.latitude)===Ha(e.geoPointValue.latitude)&&Ha(t.geoPointValue.longitude)===Ha(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Ha(t.integerValue)===Ha(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Ha(t.doubleValue),i=Ha(e.doubleValue);return n===i?Oa(n)===Oa(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return fa(t.arrayValue.values||[],e.arrayValue.values||[],tc);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(La(n)!==La(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!tc(n[t],i[t])))return!1;return!0}(t,e);default:return Xo()}}function ec(t,e){return void 0!==(t.values||[]).find((t=>tc(t,e)))}function nc(t,e){if(t===e)return 0;const n=Za(t),i=Za(e);if(n!==i)return da(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return da(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Ha(t.integerValue||t.doubleValue),i=Ha(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return ic(t.timestampValue,e.timestampValue);case 4:return ic(Wa(t),Wa(e));case 5:return da(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ka(t),i=Ka(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=da(n[t],i[t]);if(0!==e)return e}return da(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=da(Ha(t.latitude),Ha(e.latitude));return 0!==n?n:da(Ha(t.longitude),Ha(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=nc(n[t],i[t]);if(e)return e}return da(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Ya.mapValue&&e===Ya.mapValue)return 0;if(t===Ya.mapValue)return 1;if(e===Ya.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let t=0;t<i.length&&t<s.length;++t){const e=da(i[t],s[t]);if(0!==e)return e;const o=nc(n[i[t]],r[s[t]]);if(0!==o)return o}return da(i.length,s.length)}(t.mapValue,e.mapValue);default:throw Xo()}}function ic(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return da(t,e);const n=za(t),i=za(e),r=da(n.seconds,i.seconds);return 0!==r?r:da(n.nanos,i.nanos)}function rc(t){return sc(t)}function sc(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=za(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Ka(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return Ea.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=sc(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const r of e)i?i=!1:n+=",",n+=`${r}:${sc(t.fields[r])}`;return n+"}"}(t.mapValue):Xo()}function oc(t){return!!t&&"integerValue"in t}function ac(t){return!!t&&"arrayValue"in t}function cc(t){return!!t&&"mapValue"in t}function lc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ra(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=lc(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=lc(t.arrayValue.values[n]);return e}return Object.assign({},t)}function uc(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class hc{constructor(t){this.value=t}static empty(){return new hc({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!cc(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=lc(e)}setAll(t){let e=wa.emptyPath(),n={},i=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=r.popLast()}t?n[r.lastSegment()]=lc(t):i.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,i)}delete(t){const e=this.field(t.popLast());cc(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return tc(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];cc(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Ra(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new hc(lc(this.value))}}function dc(t){const e=[];return Ra(t.fields,((t,n)=>{const i=new wa([t]);if(cc(n)){const t=dc(n.mapValue).fields;if(0===t.length)e.push(i);else for(const n of t)e.push(i.child(n))}else e.push(i)})),new ja(e)}class fc{constructor(t,e,n,i,r,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(t){return new fc(t,0,ga.min(),ga.min(),ga.min(),hc.empty(),0)}static newFoundDocument(t,e,n,i){return new fc(t,1,e,ga.min(),n,i,0)}static newNoDocument(t,e){return new fc(t,2,e,ga.min(),ga.min(),hc.empty(),0)}static newUnknownDocument(t,e){return new fc(t,3,e,ga.min(),ga.min(),hc.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ga.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=hc.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=hc.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ga.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof fc&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new fc(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class pc{constructor(t,e){this.position=t,this.inclusive=e}}function gc(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const s=e[r],o=t.position[r];if(i=s.field.isKeyField()?Ea.comparator(Ea.fromName(o.referenceValue),n.key):nc(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function mc(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!tc(t.position[n],e.position[n]))return!1;return!0}class yc{constructor(t,e="asc"){this.field=t,this.dir=e}}function vc(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class wc{}class Ec extends wc{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Ac(t,e,n):"array-contains"===e?new Oc(t,n):"in"===e?new Lc(t,n):"not-in"===e?new Rc(t,n):"array-contains-any"===e?new Pc(t,n):new Ec(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Dc(t,n):new kc(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(nc(e,this.value)):null!==e&&Za(this.value)===Za(e)&&this.matchesComparison(nc(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Xo()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class bc extends wc{constructor(t,e){super(),this.filters=t,this.op=e,this.ce=null}static create(t,e){return new bc(t,e)}matches(t){return Ic(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.le((t=>t.isInequality()));return null!==t?t.field:null}le(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function Ic(t){return"and"===t.op}function Tc(t){return function(t){for(const e of t.filters)if(e instanceof bc)return!1;return!0}(t)&&Ic(t)}function _c(t){if(t instanceof Ec)return t.field.canonicalString()+t.op.toString()+rc(t.value);if(Tc(t))return t.filters.map((t=>_c(t))).join(",");{const e=t.filters.map((t=>_c(t))).join(",");return`${t.op}(${e})`}}function Sc(t,e){return t instanceof Ec?function(t,e){return e instanceof Ec&&t.op===e.op&&t.field.isEqual(e.field)&&tc(t.value,e.value)}(t,e):t instanceof bc?function(t,e){return e instanceof bc&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&Sc(n,e.filters[i])),!0)}(t,e):void Xo()}function Cc(t){return t instanceof Ec?function(t){return`${t.field.canonicalString()} ${t.op} ${rc(t.value)}`}(t):t instanceof bc?function(t){return t.op.toString()+" {"+t.getFilters().map(Cc).join(" ,")+"}"}(t):"Filter"}class Ac extends Ec{constructor(t,e,n){super(t,e,n),this.key=Ea.fromName(n.referenceValue)}matches(t){const e=Ea.comparator(t.key,this.key);return this.matchesComparison(e)}}class Dc extends Ec{constructor(t,e){super(t,"in",e),this.keys=Nc(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class kc extends Ec{constructor(t,e){super(t,"not-in",e),this.keys=Nc(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Nc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>Ea.fromName(t.referenceValue)))}class Oc extends Ec{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ac(e)&&ec(e.arrayValue,this.value)}}class Lc extends Ec{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ec(this.value.arrayValue,e)}}class Rc extends Ec{constructor(t,e){super(t,"not-in",e)}matches(t){if(ec(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ec(this.value.arrayValue,e)}}class Pc extends Ec{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ac(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ec(this.value.arrayValue,t)))}}class xc{constructor(t,e=null,n=[],i=[],r=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.he=null}}function Mc(t,e=null,n=[],i=[],r=null,s=null,o=null){return new xc(t,e,n,i,r,s,o)}function Fc(t){const e=Yo(t);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>_c(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Na(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>rc(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>rc(t))).join(",")),e.he=t}return e.he}function Vc(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!vc(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!Sc(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!mc(t.startAt,e.startAt)&&mc(t.endAt,e.endAt)}class Uc{constructor(t,e=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function jc(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Bc(t){const e=Yo(t);if(null===e.Pe){e.Pe=[];const t=function(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}(e),n=function(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}(e);if(null!==t&&null===n)t.isKeyField()||e.Pe.push(new yc(t)),e.Pe.push(new yc(wa.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.Pe.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new yc(wa.keyField(),t))}}}return e.Pe}function $c(t){const e=Yo(t);if(!e.Ie)if("F"===e.limitType)e.Ie=Mc(e.path,e.collectionGroup,Bc(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Bc(e)){const e="desc"===n.dir?"asc":"desc";t.push(new yc(n.field,e))}const n=e.endAt?new pc(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new pc(e.startAt.position,e.startAt.inclusive):null;e.Ie=Mc(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.Ie}function qc(t,e,n){return new Uc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zc(t,e){return Vc($c(t),$c(e))&&t.limitType===e.limitType}function Hc(t){return`${Fc($c(t))}|lt:${t.limitType}`}function Kc(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Cc(t))).join(", ")}]`),Na(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>rc(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>rc(t))).join(",")),`Target(${e})`}($c(t))}; limitType=${t.limitType})`}function Gc(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ea.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Bc(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=gc(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Bc(t),e)||t.endAt&&!function(t,e,n){const i=gc(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Bc(t),e))}(t,e)}function Qc(t,e,n){const i=t.field.isKeyField()?Ea.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),r=n.data.field(t);return null!==i&&null!==r?nc(i,r):Xo()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Xo()}}class Wc{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Ra(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return Pa(this.inner)}size(){return this.innerSize}}const Xc=new xa(Ea.comparator);function Jc(){return Xc}const Yc=new xa(Ea.comparator);function Zc(...t){let e=Yc;for(const n of t)e=e.insert(n.key,n);return e}function tl(t){let e=Yc;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function el(){return il()}function nl(){return il()}function il(){return new Wc((t=>t.toString()),((t,e)=>t.isEqual(e)))}const rl=new xa(Ea.comparator),sl=new Va(Ea.comparator);function ol(...t){let e=sl;for(const n of t)e=e.add(n);return e}const al=new Va(da);function cl(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oa(e)?"-0":e}}function ll(t){return{integerValue:""+t}}function ul(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Oa(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?ll(e):cl(t,e)}class hl{constructor(){this._=void 0}}function dl(t,e,n){return t instanceof gl?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Ga(e)&&(e=Qa(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ml?yl(t,e):t instanceof vl?wl(t,e):function(t,e){const n=pl(t,e),i=bl(n)+bl(t.Te);return oc(n)&&oc(t.Te)?ll(i):cl(t.serializer,i)}(t,e)}function fl(t,e,n){return t instanceof ml?yl(t,e):t instanceof vl?wl(t,e):n}function pl(t,e){return t instanceof El?function(t){return oc(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class gl extends hl{}class ml extends hl{constructor(t){super(),this.elements=t}}function yl(t,e){const n=Il(e);for(const e of t.elements)n.some((t=>tc(t,e)))||n.push(e);return{arrayValue:{values:n}}}class vl extends hl{constructor(t){super(),this.elements=t}}function wl(t,e){let n=Il(e);for(const e of t.elements)n=n.filter((t=>!tc(t,e)));return{arrayValue:{values:n}}}class El extends hl{constructor(t,e){super(),this.serializer=t,this.Te=e}}function bl(t){return Ha(t.integerValue||t.doubleValue)}function Il(t){return ac(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Tl{constructor(t,e){this.field=t,this.transform=e}}class _l{constructor(t,e){this.version=t,this.transformResults=e}}class Sl{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Sl}static exists(t){return new Sl(void 0,t)}static updateTime(t){return new Sl(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Cl(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Al{}function Dl(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Vl(t.key,Sl.none()):new Rl(t.key,t.data,Sl.none());{const n=t.data,i=hc.empty();let r=new Va(wa.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),r=r.add(t)}return new Pl(t.key,i,new ja(r.toArray()),Sl.none())}}function kl(t,e,n){t instanceof Rl?function(t,e,n){const i=t.value.clone(),r=Ml(t.fieldTransforms,e,n.transformResults);i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Pl?function(t,e,n){if(!Cl(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Ml(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(xl(t)),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Nl(t,e,n,i){return t instanceof Rl?function(t,e,n,i){if(!Cl(t.precondition,e))return n;const r=t.value.clone(),s=Fl(t.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,i):t instanceof Pl?function(t,e,n,i){if(!Cl(t.precondition,e))return n;const r=Fl(t.fieldTransforms,i,e),s=e.data;return s.setAll(xl(t)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return Cl(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Ol(t,e){let n=null;for(const i of t.fieldTransforms){const t=e.data.field(i.field),r=pl(i.transform,t||null);null!=r&&(null===n&&(n=hc.empty()),n.set(i.field,r))}return n||null}function Ll(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&fa(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ml&&e instanceof ml||t instanceof vl&&e instanceof vl?fa(t.elements,e.elements,tc):t instanceof El&&e instanceof El?tc(t.Te,e.Te):t instanceof gl&&e instanceof gl}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Rl extends Al{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Pl extends Al{constructor(t,e,n,i,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function xl(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function Ml(t,e,n){const i=new Map;Jo(t.length===n.length);for(let r=0;r<n.length;r++){const s=t[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,fl(o,a,n[r]))}return i}function Fl(t,e,n){const i=new Map;for(const r of t){const t=r.transform,s=n.data.field(r.field);i.set(r.field,dl(t,s,e))}return i}class Vl extends Al{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ul extends Al{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class jl{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&kl(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Nl(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Nl(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=nl();return this.mutations.forEach((i=>{const r=t.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=e.has(i.key)?null:o;const a=Dl(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(ga.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ol())}isEqual(t){return this.batchId===t.batchId&&fa(this.mutations,t.mutations,((t,e)=>Ll(t,e)))&&fa(this.baseMutations,t.baseMutations,((t,e)=>Ll(t,e)))}}class Bl{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){Jo(t.mutations.length===n.length);let i=rl;const r=t.mutations;for(let t=0;t<r.length;t++)i=i.insert(r[t].key,n[t].version);return new Bl(t,e,n,i)}}class $l{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}var ql,zl;(zl=ql||(ql={}))[zl.OK=0]="OK",zl[zl.CANCELLED=1]="CANCELLED",zl[zl.UNKNOWN=2]="UNKNOWN",zl[zl.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",zl[zl.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",zl[zl.NOT_FOUND=5]="NOT_FOUND",zl[zl.ALREADY_EXISTS=6]="ALREADY_EXISTS",zl[zl.PERMISSION_DENIED=7]="PERMISSION_DENIED",zl[zl.UNAUTHENTICATED=16]="UNAUTHENTICATED",zl[zl.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",zl[zl.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",zl[zl.ABORTED=10]="ABORTED",zl[zl.OUT_OF_RANGE=11]="OUT_OF_RANGE",zl[zl.UNIMPLEMENTED=12]="UNIMPLEMENTED",zl[zl.INTERNAL=13]="INTERNAL",zl[zl.UNAVAILABLE=14]="UNAVAILABLE",zl[zl.DATA_LOSS=15]="DATA_LOSS",new jo([4294967295,4294967295],0);class Hl{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function Kl(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Gl(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Ql(t,e){return Kl(t,e.toTimestamp())}function Wl(t){return Jo(!!t),ga.fromTimestamp(function(t){const e=za(t);return new pa(e.seconds,e.nanos)}(t))}function Xl(t,e){return function(t){return new ya(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Jl(t,e){return Xl(t.databaseId,e.path)}function Yl(t){const e=function(t){const e=ya.fromString(t);return Jo(function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}(e)),e}(t);return 4===e.length?ya.emptyPath():function(t){return Jo(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}(e)}function Zl(t,e,n){return{name:Jl(t,e),fields:n.value.mapValue.fields}}function tu(t){let e=Yl(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){Jo(1===i);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=eu(t);return e instanceof bc&&Tc(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new yc(nu(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Na(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new pc(n,e)}(n.startAt));let l=null;return n.endAt&&(l=function(t){const e=!t.before,n=t.values||[];return new pc(n,e)}(n.endAt)),function(t,e,n,i,r,s,o,a){return new Uc(t,e,n,i,r,s,o,a)}(e,r,o,s,a,"F",c,l)}function eu(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=nu(t.unaryFilter.field);return Ec.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=nu(t.unaryFilter.field);return Ec.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=nu(t.unaryFilter.field);return Ec.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=nu(t.unaryFilter.field);return Ec.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Xo()}}(t):void 0!==t.fieldFilter?function(t){return Ec.create(nu(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Xo()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return bc.create(t.compositeFilter.filters.map((t=>eu(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Xo()}}(t.compositeFilter.op))}(t):Xo()}function nu(t){return wa.fromServerFormat(t.fieldPath)}function iu(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}class ru{constructor(t){this.ct=t}}function su(t){const e=tu({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?qc(e,e.limit,"L"):e}class ou{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Ha(t.integerValue));else if("doubleValue"in t){const n=Ha(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Oa(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Ka(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?uc(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Xo()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),Ea.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}ou.bt=new ou;class au{constructor(){this.sn=new cu}addToCollectionParentIndex(t,e){return this.sn.add(e),Aa.resolve()}getCollectionParents(t,e){return Aa.resolve(this.sn.getEntries(e))}addFieldIndex(t,e){return Aa.resolve()}deleteFieldIndex(t,e){return Aa.resolve()}getDocumentsMatchingTarget(t,e){return Aa.resolve(null)}getIndexType(t,e){return Aa.resolve(0)}getFieldIndexes(t,e){return Aa.resolve([])}getNextCollectionGroupToUpdate(t){return Aa.resolve(null)}getMinOffset(t,e){return Aa.resolve(Ia.min())}getMinOffsetFromCollectionGroup(t,e){return Aa.resolve(Ia.min())}updateCollectionGroup(t,e,n){return Aa.resolve()}updateIndexEntries(t,e){return Aa.resolve()}}class cu{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Va(ya.comparator),r=!i.has(n);return this.index[e]=i.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Va(ya.comparator)).toArray()}}new Uint8Array(0);class lu{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new lu(t,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}lu.DEFAULT_COLLECTION_PERCENTILE=10,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,lu.DEFAULT=new lu(41943040,lu.DEFAULT_COLLECTION_PERCENTILE,lu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),lu.DISABLED=new lu(-1,0,0);class uu{constructor(t){this.Mn=t}next(){return this.Mn+=2,this.Mn}static xn(){return new uu(0)}static On(){return new uu(-1)}}class hu{constructor(){this.changes=new Wc((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,fc.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Aa.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class du{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class fu{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Nl(n.mutation,t,ja.empty(),pa.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ol()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ol()){const i=el();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Zc();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=el();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ol())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let r=Jc();const s=il(),o=il();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof Pl)?r=r.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Nl(o.mutation,e,o.mutation.getFieldMask(),pa.now())):s.set(e.key,ja.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new du(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=il();let i=new xa(((t,e)=>t-e)),r=ol();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||ja.empty();o=r.applyToLocalView(s,o),n.set(t,o);const a=(i.get(r.batchId)||ol()).add(t);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,l=nl();c.forEach((t=>{if(!r.has(t)){const i=Dl(e.get(t),n.get(t));null!==i&&l.set(t,i),r=r.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,l))}return Aa.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return Ea.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-r.size):Aa.resolve(el());let o=-1,a=r;return s.next((e=>Aa.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?Aa.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,ol()))).next((t=>({batchId:o,changes:tl(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new Ea(e)).next((t=>{let e=Zc();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let r=Zc();return this.indexManager.getCollectionParents(t,i).next((s=>Aa.forEach(s,(s=>{const o=function(t,e){return new Uc(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,fc.newInvalidDocument(i)))}));let n=Zc();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Nl(s.mutation,r,ja.empty(),pa.now()),Gc(e,r)&&(n=n.insert(t,r))})),n}))}}class pu{constructor(t){this.serializer=t,this.ar=new Map,this.ur=new Map}getBundleMetadata(t,e){return Aa.resolve(this.ar.get(e))}saveBundleMetadata(t,e){return this.ar.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Wl(t.createTime)}}(e)),Aa.resolve()}getNamedQuery(t,e){return Aa.resolve(this.ur.get(e))}saveNamedQuery(t,e){return this.ur.set(e.name,function(t){return{name:t.name,query:su(t.bundledQuery),readTime:Wl(t.readTime)}}(e)),Aa.resolve()}}class gu{constructor(){this.overlays=new xa(Ea.comparator),this.cr=new Map}getOverlay(t,e){return Aa.resolve(this.overlays.get(e))}getOverlays(t,e){const n=el();return Aa.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.ht(t,e,i)})),Aa.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.cr.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.cr.delete(n)),Aa.resolve()}getOverlaysForCollection(t,e,n){const i=el(),r=e.length+1,s=new Ea(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===r&&t.largestBatchId>n&&i.set(t.getKey(),t)}return Aa.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let r=new xa(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=el(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=el(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return Aa.resolve(o)}ht(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.cr.get(i.largestBatchId).delete(n.key);this.cr.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new $l(e,n));let r=this.cr.get(e);void 0===r&&(r=ol(),this.cr.set(e,r)),this.cr.set(e,r.add(n.key))}}class mu{constructor(){this.lr=new Va(yu.hr),this.Pr=new Va(yu.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(t,e){const n=new yu(t,e);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Er(new yu(t,e))}dr(t,e){t.forEach((t=>this.removeReference(t,e)))}Ar(t){const e=new Ea(new ya([])),n=new yu(e,t),i=new yu(e,t+1),r=[];return this.Pr.forEachInRange([n,i],(t=>{this.Er(t),r.push(t.key)})),r}Rr(){this.lr.forEach((t=>this.Er(t)))}Er(t){this.lr=this.lr.delete(t),this.Pr=this.Pr.delete(t)}Vr(t){const e=new Ea(new ya([])),n=new yu(e,t),i=new yu(e,t+1);let r=ol();return this.Pr.forEachInRange([n,i],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new yu(t,0),n=this.lr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class yu{constructor(t,e){this.key=t,this.mr=e}static hr(t,e){return Ea.comparator(t.key,e.key)||da(t.mr,e.mr)}static Ir(t,e){return da(t.mr,e.mr)||Ea.comparator(t.key,e.key)}}class vu{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.gr=1,this.pr=new Va(yu.hr)}checkEmpty(t){return Aa.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const r=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new jl(r,e,n,i);this.mutationQueue.push(s);for(const e of i)this.pr=this.pr.add(new yu(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Aa.resolve(s)}lookupMutationBatch(t,e){return Aa.resolve(this.yr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.wr(n),r=i<0?0:i;return Aa.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return Aa.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(t){return Aa.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new yu(e,0),i=new yu(e,Number.POSITIVE_INFINITY),r=[];return this.pr.forEachInRange([n,i],(t=>{const e=this.yr(t.mr);r.push(e)})),Aa.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Va(da);return e.forEach((t=>{const e=new yu(t,0),i=new yu(t,Number.POSITIVE_INFINITY);this.pr.forEachInRange([e,i],(t=>{n=n.add(t.mr)}))})),Aa.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let r=n;Ea.isDocumentKey(r)||(r=r.child(""));const s=new yu(new Ea(r),0);let o=new Va(da);return this.pr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.mr)),!0)}),s),Aa.resolve(this.Sr(o))}Sr(t){const e=[];return t.forEach((t=>{const n=this.yr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Jo(0===this.br(e.batchId,"removed")),this.mutationQueue.shift();let n=this.pr;return Aa.forEach(e.mutations,(i=>{const r=new yu(i.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.pr=n}))}Cn(t){}containsKey(t,e){const n=new yu(e,0),i=this.pr.firstAfterOrEqual(n);return Aa.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,Aa.resolve()}br(t,e){return this.wr(t)}wr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}yr(t){const e=this.wr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class wu{constructor(t){this.Dr=t,this.docs=new xa(Ea.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),r=i?i.size:0,s=this.Dr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Aa.resolve(n?n.document.mutableCopy():fc.newInvalidDocument(e))}getEntries(t,e){let n=Jc();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():fc.newInvalidDocument(t))})),Aa.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let r=Jc();const s=e.path,o=new Ea(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Ta(ba(o),n)<=0||(i.has(o.key)||Gc(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return Aa.resolve(r)}getAllFromCollectionGroup(t,e,n,i){Xo()}vr(t,e){return Aa.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Eu(this)}getSize(t){return Aa.resolve(this.size)}}class Eu extends hu{constructor(t){super(),this.sr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.sr.addEntry(t,i)):this.sr.removeEntry(n)})),Aa.waitFor(e)}getFromCache(t,e){return this.sr.getEntry(t,e)}getAllFromCache(t,e){return this.sr.getEntries(t,e)}}class bu{constructor(t){this.persistence=t,this.Cr=new Wc((t=>Fc(t)),Vc),this.lastRemoteSnapshotVersion=ga.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new mu,this.targetCount=0,this.Or=uu.xn()}forEachTarget(t,e){return this.Cr.forEach(((t,n)=>e(n))),Aa.resolve()}getLastRemoteSnapshotVersion(t){return Aa.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Aa.resolve(this.Fr)}allocateTargetId(t){return this.highestTargetId=this.Or.next(),Aa.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Fr&&(this.Fr=e),Aa.resolve()}Ln(t){this.Cr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Or=new uu(e),this.highestTargetId=e),t.sequenceNumber>this.Fr&&(this.Fr=t.sequenceNumber)}addTargetData(t,e){return this.Ln(e),this.targetCount+=1,Aa.resolve()}updateTargetData(t,e){return this.Ln(e),Aa.resolve()}removeTargetData(t,e){return this.Cr.delete(e.target),this.Mr.Ar(e.targetId),this.targetCount-=1,Aa.resolve()}removeTargets(t,e,n){let i=0;const r=[];return this.Cr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Cr.delete(s),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),Aa.waitFor(r).next((()=>i))}getTargetCount(t){return Aa.resolve(this.targetCount)}getTargetData(t,e){const n=this.Cr.get(e)||null;return Aa.resolve(n)}addMatchingKeys(t,e,n){return this.Mr.Tr(e,n),Aa.resolve()}removeMatchingKeys(t,e,n){this.Mr.dr(e,n);const i=this.persistence.referenceDelegate,r=[];return i&&e.forEach((e=>{r.push(i.markPotentiallyOrphaned(t,e))})),Aa.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Mr.Ar(e),Aa.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Mr.Vr(e);return Aa.resolve(n)}containsKey(t,e){return Aa.resolve(this.Mr.containsKey(e))}}class Iu{constructor(t,e){this.Nr={},this.overlays={},this.Br=new ka(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=t(this),this.kr=new bu(this),this.indexManager=new au,this.remoteDocumentCache=function(t){return new wu(t)}((t=>this.referenceDelegate.qr(t))),this.serializer=new ru(e),this.Qr=new pu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new gu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Nr[t.toKey()];return n||(n=new vu(e,this.referenceDelegate),this.Nr[t.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(t,e,n){Ko("MemoryPersistence","Starting transaction:",t);const i=new Tu(this.Br.next());return this.referenceDelegate.Kr(),n(i).next((t=>this.referenceDelegate.$r(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Ur(t,e){return Aa.or(Object.values(this.Nr).map((n=>()=>n.containsKey(t,e))))}}class Tu extends Sa{constructor(t){super(),this.currentSequenceNumber=t}}class _u{constructor(t){this.persistence=t,this.Wr=new mu,this.Gr=null}static zr(t){return new _u(t)}get jr(){if(this.Gr)return this.Gr;throw Xo()}addReference(t,e,n){return this.Wr.addReference(n,e),this.jr.delete(n.toString()),Aa.resolve()}removeReference(t,e,n){return this.Wr.removeReference(n,e),this.jr.add(n.toString()),Aa.resolve()}markPotentiallyOrphaned(t,e){return this.jr.add(e.toString()),Aa.resolve()}removeTarget(t,e){this.Wr.Ar(e.targetId).forEach((t=>this.jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Kr(){this.Gr=new Set}$r(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Aa.forEach(this.jr,(n=>{const i=Ea.fromPath(n);return this.Hr(t,i).next((t=>{t||e.removeEntry(i,ga.min())}))})).next((()=>(this.Gr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hr(t,e).next((t=>{t?this.jr.delete(e.toString()):this.jr.add(e.toString())}))}qr(t){return 0}Hr(t,e){return Aa.or([()=>Aa.resolve(this.Wr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ur(t,e)])}}class Su{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Li=n,this.ki=i}static qi(t,e){let n=ol(),i=ol();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new Su(t,e.fromCache,n,i)}}class Cu{constructor(){this.Qi=!1}initialize(t,e){this.Ki=t,this.indexManager=e,this.Qi=!0}getDocumentsMatchingQuery(t,e,n,i){return this.$i(t,e).next((r=>r||this.Ui(t,e,i,n))).next((n=>n||this.Wi(t,e)))}$i(t,e){if(jc(e))return Aa.resolve(null);let n=$c(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=qc(e,null,"F"),n=$c(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const r=ol(...i);return this.Ki.getDocuments(t,r).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Gi(e,i);return this.zi(e,s,r,n.readTime)?this.$i(t,qc(e,null,"F")):this.ji(t,s,e,n)}))))})))))}Ui(t,e,n,i){return jc(e)||i.isEqual(ga.min())?this.Wi(t,e):this.Ki.getDocuments(t,n).next((r=>{const s=this.Gi(e,r);return this.zi(e,s,n,i)?this.Wi(t,e):(Ho()<=A.DEBUG&&Ko("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Kc(e)),this.ji(t,s,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=ga.fromTimestamp(1e9===i?new pa(n+1,0):new pa(n,i));return new Ia(r,Ea.empty(),e)}(i,-1)))}))}Gi(t,e){let n=new Va(function(t){return(e,n)=>{let i=!1;for(const r of Bc(t)){const t=Qc(r,e,n);if(0!==t)return t;i=i||r.field.isKeyField()}return 0}}(t));return e.forEach(((e,i)=>{Gc(t,i)&&(n=n.add(i))})),n}zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Wi(t,e){return Ho()<=A.DEBUG&&Ko("QueryEngine","Using full collection scan to execute query:",Kc(e)),this.Ki.getDocumentsMatchingQuery(t,e,Ia.min())}ji(t,e,n,i){return this.Ki.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Au{constructor(t,e,n,i){this.persistence=t,this.Hi=e,this.serializer=i,this.Ji=new xa(da),this.Yi=new Wc((t=>Fc(t)),Vc),this.Zi=new Map,this.Xi=t.getRemoteDocumentCache(),this.kr=t.getTargetCache(),this.Qr=t.getBundleCache(),this.es(n)}es(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new fu(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function Du(t,e){const n=Yo(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((r=>(i=r,n.es(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],s=[];let o=ol();for(const t of i){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ts:t,removedBatchIds:r,addedBatchIds:s})))}))}))}function ku(t,e){const n=Yo(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}class Nu{constructor(){this.activeTargetIds=al}hs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ps(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ls(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ou{constructor(){this.Hs=new Nu,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hs.hs(t),this.Js[t]||"not-current"}updateQueryState(t,e,n){this.Js[t]=e}removeLocalQueryTarget(t){this.Hs.Ps(t)}isLocalQueryTarget(t){return this.Hs.activeTargetIds.has(t)}clearQueryState(t){delete this.Js[t]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(t){return this.Hs.activeTargetIds.has(t)}start(){return this.Hs=new Nu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Lu{Ys(t){}shutdown(){}}class Ru{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(t){this.ro.push(t)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){Ko("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ro)t(0)}no(){Ko("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ro)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Pu=null;function xu(){return null===Pu?Pu=268435456+Math.round(2147483648*Math.random()):Pu++,"0x"+Pu.toString(16)}const Mu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Fu{constructor(t){this.so=t.so,this.oo=t.oo}_o(t){this.ao=t}uo(t){this.co=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.so(t)}ho(){this.ao()}Po(t){this.co(t)}Io(t){this.lo(t)}}const Vu="WebChannelConnection";class Uu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.To=e+"://"+t.host,this.Eo=`projects/${n}/databases/${i}`,this.Ao="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get Ro(){return!1}Vo(t,e,n,i,r){const s=xu(),o=this.mo(t,e);Ko("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(a,i,r),this.po(t,o,a,n).then((e=>(Ko("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Qo("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}yo(t,e,n,i,r,s){return this.Vo(t,e,n,i,r)}fo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+qo,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}mo(t,e){const n=Mu[t];return`${this.To}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}po(t,e,n,i){const r=xu();return new Promise(((s,o)=>{const a=new Uo;a.setWithCredentials(!0),a.listenOnce(Po.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Ro.NO_ERROR:const e=a.getResponseJson();Ko(Vu,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),s(e);break;case Ro.TIMEOUT:Ko(Vu,`RPC '${t}' ${r} timed out`),o(new ta(Zo.DEADLINE_EXCEEDED,"Request time out"));break;case Ro.HTTP_ERROR:const n=a.getStatus();if(Ko(Vu,`RPC '${t}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Zo).indexOf(e)>=0?e:Zo.UNKNOWN}(e.status);o(new ta(t,e.message))}else o(new ta(Zo.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ta(Zo.UNAVAILABLE,"Connection failed."));break;default:Xo()}}finally{Ko(Vu,`RPC '${t}' ${r} completed.`)}}));const c=JSON.stringify(i);Ko(Vu,`RPC '${t}' ${r} sending request:`,i),a.send(e,"POST",c,n,15)}))}wo(t,e,n){const i=xu(),r=[this.To,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Oo(),o=Lo(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Fo({})),this.fo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const l=r.join("");Ko(Vu,`Creating RPC '${t}' stream ${i}: ${l}`,a);const u=s.createWebChannel(l,a);let h=!1,d=!1;const f=new Fu({so:e=>{d?Ko(Vu,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(h||(Ko(Vu,`Opening RPC '${t}' stream ${i} transport.`),u.open(),h=!0),Ko(Vu,`RPC '${t}' stream ${i} sending:`,e),u.send(e))},oo:()=>u.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(u,Vo.EventType.OPEN,(()=>{d||Ko(Vu,`RPC '${t}' stream ${i} transport opened.`)})),p(u,Vo.EventType.CLOSE,(()=>{d||(d=!0,Ko(Vu,`RPC '${t}' stream ${i} transport closed`),f.Po())})),p(u,Vo.EventType.ERROR,(e=>{d||(d=!0,Qo(Vu,`RPC '${t}' stream ${i} transport errored:`,e),f.Po(new ta(Zo.UNAVAILABLE,"The operation could not be completed")))})),p(u,Vo.EventType.MESSAGE,(e=>{var n;if(!d){const r=e.data[0];Jo(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){Ko(Vu,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=ql[t];if(void 0!==e)return function(t){if(void 0===t)return Go("GRPC error has no .code"),Zo.UNKNOWN;switch(t){case ql.OK:return Zo.OK;case ql.CANCELLED:return Zo.CANCELLED;case ql.UNKNOWN:return Zo.UNKNOWN;case ql.DEADLINE_EXCEEDED:return Zo.DEADLINE_EXCEEDED;case ql.RESOURCE_EXHAUSTED:return Zo.RESOURCE_EXHAUSTED;case ql.INTERNAL:return Zo.INTERNAL;case ql.UNAVAILABLE:return Zo.UNAVAILABLE;case ql.UNAUTHENTICATED:return Zo.UNAUTHENTICATED;case ql.INVALID_ARGUMENT:return Zo.INVALID_ARGUMENT;case ql.NOT_FOUND:return Zo.NOT_FOUND;case ql.ALREADY_EXISTS:return Zo.ALREADY_EXISTS;case ql.PERMISSION_DENIED:return Zo.PERMISSION_DENIED;case ql.FAILED_PRECONDITION:return Zo.FAILED_PRECONDITION;case ql.ABORTED:return Zo.ABORTED;case ql.OUT_OF_RANGE:return Zo.OUT_OF_RANGE;case ql.UNIMPLEMENTED:return Zo.UNIMPLEMENTED;case ql.DATA_LOSS:return Zo.DATA_LOSS;default:return Xo()}}(e)}(e),r=o.message;void 0===n&&(n=Zo.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),d=!0,f.Po(new ta(n,r)),u.close()}else Ko(Vu,`RPC '${t}' stream ${i} received:`,r),f.Io(r)}})),p(o,xo.STAT_EVENT,(e=>{e.stat===Mo.PROXY?Ko(Vu,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Mo.NOPROXY&&Ko(Vu,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.ho()}),0),f}}function ju(){return"undefined"!=typeof document?document:null}function Bu(t){return new Hl(t,!0)}class $u{constructor(t,e,n=1e3,i=1.5,r=6e4){this.ii=t,this.timerId=e,this.So=n,this.bo=i,this.Do=r,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(t){this.cancel();const e=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),i=Math.max(0,e-n);i>0&&Ko("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.vo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Fo=Date.now(),t()))),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class qu{constructor(t,e,n,i,r,s,o,a){this.ii=t,this.Bo=n,this.Lo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new $u(t,e)}$o(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&null===this.qo&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,(()=>this.jo())))}Ho(t){this.Jo(),this.stream.send(t)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(t,e){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,4!==t?this.Ko.reset():e&&e.code===Zo.RESOURCE_EXHAUSTED?(Go(e.toString()),Go("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):e&&e.code===Zo.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Zo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.uo(e)}Zo(){}auth(){this.state=1;const t=this.Xo(this.ko),e=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.ko===e&&this.e_(t,n)}),(e=>{t((()=>{const t=new ta(Zo.UNKNOWN,"Fetching auth token failed: "+e.message);return this.t_(t)}))}))}e_(t,e){const n=this.Xo(this.ko);this.stream=this.n_(t,e),this.stream._o((()=>{n((()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,(()=>(this.Uo()&&(this.state=3),Promise.resolve()))),this.listener._o())))})),this.stream.uo((t=>{n((()=>this.t_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Wo(){this.state=5,this.Ko.xo((async()=>{this.state=0,this.start()}))}t_(t){return Ko("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.ko===t?e():(Ko("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class zu extends qu{constructor(t,e,n,i,r,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r,this.o_=!1}get __(){return this.o_}start(){this.o_=!1,this.lastStreamToken=void 0,super.start()}Zo(){this.o_&&this.a_([])}n_(t,e){return this.connection.wo("Write",t,e)}onMessage(t){if(Jo(!!t.streamToken),this.lastStreamToken=t.streamToken,this.o_){this.Ko.reset();const e=function(t,e){return t&&t.length>0?(Jo(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Wl(t.updateTime):Wl(e);return n.isEqual(ga.min())&&(n=Wl(e)),new _l(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Wl(t.commitTime);return this.listener.u_(n,e)}return Jo(!t.writeResults||0===t.writeResults.length),this.o_=!0,this.listener.c_()}l_(){const t={};t.database=function(t){return new ya(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}(this.serializer),this.Ho(t)}a_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof Rl)n={update:Zl(t,e.key,e.value)};else if(e instanceof Vl)n={delete:Jl(t,e.key)};else if(e instanceof Pl)n={update:Zl(t,e.key,e.data),updateMask:iu(e.fieldMask)};else{if(!(e instanceof Ul))return Xo();n={verify:Jl(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof gl)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ml)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof vl)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof El)return{fieldPath:e.field.canonicalString(),increment:n.Te};throw Xo()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ql(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Xo()}(t,e.precondition)),n}(this.serializer,t)))};this.Ho(e)}}class Hu extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.h_=!1}P_(){if(this.h_)throw new ta(Zo.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(t,e,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Vo(t,e,n,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ta(Zo.UNKNOWN,t.toString())}))}yo(t,e,n,i){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.yo(t,e,n,r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Zo.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ta(Zo.UNKNOWN,t.toString())}))}terminate(){this.h_=!0}}class Ku{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){0===this.T_&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve()))))}m_(t){"Online"===this.state?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.R_("Offline")))}set(t){this.f_(),this.T_=0,"Online"===t&&(this.d_=!1),this.R_(t)}R_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}V_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(Go(e),this.d_=!1):Ko("OnlineStateTracker",e)}f_(){null!==this.E_&&(this.E_.cancel(),this.E_=null)}}class Gu{constructor(t,e,n,i,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=r,this.S_.Ys((t=>{n.enqueueAndForget((async()=>{Xu(this)&&(Ko("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Yo(t);e.y_.add(4),await Wu(e),e.b_.set("Unknown"),e.y_.delete(4),await Qu(e)}(this))}))})),this.b_=new Ku(n,i)}}async function Qu(t){if(Xu(t))for(const e of t.w_)await e(!0)}async function Wu(t){for(const e of t.w_)await e(!1)}function Xu(t){return 0===Yo(t).y_.size}async function Ju(t,e,n){if(!Da(e))throw e;t.y_.add(1),await Wu(t),t.b_.set("Offline"),n||(n=()=>function(t){const e=Yo(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.kr.getLastRemoteSnapshotVersion(t)))}(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ko("RemoteStore","Retrying IndexedDB access"),await n(),t.y_.delete(1),await Qu(t)}))}function Yu(t,e){return e().catch((n=>Ju(t,n,e)))}async function Zu(t){const e=Yo(t),n=lh(e);let i=e.g_.length>0?e.g_[e.g_.length-1].batchId:-1;for(;th(e);)try{const t=await ku(e.localStore,i);if(null===t){0===e.g_.length&&n.zo();break}i=t.batchId,eh(e,t)}catch(t){await Ju(e,t)}nh(e)&&ih(e)}function th(t){return Xu(t)&&t.g_.length<10}function eh(t,e){t.g_.push(e);const n=lh(t);n.Uo()&&n.__&&n.a_(e.mutations)}function nh(t){return Xu(t)&&!lh(t).$o()&&t.g_.length>0}function ih(t){lh(t).start()}async function rh(t){lh(t).l_()}async function sh(t){const e=lh(t);for(const n of t.g_)e.a_(n.mutations)}async function oh(t,e,n){const i=t.g_.shift(),r=Bl.from(i,e,n);await Yu(t,(()=>t.remoteSyncer.applySuccessfulWrite(r))),await Zu(t)}async function ah(t,e){e&&lh(t).__&&await async function(t,e){if(function(t){return function(t){switch(t){default:return Xo();case Zo.CANCELLED:case Zo.UNKNOWN:case Zo.DEADLINE_EXCEEDED:case Zo.RESOURCE_EXHAUSTED:case Zo.INTERNAL:case Zo.UNAVAILABLE:case Zo.UNAUTHENTICATED:return!1;case Zo.INVALID_ARGUMENT:case Zo.NOT_FOUND:case Zo.ALREADY_EXISTS:case Zo.PERMISSION_DENIED:case Zo.FAILED_PRECONDITION:case Zo.ABORTED:case Zo.OUT_OF_RANGE:case Zo.UNIMPLEMENTED:case Zo.DATA_LOSS:return!0}}(t)&&t!==Zo.ABORTED}(e.code)){const n=t.g_.shift();lh(t).Go(),await Yu(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await Zu(t)}}(t,e),nh(t)&&ih(t)}async function ch(t,e){const n=Yo(t);n.asyncQueue.verifyOperationInProgress(),Ko("RemoteStore","RemoteStore received new credentials");const i=Xu(n);n.y_.add(3),await Wu(n),i&&n.b_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.y_.delete(3),await Qu(n)}function lh(t){return t.C_||(t.C_=function(t,e,n){const i=Yo(t);return i.P_(),new zu(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{_o:rh.bind(null,t),uo:ah.bind(null,t),c_:sh.bind(null,t),u_:oh.bind(null,t)}),t.w_.push((async e=>{e?(t.C_.Go(),await Zu(t)):(await t.C_.stop(),t.g_.length>0&&(Ko("RemoteStore",`Stopping write stream with ${t.g_.length} pending writes`),t.g_=[]))}))),t.C_}class uh{constructor(t,e,n,i,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new ea,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,r){const s=Date.now()+n,o=new uh(t,e,s,i,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ta(Zo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hh(t,e){if(Go("AsyncQueue",`${e}: ${t}`),Da(t))return new ta(Zo.UNAVAILABLE,`${e}: ${t}`);throw t}class dh{constructor(){this.queries=new Wc((t=>Hc(t)),zc),this.onlineState="Unknown",this.O_=new Set}}class fh{constructor(t,e,n,i,r,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Ta={},this.Ea=new Wc((t=>Hc(t)),zc),this.da=new Map,this.Aa=new Set,this.Ra=new xa(Ea.comparator),this.Va=new Map,this.ma=new mu,this.fa={},this.ga=new Map,this.pa=uu.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return!0===this.ya}}function ph(t,e,n){const i=Yo(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.Ea.forEach(((n,i)=>{const r=i.view.N_(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=Yo(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.N_(e)&&(i=!0)})),i&&function(t){t.O_.forEach((t=>{t.next()}))}(n)}(i.eventManager,e),t.length&&i.Ta.r_(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function gh(t,e){const n=Yo(t),i=e.batch.batchId;try{const t=await function(t,e){const n=Yo(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const i=e.batch.keys(),r=n.Xi.newChangeBuffer({trackRemovals:!0});return function(t,e,n,i){const r=n.batch,s=r.keys();let o=Aa.resolve();return s.forEach((t=>{o=o.next((()=>i.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Jo(null!==s),e.version.compareTo(s)<0&&(r.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),i.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,r)))}(n,t,e,r).next((()=>r.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ol();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(n.localStore,e);vh(n,i,null),yh(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await wh(n,t)}catch(t){await Ca(t)}}async function mh(t,e,n){const i=Yo(t);try{const t=await function(t,e){const n=Yo(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let i;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Jo(null!==e),i=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,i,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,i))).next((()=>n.localDocuments.getDocuments(t,i)))}))}(i.localStore,e);vh(i,e,n),yh(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await wh(i,t)}catch(n){await Ca(n)}}function yh(t,e){(t.ga.get(e)||[]).forEach((t=>{t.resolve()})),t.ga.delete(e)}function vh(t,e,n){const i=Yo(t);let r=i.fa[i.currentUser.toKey()];if(r){const t=r.get(e);t&&(n?t.reject(n):t.resolve(),r=r.remove(e)),i.fa[i.currentUser.toKey()]=r}}async function wh(t,e,n){const i=Yo(t),r=[],s=[],o=[];i.Ea.isEmpty()||(i.Ea.forEach(((t,a)=>{o.push(i.wa(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=Su.qi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),i.Ta.r_(r),await async function(t,e){const n=Yo(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Aa.forEach(e,(e=>Aa.forEach(e.Li,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>Aa.forEach(e.ki,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!Da(t))throw t;Ko("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,r)}}}(i.localStore,s))}async function Eh(t,e){const n=Yo(t);if(!n.currentUser.isEqual(e)){Ko("SyncEngine","User change. New user:",e.toKey());const t=await Du(n.localStore,e);n.currentUser=e,function(t,e){t.ga.forEach((t=>{t.forEach((t=>{t.reject(new ta(Zo.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ga.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await wh(n,t.ts)}}function bh(t){const e=Yo(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=gh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=mh.bind(null,e),e}class Ih{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Bu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,i){return new Au(t,e,n,i)}(this.persistence,new Cu,t.initialUser,this.serializer)}createPersistence(t){return new Iu(_u.zr,this.serializer)}createSharedClientState(t){return new Ou}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Th{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>ph(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Eh.bind(null,this.syncEngine),await async function(t,e){const n=Yo(t);e?(n.y_.delete(2),await Qu(n)):e||(n.y_.add(2),await Wu(n),n.b_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new dh}createDatastore(t){const e=Bu(t.databaseInfo.databaseId),n=function(t){return new Uu(t)}(t.databaseInfo);return function(t,e,n,i){return new Hu(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,i,r){return new Gu(t,e,n,i,r)}(this.localStore,this.datastore,t.asyncQueue,(t=>ph(this.syncEngine,t,0)),Ru.v()?new Ru:new Lu)}createSyncEngine(t,e){return function(t,e,n,i,r,s,o){const a=new fh(t,e,n,i,r,s);return o&&(a.ya=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Yo(t);Ko("RemoteStore","RemoteStore shutting down."),e.y_.add(5),await Wu(e),e.S_.shutdown(),e.b_.set("Unknown")}(this.remoteStore)}}class _h{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=$o.UNAUTHENTICATED,this.clientId=ha.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Ko("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Ko("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new ta(Zo.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ea;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=hh(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Sh(t,e){t.asyncQueue.verifyOperationInProgress(),Ko("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await Du(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function Ch(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ko("FirestoreClient","Using user provided OfflineComponentProvider");try{await Sh(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Zo.FAILED_PRECONDITION||t.code===Zo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Qo("Error using user provided cache. Falling back to memory cache: "+n),await Sh(t,new Ih)}}else Ko("FirestoreClient","Using default OfflineComponentProvider"),await Sh(t,new Ih);return t._offlineComponents}(t);Ko("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>ch(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>ch(e.remoteStore,n))),t._onlineComponents=e}function Ah(t){return async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ko("FirestoreClient","Using user provided OnlineComponentProvider"),await Ch(t,t._uninitializedComponentsProvider._online)):(Ko("FirestoreClient","Using default OnlineComponentProvider"),await Ch(t,new Th))),t._onlineComponents}(t).then((t=>t.syncEngine))}function Dh(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const kh=new Map;function Nh(t,e,n){if(!n)throw new ta(Zo.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Oh(t){if(!Ea.isDocumentKey(t))throw new ta(Zo.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Lh(t){if(Ea.isDocumentKey(t))throw new ta(Zo.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Rh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Xo()}function Ph(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ta(Zo.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Rh(t);throw new ta(Zo.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class xh{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new ta(Zo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ta(Zo.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new ta(Zo.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Dh(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new ta(Zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new ta(Zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new ta(Zo.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Mh{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new xh({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new ta(Zo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new ta(Zo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new xh(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new ia;switch(t.type){case"firstParty":return new aa(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new ta(Zo.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=kh.get(t);e&&(Ko("ComponentProvider","Removing Datastore"),kh.delete(t),e.terminate())}(this),Promise.resolve()}}class Fh{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Fh(this.firestore,t,this._query)}}class Vh{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Uh(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Vh(this.firestore,t,this._key)}}class Uh extends Fh{constructor(t,e,n){super(t,e,function(t){return new Uc(t)}(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Vh(this.firestore,null,new Ea(t))}withConverter(t){return new Uh(this.firestore,t,this._path)}}function jh(t,e,...n){if(t=b(t),Nh("collection","path",e),t instanceof Mh){const i=ya.fromString(e,...n);return Lh(i),new Uh(t,null,i)}{if(!(t instanceof Vh||t instanceof Uh))throw new ta(Zo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ya.fromString(e,...n));return Lh(i),new Uh(t.firestore,null,i)}}function Bh(t,e,...n){if(t=b(t),1===arguments.length&&(e=ha.V()),Nh("doc","path",e),t instanceof Mh){const i=ya.fromString(e,...n);return Oh(i),new Vh(t,null,new Ea(i))}{if(!(t instanceof Vh||t instanceof Uh))throw new ta(Zo.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ya.fromString(e,...n));return Oh(i),new Vh(t.firestore,t instanceof Uh?t.converter:null,new Ea(i))}}class $h{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new $u(this,"async_queue_retry"),this.Xa=()=>{const t=ju();t&&Ko("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const t=ju();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.eu(),this.tu(t)}enterRestrictedMode(t){if(!this.za){this.za=!0,this.Ya=t||!1;const e=ju();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xa)}}enqueue(t){if(this.eu(),this.za)return new Promise((()=>{}));const e=new ea;return this.tu((()=>this.za&&this.Ya?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Ga.push(t),this.nu())))}async nu(){if(0!==this.Ga.length){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(t){if(!Da(t))throw t;Ko("AsyncQueue","Operation failed with retryable error: "+t)}this.Ga.length>0&&this.Ko.xo((()=>this.nu()))}}tu(t){const e=this.Wa.then((()=>(this.Ja=!0,t().catch((t=>{this.Ha=t,this.Ja=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Go("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ja=!1,t))))));return this.Wa=e,e}enqueueAfterDelay(t,e,n){this.eu(),this.Za.indexOf(t)>-1&&(e=0);const i=uh.createAndSchedule(this,t,e,n,(t=>this.ru(t)));return this.ja.push(i),i}eu(){this.Ha&&Xo()}verifyOperationInProgress(){}async iu(){let t;do{t=this.Wa,await t}while(t!==this.Wa)}su(t){for(const e of this.ja)if(e.timerId===t)return!0;return!1}ou(t){return this.iu().then((()=>{this.ja.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.ja)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.iu()}))}_u(t){this.Za.push(t)}ru(t){const e=this.ja.indexOf(t);this.ja.splice(e,1)}}class qh extends Mh{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new $h,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||zh(this),this._firestoreClient.terminate()}}function zh(t){var e,n,i;const r=t._freezeSettings(),s=function(t,e,n,i){return new Xa(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Dh(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new _h(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class Hh{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Hh($a.fromBase64String(t))}catch(t){throw new ta(Zo.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Hh($a.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Kh{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new ta(Zo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wa(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Gh{constructor(t){this._methodName=t}}class Qh{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new ta(Zo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ta(Zo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return da(this._lat,t._lat)||da(this._long,t._long)}}const Wh=/^__.*__$/;class Xh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Pl(t,this.data,this.fieldMask,e,this.fieldTransforms):new Rl(t,this.data,e,this.fieldTransforms)}}class Jh{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Pl(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Yh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xo()}}class Zh{constructor(t,e,n,i,r,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.au(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get uu(){return this.settings.uu}cu(t){return new Zh(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}lu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.cu({path:n,hu:!1});return i.Pu(t),i}Iu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.cu({path:n,hu:!1});return i.au(),i}Tu(t){return this.cu({path:void 0,hu:!0})}Eu(t){return dd(t,this.settings.methodName,this.settings.du||!1,this.path,this.settings.Au)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}au(){if(this.path)for(let t=0;t<this.path.length;t++)this.Pu(this.path.get(t))}Pu(t){if(0===t.length)throw this.Eu("Document fields must not be empty");if(Yh(this.uu)&&Wh.test(t))throw this.Eu('Document fields cannot begin and end with "__"')}}class td{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Bu(t)}Ru(t,e,n,i=!1){return new Zh({uu:t,methodName:e,Au:n,path:wa.emptyPath(),hu:!1,du:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ed(t){const e=t._freezeSettings(),n=Bu(t._databaseId);return new td(t._databaseId,!!e.ignoreUndefinedProperties,n)}function nd(t,e,n,i,r,s={}){const o=t.Ru(s.merge||s.mergeFields?2:0,e,n,r);cd("Data must be an object, but it was:",o,i);const a=od(i,o);let c,l;if(s.merge)c=new ja(o.fieldMask),l=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const i of s.mergeFields){const r=ld(e,i,n);if(!o.contains(r))throw new ta(Zo.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);fd(t,r)||t.push(r)}c=new ja(t),l=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,l=o.fieldTransforms;return new Xh(new hc(a),c,l)}class id extends Gh{_toFieldTransform(t){if(2!==t.uu)throw 1===t.uu?t.Eu(`${this._methodName}() can only appear at the top level of your update data`):t.Eu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof id}}class rd extends Gh{_toFieldTransform(t){return new Tl(t.path,new gl)}isEqual(t){return t instanceof rd}}function sd(t,e){if(ad(t=b(t)))return cd("Unsupported field value:",e,t),od(t,e);if(t instanceof Gh)return function(t,e){if(!Yh(e.uu))throw e.Eu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Eu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.hu&&4!==e.uu)throw e.Eu("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const r of t){let t=sd(r,e.Tu(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=b(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ul(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=pa.fromDate(t);return{timestampValue:Kl(e.serializer,n)}}if(t instanceof pa){const n=new pa(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Kl(e.serializer,n)}}if(t instanceof Qh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Hh)return{bytesValue:Gl(e.serializer,t._byteString)};if(t instanceof Vh){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.Eu(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Xl(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Eu(`Unsupported field value: ${Rh(t)}`)}(t,e)}function od(t,e){const n={};return Pa(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ra(t,((t,i)=>{const r=sd(i,e.lu(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}function ad(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof pa||t instanceof Qh||t instanceof Hh||t instanceof Vh||t instanceof Gh)}function cd(t,e,n){if(!ad(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=Rh(n);throw"an object"===i?e.Eu(t+" a custom object"):e.Eu(t+" "+i)}}function ld(t,e,n){if((e=b(e))instanceof Kh)return e._internalPath;if("string"==typeof e)return hd(t,e);throw dd("Field path arguments must be of type string or ",t,!1,void 0,n)}const ud=new RegExp("[~\\*/\\[\\]]");function hd(t,e,n){if(e.search(ud)>=0)throw dd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Kh(...e.split("."))._internalPath}catch(i){throw dd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function dd(t,e,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new ta(Zo.INVALID_ARGUMENT,a+t+c)}function fd(t,e){return t.some((t=>t.isEqual(e)))}function pd(t,e){return function(t,e){const n=new ea;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const i=bh(t);try{const t=await function(t,e){const n=Yo(t),i=pa.now(),r=e.reduce(((t,e)=>t.add(e.key)),ol());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=Jc(),c=ol();return n.Xi.getEntries(t,r).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((r=>{s=r;const o=[];for(const t of e){const e=Ol(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Pl(t.key,e,dc(e.value.mapValue),Sl.exists(!0)))}return n.mutationQueue.addMutationBatch(t,i,o,e)})).next((e=>{o=e;const i=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:tl(s)})))}(i.localStore,e);i.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let i=t.fa[t.currentUser.toKey()];i||(i=new xa(da)),i=i.insert(e,n),t.fa[t.currentUser.toKey()]=i}(i,t.batchId,n),await wh(i,t.changes),await Zu(i.remoteStore)}catch(t){const e=hh(t,"Failed to persist write");n.reject(e)}}(await Ah(t),e,n))),n.promise}(function(t){return t._firestoreClient||zh(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(t),e)}!function(t,e=!0){qo="10.1.0",ot(new I("firestore",((t,{instanceIdentifier:n,options:i})=>{const r=t.getProvider("app").getImmediate(),s=new qh(new sa(t.getProvider("auth-internal")),new la(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ta(Zo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ja(t.options.projectId,e)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),dt(Bo,"4.1.0",t),dt(Bo,"4.1.0","esm2017")}();const gd=function(t,e){const n="string"==typeof t?t:"(default)",i=at("object"==typeof t?t:ht(),"firestore").getImmediate({identifier:n});if(!i._initialized){const t=o("firestore");t&&function(t,e,n,i={}){var s;const o=(t=Ph(t,Mh))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Qo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=$o.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new ta(Zo.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new $o(o)}t._authCredentials=new ra(new na(e,n))}}(i,...t)}return i}(sn);async function md(t){if("localhost"==window.location.hostname||"127.0.0.1"==window.location.hostname)return;let e=localStorage.getItem("analyticsID_v1");e||(e=Bh(jh(gd,"Analytics")).id,localStorage.setItem("analyticsID_v1",e),await function(t,e,n,...i){t=Ph(t,Vh);const r=Ph(t.firestore,qh),s=ed(r);let o;return o="string"==typeof(e=b(e))||e instanceof Kh?function(t,e,n,i,r,s){const o=t.Ru(1,e,n),a=[ld(e,i,n)],c=[r];if(s.length%2!=0)throw new ta(Zo.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)a.push(ld(e,s[t])),c.push(s[t+1]);const l=[],u=hc.empty();for(let t=a.length-1;t>=0;--t)if(!fd(l,a[t])){const e=a[t];let n=c[t];n=b(n);const i=o.Iu(e);if(n instanceof id)l.push(e);else{const t=sd(n,i);null!=t&&(l.push(e),u.set(e,t))}}const h=new ja(l);return new Jh(u,h,o.fieldTransforms)}(s,"updateDoc",t._key,e,n,i):function(t,e,n,i){const r=t.Ru(1,e,n);cd("Data must be an object, but it was:",r,i);const s=[],o=hc.empty();Ra(i,((t,i)=>{const a=hd(e,t,n);i=b(i);const c=r.Iu(a);if(i instanceof id)s.push(a);else{const t=sd(i,c);null!=t&&(s.push(a),o.set(a,t))}}));const a=new ja(s);return new Jh(o,a,r.fieldTransforms)}(s,"updateDoc",t._key,e),pd(r,[o.toMutation(t._key,Sl.exists(!0))])}(Bh(gd,"Analytics","_Aggregate"),{analyticsIDs:firebase.firestore.FieldValue.arrayUnion(e)})),await function(t,e){const n=Ph(t.firestore,qh),i=Bh(t),r=function(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}(t.converter,void 0);return pd(n,[nd(ed(t.firestore),"addDoc",i._key,r,null!==t.converter,{}).toMutation(i._key,Sl.exists(!1))]).then((()=>i))}(jh(gd,"Analytics")),new rd("serverTimestamp"),window.location.pathname}new URLSearchParams(document.location.search).get("source")&&md();const yd=function(t=ht(),e=gn){const n=at(b(t),hn).getImmediate({identifier:e}),i=o("functions");return i&&function(t,e,n){!function(t,e,n){t.emulatorOrigin=`http://${e}:${n}`}(b(t),e,n)}(n,...i),n}(sn);window.goForwardToQuestion=_d,window.goBackAQuestion=function(){const t=document.getElementById(`question_${bd[bd.length-1]}`).parentNode,e=document.getElementById(`question_${bd[bd.length-2]}`).parentNode;t.classList.remove("open"),e.classList.remove("closed"),Sd(),bd.pop(),Id.pop(),Cd()},window.submitQuestionnaire=async function(){const t=document.getElementById("questionnaire_name"),e=document.getElementById("questionnaire_phone"),n=("dayOfWeek",document.querySelector('input[name="dayOfWeek"]:checked')),i=document.getElementById("questionnaire_time"),r=document.getElementById("questionnaire_submit"),s=document.getElementById("questionnaire_error");var o;if(r.classList.add("loading"),r.disabled=!0,function(t,e){t.forEach((t=>{t.classList.remove("invalid")})),e.textContent=""}([t,e,i],s),!function(t){let e=!0;return t.forEach((t=>{t.value||(t.classList.add("invalid"),e=!1)})),e}([t,e,i]))return s.textContent="Please fill in these required fields.",r.classList.remove("loading"),void(r.disabled=!1);if(o=e.value,!/^\([0-9]{3}\)\s[0-9]{3}\-[0-9]{4}$/.test(o))return email.classList.add("invalid"),s.textContent="There seems to be something wrong with this phone number.",r.classList.remove("loading"),void(r.disabled=!1);try{md(e.value),await async function(t,e,n,i,r){return(await bn(yd,"home-sendQuestionnaireRequest")({name:t,phone:e,day:n,time:i,answers:r,type:"questionnaire",page:"home",timestamp:new Date})).data}(t.value,e.value,n.value,i.value,Id.toString().replaceAll(",",", ")),r.classList.remove("loading"),r.disabled=!1,_d(8,{name:t.value,phone:e.value})}catch(s){s.textContent="We are having issues submitting this request. Please try again.",r.classList.remove("loading"),r.disabled=!1}},window.resetQuestionnaire=function(){document.querySelectorAll('.questionnaire input[type="checkbox"]').forEach((t=>t.checked=!1)),document.querySelectorAll('.questionnaire input[type="text"]').forEach((t=>t.value="")),document.querySelectorAll('.questionnaire input[type="email"]').forEach((t=>t.value="")),document.querySelectorAll(".questionnaire .panel").forEach((t=>{t.classList.remove("open"),t.classList.remove("closed")})),document.getElementById("question_0").parentNode.classList.add("open"),bd=[0],Id=[],Cd()},window.addEventListener("DOMContentLoaded",(function(){vd=document.getAnimations().filter((t=>t.effect.target.matches(".about-details .content"))),vd.forEach(((t,e,n)=>{t.onfinish=()=>{t.currentTime=0;let i=(e+1)%n.length,r=n[i];r.currentTime=0,r.effect.target.parentElement.querySelector(".about-details .about_toggle").checked=!0}})),Sd(),function(){const t=document.querySelector("header"),e=document.querySelector(".hero"),n=(new IntersectionObserver(((e,n)=>{e.forEach((e=>{e.isIntersecting?t.classList.add("nav-start"):t.classList.remove("nav-start")}))}),{rootMargin:"-80% 0px 0px 0px"}),{threshold:0});new IntersectionObserver(((t,e)=>{t.forEach((t=>{t.isIntersecting?document.getAnimations().forEach((e=>{t.target.contains(e.effect.target)&&e.play()})):document.getAnimations().forEach((e=>{t.target.contains(e.effect.target)&&e.pause()}))}))}),n).observe(e),new IntersectionObserver(((t,e)=>{t.forEach((t=>{t.isIntersecting?document.getAnimations().forEach((e=>{t.target.contains(e.effect.target)&&e.effect.target.parentNode.querySelector(".about_toggle").checked&&e.play()})):document.getAnimations().forEach((e=>{t.target.contains(e.effect.target)&&e.pause()}))}))}),n)}()}));let vd=[];const wd=document.querySelector(".about");async function Ed(){wd.style.height="auto",await async function(t){const e=t.clientHeight;await(100,new Promise((t=>setTimeout(t,100))));return e!=t.clientHeight}(wd)?Ed():wd.style.height=wd.clientHeight+"px"}document.querySelectorAll(".about-details .about_toggle").forEach((t=>{t.addEventListener("change",(()=>{vd.forEach((t=>{t.currentTime=0}))}))})),document.querySelector("#contactForm").addEventListener("submit",(async t=>{t.preventDefault();let e=t.target.querySelector('input[type="submit"]');e.disabled=!0,e.value="···";let n=new FormData(t.target),i=Object.fromEntries(n.entries());i.timestamp=(new Date).getTime(),bn(yd,"home-sendContactRequest")(i).then((()=>{t.target.reset(),e.value="We got it!",md(i.email)})).catch((t=>{alert("We had an issue receiving your contact info. Please try again."),e.disabled=!1,e.value="Enroll"}))})),setTimeout(Ed,500),setTimeout(Ed,1e3),window.addEventListener("resize",Ed);let bd=[0],Id=[];const Td=3;function _d(t,e){const n=document.getElementById(`question_${bd[bd.length-1]}`).parentNode,i=document.getElementById(`question_${t}`).parentNode;n.classList.add("closed"),i.classList.add("open"),Sd(),bd.push(t),Id.push(e),Cd()}function Sd(){const t=function(t){const e=Array.from(t.children).reduce(((t,e)=>{const n=window.getComputedStyle(e),i=parseFloat(n.marginTop)+parseFloat(n.marginBottom);return t+(e.offsetHeight+i)}),0),n=window.getComputedStyle(t);return e+(parseFloat(n.paddingTop)+parseFloat(n.paddingBottom))}(document.querySelector("#questionnaireSection .panel.open:not(.closed)"));document.querySelector("#questionnaireSection").style.minHeight=t+48+"px"}function Cd(){const t=document.getElementById("progress_number"),e=document.getElementById("progress_fill");t.textContent=bd.length,e.style.width=bd.length/Td*100+"%"}})();