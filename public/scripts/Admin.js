/*! For license information please see Admin.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let r=t.charCodeAt(i);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&i+1<t.length&&56320==(64512&t.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++i)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let e=0;e<t.length;e+=3){const r=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=r>>2,h=(3&r)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),i.push(n[u],n[h],n[l],n[d])}return i.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,i=0;for(;n<t.length;){const r=t[n++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=t[n++];e[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[i++]=String.fromCharCode(55296+(s>>10)),e[i++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new i;const u=s<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class i extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const r=function(t){return function(t){const i=e(t);return n.encodeByteArray(i,!0)}(t).replace(/\./g,"")},s=function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null},o=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&s(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},a=t=>{var e,n;return null===(n=null===(e=o())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]},c=()=>{var t;return null===(t=o())||void 0===t?void 0:t.config},u=t=>{var e;return null===(e=o())||void 0===e?void 0:e[`_${t}`]};class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function f(){try{return"object"==typeof indexedDB}catch(t){return!1}}function p(){return new Promise(((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var t;e((null===(t=r.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}))}class g extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,m.prototype.create)}}class m{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},i=`${this.service}/${t}`,r=this.errors[t],s=r?function(t,e){return t.replace(y,((t,n)=>{const i=e[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new g(i,o,n)}}const y=/\{\$([^}]+)}/g;function v(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const r of n){if(!i.includes(r))return!1;const n=t[r],s=e[r];if(w(n)&&w(s)){if(!v(n,s))return!1}else if(n!==s)return!1}for(const t of i)if(!n.includes(t))return!1;return!0}function w(t){return null!==t&&"object"==typeof t}function I(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach((t=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(t))})):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function _(t){const e={};return t.replace(/^\?/,"").split("&").forEach((t=>{if(t){const[n,i]=t.split("=");e[decodeURIComponent(n)]=decodeURIComponent(i)}})),e}function b(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}class E{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then((()=>{t(this)})).catch((t=>{this.error(t)}))}next(t){this.forEachObserver((e=>{e.next(t)}))}error(t){this.forEachObserver((e=>{e.error(t)})),this.close(t)}complete(){this.forEachObserver((t=>{t.complete()})),this.close()}subscribe(t,e,n){let i;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");i=function(t,e){if("object"!=typeof t||null===t)return!1;for(const e of["next","error","complete"])if(e in t&&"function"==typeof t[e])return!0;return!1}(t)?t:{next:t,error:e,complete:n},void 0===i.next&&(i.next=T),void 0===i.error&&(i.error=T),void 0===i.complete&&(i.complete=T);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(t){}})),this.observers.push(i),r}unsubscribeOne(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[t])try{e(this.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}}))}close(t){this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function T(){}const S=1e3,C=2,k=144e5,A=.5;function D(t,e=S,n=C){const i=e*Math.pow(n,t),r=Math.round(A*i*(Math.random()-.5)*2);return Math.min(k,i+r)}function N(t){return t&&t._delegate?t._delegate:t}class R{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const O="[DEFAULT]";class P{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new h;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),i=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(i)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:O})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=O){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=O){return this.instances.has(t)}getOptions(t=O){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(i);return i}onInit(t,e){var n;const i=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&t(s,i),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const i of n)try{i(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===O?void 0:i),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var i;return n||null}normalizeInstanceIdentifier(t=O){return this.component?this.component.multipleInstances?t:O:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new P(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const M=[];var x,F;(F=x||(x={}))[F.DEBUG=0]="DEBUG",F[F.VERBOSE=1]="VERBOSE",F[F.INFO=2]="INFO",F[F.WARN=3]="WARN",F[F.ERROR=4]="ERROR",F[F.SILENT=5]="SILENT";const U={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},V=x.INFO,j={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},$=(t,e,...n)=>{if(e<t.logLevel)return;const i=(new Date).toISOString(),r=j[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${i}]  ${t.name}:`,...n)};class B{constructor(t){this.name=t,this._logLevel=V,this._logHandler=$,this._userLogHandler=null,M.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in x))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?U[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...t),this._logHandler(this,x.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...t),this._logHandler(this,x.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,x.INFO,...t),this._logHandler(this,x.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,x.WARN,...t),this._logHandler(this,x.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...t),this._logHandler(this,x.ERROR,...t)}}const q=(t,e)=>e.some((e=>t instanceof e));let z,K;const H=new WeakMap,G=new WeakMap,W=new WeakMap,Q=new WeakMap,J=new WeakMap;let X={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return G.get(t);if("objectStoreNames"===e)return t.objectStoreNames||W.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Z(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function Y(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(K||(K=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(tt(this),t),Z(H.get(this))}:function(...t){return Z(e.apply(tt(this),t))}:function(t,...n){const i=e.call(tt(this),t,...n);return W.set(i,t.sort?t.sort():[t]),Z(i)}:(t instanceof IDBTransaction&&function(t){if(G.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));G.set(t,e)}(t),q(t,z||(z=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,X):t);var e}function Z(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(Z(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&H.set(e,t)})).catch((()=>{})),J.set(e,t),e}(t);if(Q.has(t))return Q.get(t);const e=Y(t);return e!==t&&(Q.set(t,e),J.set(e,t)),e}const tt=t=>J.get(t),et=["get","getKey","getAll","getAllKeys","count"],nt=["put","add","delete","clear"],it=new Map;function rt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(it.get(e))return it.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=nt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!et.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return it.set(e,s),s}var st;st=X,X={...st,get:(t,e,n)=>rt(t,e)||st.get(t,e,n),has:(t,e)=>!!rt(t,e)||st.has(t,e)};class ot{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const at="@firebase/app",ct="0.9.15",ut=new B("@firebase/app"),ht="[DEFAULT]",lt={[at]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},dt=new Map,ft=new Map;function pt(t,e){try{t.container.addComponent(e)}catch(n){ut.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function gt(t){const e=t.name;if(ft.has(e))return ut.debug(`There were multiple attempts to register component ${e}.`),!1;ft.set(e,t);for(const e of dt.values())pt(e,t);return!0}function mt(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}const yt=new m("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class vt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new R("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw yt.create("app-deleted",{appName:this._name})}}const wt="10.1.0";function It(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:ht,automaticDataCollectionEnabled:!1},e),r=i.name;if("string"!=typeof r||!r)throw yt.create("bad-app-name",{appName:String(r)});if(n||(n=c()),!n)throw yt.create("no-options");const s=dt.get(r);if(s){if(v(n,s.options)&&v(i,s.config))return s;throw yt.create("duplicate-app",{appName:r})}const o=new L(r);for(const t of ft.values())o.addComponent(t);const a=new vt(n,i,o);return dt.set(r,a),a}function _t(t=ht){const e=dt.get(t);if(!e&&t===ht&&c())return It();if(!e)throw yt.create("no-app",{appName:t});return e}function bt(t,e,n){var i;let r=null!==(i=lt[t])&&void 0!==i?i:t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${r}" with version "${e}":`];return s&&t.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void ut.warn(t.join(" "))}gt(new R(`${r}-version`,(()=>({library:r,version:e})),"VERSION"))}const Et="firebase-heartbeat-database",Tt=1,St="firebase-heartbeat-store";let Ct=null;function kt(){return Ct||(Ct=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=Z(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(Z(o.result),t.oldVersion,t.newVersion,Z(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(t=>r(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(Et,Tt,{upgrade:(t,e)=>{0===e&&t.createObjectStore(St)}}).catch((t=>{throw yt.create("idb-open",{originalErrorMessage:t.message})}))),Ct}async function At(t,e){try{const n=(await kt()).transaction(St,"readwrite"),i=n.objectStore(St);await i.put(e,Dt(t)),await n.done}catch(t){if(t instanceof g)ut.warn(t.message);else{const e=yt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});ut.warn(e.message)}}}function Dt(t){return`${t.name}!${t.options.appId}`}class Nt{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Ot(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),e=Rt();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==e&&!this._heartbeatsCache.heartbeats.some((t=>t.date===e)))return this._heartbeatsCache.heartbeats.push({date:e,agent:t}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const t=Rt(),{heartbeatsToSend:e,unsentEntries:n}=function(t,e=1024){const n=[];let i=t.slice();for(const r of t){const t=n.find((t=>t.agent===r.agent));if(t){if(t.dates.push(r.date),Pt(n)>e){t.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),Pt(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=r(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Rt(){return(new Date).toISOString().substring(0,10)}class Ot{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!f()&&p().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await kt();return await e.transaction(St).objectStore(St).get(Dt(t))}catch(t){if(t instanceof g)ut.warn(t.message);else{const e=yt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});ut.warn(e.message)}}}(this.app);return t||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return At(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return At(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function Pt(t){return r(JSON.stringify({version:2,heartbeats:t})).length}gt(new R("platform-logger",(t=>new ot(t)),"PRIVATE")),gt(new R("heartbeat",(t=>new Nt(t)),"PRIVATE")),bt(at,ct,""),bt(at,ct,"esm2017"),bt("fire-js",""),bt("firebase","10.1.0","app");const Lt=(t,e)=>e.some((e=>t instanceof e));let Mt,xt;const Ft=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,jt=new WeakMap,$t=new WeakMap;let Bt={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return Ut.get(t);if("objectStoreNames"===e)return t.objectStoreNames||Vt.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return zt(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function qt(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(xt||(xt=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(Kt(this),t),zt(Ft.get(this))}:function(...t){return zt(e.apply(Kt(this),t))}:function(t,...n){const i=e.call(Kt(this),t,...n);return Vt.set(i,t.sort?t.sort():[t]),zt(i)}:(t instanceof IDBTransaction&&function(t){if(Ut.has(t))return;const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("complete",r),t.removeEventListener("error",s),t.removeEventListener("abort",s)},r=()=>{e(),i()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",r),t.addEventListener("error",s),t.addEventListener("abort",s)}));Ut.set(t,e)}(t),Lt(t,Mt||(Mt=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,Bt):t);var e}function zt(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const i=()=>{t.removeEventListener("success",r),t.removeEventListener("error",s)},r=()=>{e(zt(t.result)),i()},s=()=>{n(t.error),i()};t.addEventListener("success",r),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&Ft.set(e,t)})).catch((()=>{})),$t.set(e,t),e}(t);if(jt.has(t))return jt.get(t);const e=qt(t);return e!==t&&(jt.set(t,e),$t.set(e,t)),e}const Kt=t=>$t.get(t),Ht=["get","getKey","getAll","getAllKeys","count"],Gt=["put","add","delete","clear"],Wt=new Map;function Qt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(Wt.get(e))return Wt.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,r=Gt.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!Ht.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),r&&s.done]))[0]};return Wt.set(e,s),s}Bt=(t=>({...t,get:(e,n,i)=>Qt(e,n)||t.get(e,n,i),has:(e,n)=>!!Qt(e,n)||t.has(e,n)}))(Bt);const Jt="@firebase/installations",Xt="0.6.4",Yt=1e4,Zt=`w:${Xt}`,te="FIS_v2",ee="https://firebaseinstallations.googleapis.com/v1",ne=36e5,ie=new m("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function re(t){return t instanceof g&&t.code.includes("request-failed")}function se({projectId:t}){return`${ee}/projects/${t}/installations`}function oe(t){return{token:t.token,requestStatus:2,expiresIn:(e=t.expiresIn,Number(e.replace("s","000"))),creationTime:Date.now()};var e}async function ae(t,e){const n=(await e.json()).error;return ie.create("request-failed",{requestName:t,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function ce({apiKey:t}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":t})}async function ue(t){const e=await t();return e.status>=500&&e.status<600?t():e}function he(t){return new Promise((e=>{setTimeout(e,t)}))}const le=/^[cdef][\w-]{21}$/,de="";function fe(){try{const t=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(t),t[0]=112+t[0]%16;const e=function(t){var e;return(e=t,btoa(String.fromCharCode(...e)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(t);return le.test(e)?e:de}catch(t){return de}}function pe(t){return`${t.appName}!${t.appId}`}const ge=new Map;function me(t,e){const n=pe(t);ye(n,e),function(t,e){const n=(!ve&&"BroadcastChannel"in self&&(ve=new BroadcastChannel("[Firebase] FID Change"),ve.onmessage=t=>{ye(t.data.key,t.data.fid)}),ve);n&&n.postMessage({key:t,fid:e}),0===ge.size&&ve&&(ve.close(),ve=null)}(n,e)}function ye(t,e){const n=ge.get(t);if(n)for(const t of n)t(e)}let ve=null;const we="firebase-installations-database",Ie=1,_e="firebase-installations-store";let be=null;function Ee(){return be||(be=function(t,e,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(t,e),a=zt(o);return i&&o.addEventListener("upgradeneeded",(t=>{i(zt(o.result),t.oldVersion,t.newVersion,zt(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((t=>{s&&t.addEventListener("close",(()=>s())),r&&t.addEventListener("versionchange",(()=>r()))})).catch((()=>{})),a}(we,Ie,{upgrade:(t,e)=>{0===e&&t.createObjectStore(_e)}})),be}async function Te(t,e){const n=pe(t),i=(await Ee()).transaction(_e,"readwrite"),r=i.objectStore(_e),s=await r.get(n);return await r.put(e,n),await i.done,s&&s.fid===e.fid||me(t,e.fid),e}async function Se(t){const e=pe(t),n=(await Ee()).transaction(_e,"readwrite");await n.objectStore(_e).delete(e),await n.done}async function Ce(t,e){const n=pe(t),i=(await Ee()).transaction(_e,"readwrite"),r=i.objectStore(_e),s=await r.get(n),o=e(s);return void 0===o?await r.delete(n):await r.put(o,n),await i.done,!o||s&&s.fid===o.fid||me(t,o.fid),o}async function ke(t){let e;const n=await Ce(t.appConfig,(n=>{const i=function(t){return Ne(t||{fid:fe(),registrationStatus:0})}(n),r=function(t,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(ie.create("app-offline"))};const n={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(t,e){try{const n=await async function({appConfig:t,heartbeatServiceProvider:e},{fid:n}){const i=se(t),r=ce(t),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={fid:n,authVersion:te,appId:t.appId,sdkVersion:Zt},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await ue((()=>fetch(i,a)));if(c.ok){const t=await c.json();return{fid:t.fid||n,registrationStatus:2,refreshToken:t.refreshToken,authToken:oe(t.authToken)}}throw await ae("Create Installation",c)}(t,e);return Te(t.appConfig,n)}catch(n){throw re(n)&&409===n.customData.serverCode?await Se(t.appConfig):await Te(t.appConfig,{fid:e.fid,registrationStatus:0}),n}}(t,n);return{installationEntry:n,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:Ae(t)}:{installationEntry:e}}(t,i);return e=r.registrationPromise,r.installationEntry}));return n.fid===de?{installationEntry:await e}:{installationEntry:n,registrationPromise:e}}async function Ae(t){let e=await De(t.appConfig);for(;1===e.registrationStatus;)await he(100),e=await De(t.appConfig);if(0===e.registrationStatus){const{installationEntry:e,registrationPromise:n}=await ke(t);return n||e}return e}function De(t){return Ce(t,(t=>{if(!t)throw ie.create("installation-not-found");return Ne(t)}))}function Ne(t){return 1===(e=t).registrationStatus&&e.registrationTime+Yt<Date.now()?{fid:t.fid,registrationStatus:0}:t;var e}async function Re({appConfig:t,heartbeatServiceProvider:e},n){const i=function(t,{fid:e}){return`${se(t)}/${e}/authTokens:generate`}(t,n),r=function(t,{refreshToken:e}){const n=ce(t);return n.append("Authorization",function(t){return`${te} ${t}`}(e)),n}(t,n),s=e.getImmediate({optional:!0});if(s){const t=await s.getHeartbeatsHeader();t&&r.append("x-firebase-client",t)}const o={installation:{sdkVersion:Zt,appId:t.appId}},a={method:"POST",headers:r,body:JSON.stringify(o)},c=await ue((()=>fetch(i,a)));if(c.ok)return oe(await c.json());throw await ae("Generate Auth Token",c)}async function Oe(t,e=!1){let n;const i=await Ce(t.appConfig,(i=>{if(!Le(i))throw ie.create("not-registered");const r=i.authToken;if(!e&&(2===(s=r).requestStatus&&!function(t){const e=Date.now();return e<t.creationTime||t.creationTime+t.expiresIn<e+ne}(s)))return i;var s;if(1===r.requestStatus)return n=async function(t,e){let n=await Pe(t.appConfig);for(;1===n.authToken.requestStatus;)await he(100),n=await Pe(t.appConfig);const i=n.authToken;return 0===i.requestStatus?Oe(t,e):i}(t,e),i;{if(!navigator.onLine)throw ie.create("app-offline");const e=function(t){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},t),{authToken:e})}(i);return n=async function(t,e){try{const n=await Re(t,e),i=Object.assign(Object.assign({},e),{authToken:n});return await Te(t.appConfig,i),n}catch(n){if(!re(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Te(t.appConfig,n)}else await Se(t.appConfig);throw n}}(t,e),e}}));return n?await n:i.authToken}function Pe(t){return Ce(t,(t=>{if(!Le(t))throw ie.create("not-registered");return 1===(e=t.authToken).requestStatus&&e.requestTime+Yt<Date.now()?Object.assign(Object.assign({},t),{authToken:{requestStatus:0}}):t;var e}))}function Le(t){return void 0!==t&&2===t.registrationStatus}function Me(t){return ie.create("missing-app-config-values",{valueName:t})}const xe="installations";gt(new R(xe,(t=>{const e=t.getProvider("app").getImmediate(),n=function(t){if(!t||!t.options)throw Me("App Configuration");if(!t.name)throw Me("App Name");const e=["projectId","apiKey","appId"];for(const n of e)if(!t.options[n])throw Me(n);return{appName:t.name,projectId:t.options.projectId,apiKey:t.options.apiKey,appId:t.options.appId}}(e);return{app:e,appConfig:n,heartbeatServiceProvider:mt(e,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),gt(new R("installations-internal",(t=>{const e=mt(t.getProvider("app").getImmediate(),xe).getImmediate();return{getId:()=>async function(t){const e=t,{installationEntry:n,registrationPromise:i}=await ke(e);return i?i.catch(console.error):Oe(e).catch(console.error),n.fid}(e),getToken:t=>async function(t,e=!1){const n=t;return await async function(t){const{registrationPromise:e}=await ke(t);e&&await e}(n),(await Oe(n,e)).token}(e,t)}}),"PRIVATE")),bt(Jt,Xt),bt(Jt,Xt,"esm2017");const Fe="analytics",Ue="firebase_id",Ve="origin",je=6e4,$e="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Be="https://www.googletagmanager.com/gtag/js",qe=new B("@firebase/analytics"),ze=new m("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."});function Ke(t){if(!t.startsWith(Be)){const e=ze.create("invalid-gtag-resource",{gtagURL:t});return qe.warn(e.message),""}return t}function He(t){return Promise.all(t.map((t=>t.catch((t=>t)))))}const Ge=30,We=new class{constructor(t={},e=1e3){this.throttleMetadata=t,this.intervalMillis=e}getThrottleMetadata(t){return this.throttleMetadata[t]}setThrottleMetadata(t,e){this.throttleMetadata[t]=e}deleteThrottleMetadata(t){delete this.throttleMetadata[t]}};function Qe(t){return new Headers({Accept:"application/json","x-goog-api-key":t})}async function Je(t,e=We,n){const{appId:i,apiKey:r,measurementId:s}=t.options;if(!i)throw ze.create("no-app-id");if(!r){if(s)return{measurementId:s,appId:i};throw ze.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Ye;return setTimeout((async()=>{a.abort()}),void 0!==n?n:je),Xe({appId:i,apiKey:r,measurementId:s},o,a,e)}async function Xe(t,{throttleEndTimeMillis:e,backoffCount:n},i,r=We){var s;const{appId:o,measurementId:a}=t;try{await function(t,e){return new Promise(((n,i)=>{const r=Math.max(e-Date.now(),0),s=setTimeout(n,r);t.addEventListener((()=>{clearTimeout(s),i(ze.create("fetch-throttle",{throttleEndTimeMillis:e}))}))}))}(i,e)}catch(t){if(a)return qe.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==t?void 0:t.message}]`),{appId:o,measurementId:a};throw t}try{const e=await async function(t){var e;const{appId:n,apiKey:i}=t,r={method:"GET",headers:Qe(i)},s=$e.replace("{app-id}",n),o=await fetch(s,r);if(200!==o.status&&304!==o.status){let t="";try{const n=await o.json();(null===(e=n.error)||void 0===e?void 0:e.message)&&(t=n.error.message)}catch(t){}throw ze.create("config-fetch-failed",{httpStatus:o.status,responseMessage:t})}return o.json()}(t);return r.deleteThrottleMetadata(o),e}catch(e){const c=e;if(!function(t){if(!(t instanceof g&&t.customData))return!1;const e=Number(t.customData.httpStatus);return 429===e||500===e||503===e||504===e}(c)){if(r.deleteThrottleMetadata(o),a)return qe.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${null==c?void 0:c.message}]`),{appId:o,measurementId:a};throw e}const u=503===Number(null===(s=null==c?void 0:c.customData)||void 0===s?void 0:s.httpStatus)?D(n,r.intervalMillis,Ge):D(n,r.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:n+1};return r.setThrottleMetadata(o,h),qe.debug(`Calling attemptFetch again in ${u} millis`),Xe(t,h,i,r)}}class Ye{constructor(){this.listeners=[]}addEventListener(t){this.listeners.push(t)}abort(){this.listeners.forEach((t=>t()))}}let Ze,tn;async function en(t,e,n,i,r,s,o){var a;const c=Je(t);c.then((e=>{n[e.measurementId]=e.appId,t.options.measurementId&&e.measurementId!==t.options.measurementId&&qe.warn(`The measurement ID in the local Firebase config (${t.options.measurementId}) does not match the measurement ID fetched from the server (${e.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((t=>qe.error(t))),e.push(c);const u=async function(){if(!f())return qe.warn(ze.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await p()}catch(t){return qe.warn(ze.create("indexeddb-unavailable",{errorInfo:null==t?void 0:t.toString()}).message),!1}return!0}().then((t=>t?i.getId():void 0)),[h,l]=await Promise.all([c,u]);(function(t){const e=window.document.getElementsByTagName("script");for(const n of Object.values(e))if(n.src&&n.src.includes(Be)&&n.src.includes(t))return n;return null})(s)||function(t,e){const n=function(t,e){let n;return window.trustedTypes&&(n=window.trustedTypes.createPolicy("firebase-js-sdk-policy",e)),n}(0,{createScriptURL:Ke}),i=document.createElement("script"),r=`${Be}?l=${t}&id=${e}`;i.src=n?null==n?void 0:n.createScriptURL(r):r,i.async=!0,document.head.appendChild(i)}(s,h.measurementId),tn&&(r("consent","default",tn),tn=void 0),r("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[Ve]="firebase",d.update=!0,null!=l&&(d[Ue]=l),r("config",h.measurementId,d),Ze&&(r("set",Ze),Ze=void 0),h.measurementId}class nn{constructor(t){this.app=t}_delete(){return delete rn[this.app.options.appId],Promise.resolve()}}let rn={},sn=[];const on={};let an,cn,un="dataLayer",hn=!1;function ln(t,e,n){!function(){const t=[];if(d()&&t.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||t.push("Cookies are not available."),t.length>0){const e=t.map(((t,e)=>`(${e+1}) ${t}`)).join(" "),n=ze.create("invalid-analytics-context",{errorInfo:e});qe.warn(n.message)}}();const i=t.options.appId;if(!i)throw ze.create("no-app-id");if(!t.options.apiKey){if(!t.options.measurementId)throw ze.create("no-api-key");qe.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${t.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=rn[i])throw ze.create("already-exists",{id:i});if(!hn){!function(t){let e=[];Array.isArray(window[t])?e=window[t]:window[t]=e}(un);const{wrappedGtag:t,gtagCore:e}=function(t,e,n,i,r){let s=function(...t){window[i].push(arguments)};return window[r]&&"function"==typeof window[r]&&(s=window[r]),window[r]=function(t,e,n,i){return async function(r,...s){try{if("event"===r){const[i,r]=s;await async function(t,e,n,i,r){try{let s=[];if(r&&r.send_to){let t=r.send_to;Array.isArray(t)||(t=[t]);const i=await He(n);for(const n of t){const t=i.find((t=>t.measurementId===n)),r=t&&e[t.appId];if(!r){s=[];break}s.push(r)}}0===s.length&&(s=Object.values(e)),await Promise.all(s),t("event",i,r||{})}catch(t){qe.error(t)}}(t,e,n,i,r)}else if("config"===r){const[r,o]=s;await async function(t,e,n,i,r,s){const o=i[r];try{if(o)await e[o];else{const t=(await He(n)).find((t=>t.measurementId===r));t&&await e[t.appId]}}catch(t){qe.error(t)}t("config",r,s)}(t,e,n,i,r,o)}else if("consent"===r){const[e]=s;t("consent","update",e)}else if("get"===r){const[e,n,i]=s;t("get",e,n,i)}else if("set"===r){const[e]=s;t("set",e)}else t(r,...s)}catch(t){qe.error(t)}}}(s,t,e,n),{gtagCore:s,wrappedGtag:window[r]}}(rn,sn,on,un,"gtag");cn=t,an=e,hn=!0}return rn[i]=en(t,sn,on,e,an,un,n),new nn(t)}const dn="@firebase/analytics",fn="0.10.0";gt(new R(Fe,((t,{options:e})=>ln(t.getProvider("app").getImmediate(),t.getProvider("installations-internal").getImmediate(),e)),"PUBLIC")),gt(new R("analytics-internal",(function(t){try{const e=t.getProvider(Fe).getImmediate();return{logEvent:(t,n,i)=>function(t,e,n,i){t=N(t),async function(t,e,n,i,r){if(r&&r.global)t("event",n,i);else{const r=await e;t("event",n,Object.assign(Object.assign({},i),{send_to:r}))}}(cn,rn[t.app.options.appId],e,n,i).catch((t=>qe.error(t)))}(e,t,n,i)}}catch(t){throw ze.create("interop-component-reg-failed",{reason:t})}}),"PRIVATE")),bt(dn,fn),bt(dn,fn,"esm2017");const pn=It({apiKey:"AIzaSyD8GSMZzjbubQ7AGcQKIV-enpDYpz_07mo",authDomain:"lyrn-web-app.firebaseapp.com",projectId:"lyrn-web-app",storageBucket:"lyrn-web-app.appspot.com",messagingSenderId:"80732012862",appId:"1:80732012862:web:22ffb978c80a1d2a0f2c6f",measurementId:"G-F2QZT3W2CX"});!function(t=_t()){const e=mt(t=N(t),Fe);e.isInitialized()?e.getImmediate():function(t,e={}){const n=mt(t,Fe);if(n.isInitialized()){const t=n.getImmediate();if(v(e,n.getOptions()))return t;throw ze.create("already-initialized")}n.initialize({options:e})}(t)}(pn),"localhost"===location.hostname||location.hostname;const gn=pn;function mn(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(t,i[r])&&(n[i[r]]=t[i[r]])}return n}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;const yn=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},vn=new m("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),wn=new B("@firebase/auth");function In(t,...e){wn.logLevel<=x.ERROR&&wn.error(`Auth (${wt}): ${t}`,...e)}function _n(t,...e){throw En(t,...e)}function bn(t,...e){return En(t,...e)}function En(t,...e){if("string"!=typeof t){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return vn.create(t,...e)}function Tn(t,e,...n){if(!t)throw En(e,...n)}function Sn(t){const e="INTERNAL ASSERTION FAILED: "+t;throw In(e),new Error(e)}function Cn(t,e){t||Sn(e)}function kn(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.href)||""}function An(){var t;return"undefined"!=typeof self&&(null===(t=self.location)||void 0===t?void 0:t.protocol)||null}class Dn{constructor(t,e){this.shortDelay=t,this.longDelay=e,Cn(e>t,"Short delay should be less than long delay!"),this.isMobile="undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(l())||"object"==typeof navigator&&"ReactNative"===navigator.product}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===An()||"https:"===An()||d()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function Nn(t,e){Cn(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class Rn{static initialize(t,e,n){this.fetchImpl=t,e&&(this.headersImpl=e),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void Sn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void Sn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void Sn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const On={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},Pn=new Dn(3e4,6e4);function Ln(t,e){return t.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:t.tenantId}):e}async function Mn(t,e,n,i,r={}){return xn(t,r,(async()=>{let r={},s={};i&&("GET"===e?s=i:r={body:JSON.stringify(i)});const o=I(Object.assign({key:t.config.apiKey},s)).slice(1),a=await t._getAdditionalHeaders();return a["Content-Type"]="application/json",t.languageCode&&(a["X-Firebase-Locale"]=t.languageCode),Rn.fetch()(Un(t,t.config.apiHost,n,o),Object.assign({method:e,headers:a,referrerPolicy:"no-referrer"},r))}))}async function xn(t,e,n){t._canInitEmulator=!1;const i=Object.assign(Object.assign({},On),e);try{const e=new Vn(t),r=await Promise.race([n(),e.promise]);e.clearNetworkTimeout();const s=await r.json();if("needConfirmation"in s)throw jn(t,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{const e=r.ok?s.errorMessage:s.error.message,[n,o]=e.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw jn(t,"credential-already-in-use",s);if("EMAIL_EXISTS"===n)throw jn(t,"email-already-in-use",s);if("USER_DISABLED"===n)throw jn(t,"user-disabled",s);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(t,e,n){const i=Object.assign(Object.assign({},yn()),{[e]:n});return new m("auth","Firebase",i).create(e,{appName:t.name})}(t,a,o);_n(t,a)}}catch(e){if(e instanceof g)throw e;_n(t,"network-request-failed",{message:String(e)})}}async function Fn(t,e,n,i,r={}){const s=await Mn(t,e,n,i,r);return"mfaPendingCredential"in s&&_n(t,"multi-factor-auth-required",{_serverResponse:s}),s}function Un(t,e,n,i){const r=`${e}${n}?${i}`;return t.config.emulator?Nn(t.config,r):`${t.config.apiScheme}://${r}`}class Vn{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise(((t,e)=>{this.timer=setTimeout((()=>e(bn(this.auth,"network-request-failed"))),Pn.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function jn(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const r=bn(t,e,i);return r.customData._tokenResponse=n,r}function $n(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch(t){}}async function Bn(t,e=!1){const n=N(t),i=await n.getIdToken(e),r=zn(i);Tn(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const s="object"==typeof r.firebase?r.firebase:void 0,o=null==s?void 0:s.sign_in_provider;return{claims:r,token:i,authTime:$n(qn(r.auth_time)),issuedAtTime:$n(qn(r.iat)),expirationTime:$n(qn(r.exp)),signInProvider:o||null,signInSecondFactor:(null==s?void 0:s.sign_in_second_factor)||null}}function qn(t){return 1e3*Number(t)}function zn(t){const[e,n,i]=t.split(".");if(void 0===e||void 0===n||void 0===i)return In("JWT malformed, contained fewer than 3 sections"),null;try{const t=s(n);return t?JSON.parse(t):(In("Failed to decode base64 JWT payload"),null)}catch(t){return In("Caught error parsing JWT payload as JSON",null==t?void 0:t.toString()),null}}async function Kn(t,e,n=!1){if(n)return e;try{return await e}catch(e){throw e instanceof g&&function({code:t}){return"auth/user-disabled"===t||"auth/user-token-expired"===t}(e)&&t.auth.currentUser===t&&await t.auth.signOut(),e}}class Hn{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const t=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),t}{this.errorBackoff=3e4;const t=(null!==(e=this.user.stsTokenManager.expirationTime)&&void 0!==e?e:0)-Date.now()-3e5;return Math.max(0,t)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout((async()=>{await this.iteration()}),e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null==t?void 0:t.code)&&this.schedule(!0))}this.schedule()}}class Gn{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=$n(this.lastLoginAt),this.creationTime=$n(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Wn(t){var e;const n=t.auth,i=await t.getIdToken(),r=await Kn(t,async function(t,e){return Mn(t,"POST","/v1/accounts:lookup",e)}(n,{idToken:i}));Tn(null==r?void 0:r.users.length,n,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const o=(null===(e=s.providerUserInfo)||void 0===e?void 0:e.length)?s.providerUserInfo.map((t=>{var{providerId:e}=t,n=mn(t,["providerId"]);return{providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=t.providerData,u=o,[...c.filter((t=>!u.some((e=>e.providerId===t.providerId)))),...u]);var c,u;const h=t.isAnonymous,l=!(t.email&&s.passwordHash||(null==a?void 0:a.length)),d=!!h&&l,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Gn(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(t,f)}class Qn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){Tn(t.idToken,"internal-error"),Tn(void 0!==t.idToken,"internal-error"),Tn(void 0!==t.refreshToken,"internal-error");const e="expiresIn"in t&&void 0!==t.expiresIn?Number(t.expiresIn):function(t){const e=zn(t);return Tn(e,"internal-error"),Tn(void 0!==e.exp,"internal-error"),Tn(void 0!==e.iat,"internal-error"),Number(e.exp)-Number(e.iat)}(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}async getToken(t,e=!1){return Tn(!this.accessToken||this.refreshToken,t,"user-token-expired"),e||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(t,e){const n=await xn(t,{},(async()=>{const n=I({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:r}=t.config,s=Un(t,i,"/v1/token",`key=${r}`),o=await t._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Rn.fetch()(s,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(t,e);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(t,e,n){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(t,e){const{refreshToken:n,accessToken:i,expirationTime:r}=e,s=new Qn;return n&&(Tn("string"==typeof n,"internal-error",{appName:t}),s.refreshToken=n),i&&(Tn("string"==typeof i,"internal-error",{appName:t}),s.accessToken=i),r&&(Tn("number"==typeof r,"internal-error",{appName:t}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Qn,this.toJSON())}_performRefresh(){return Sn("not implemented")}}function Jn(t,e){Tn("string"==typeof t||void 0===t,"internal-error",{appName:e})}class Xn{constructor(t){var{uid:e,auth:n,stsTokenManager:i}=t,r=mn(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Hn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Gn(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(t){const e=await Kn(this,this.stsTokenManager.getToken(this.auth,t));return Tn(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return Bn(this,t)}reload(){return async function(t){const e=N(t);await Wn(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}(this)}_assign(t){this!==t&&(Tn(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map((t=>Object.assign({},t))),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Xn(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){Tn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let n=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),n=!0),e&&await Wn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const t=await this.getIdToken();return await Kn(this,async function(t,e){return Mn(t,"POST","/v1/accounts:delete",e)}(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((t=>Object.assign({},t))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var n,i,r,s,o,a,c,u;const h=null!==(n=e.displayName)&&void 0!==n?n:void 0,l=null!==(i=e.email)&&void 0!==i?i:void 0,d=null!==(r=e.phoneNumber)&&void 0!==r?r:void 0,f=null!==(s=e.photoURL)&&void 0!==s?s:void 0,p=null!==(o=e.tenantId)&&void 0!==o?o:void 0,g=null!==(a=e._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=e.createdAt)&&void 0!==c?c:void 0,y=null!==(u=e.lastLoginAt)&&void 0!==u?u:void 0,{uid:v,emailVerified:w,isAnonymous:I,providerData:_,stsTokenManager:b}=e;Tn(v&&b,t,"internal-error");const E=Qn.fromJSON(this.name,b);Tn("string"==typeof v,t,"internal-error"),Jn(h,t.name),Jn(l,t.name),Tn("boolean"==typeof w,t,"internal-error"),Tn("boolean"==typeof I,t,"internal-error"),Jn(d,t.name),Jn(f,t.name),Jn(p,t.name),Jn(g,t.name),Jn(m,t.name),Jn(y,t.name);const T=new Xn({uid:v,auth:t,email:l,emailVerified:w,displayName:h,isAnonymous:I,photoURL:f,phoneNumber:d,tenantId:p,stsTokenManager:E,createdAt:m,lastLoginAt:y});return _&&Array.isArray(_)&&(T.providerData=_.map((t=>Object.assign({},t)))),g&&(T._redirectEventId=g),T}static async _fromIdTokenResponse(t,e,n=!1){const i=new Qn;i.updateFromServerResponse(e);const r=new Xn({uid:e.localId,auth:t,stsTokenManager:i,isAnonymous:n});return await Wn(r),r}}const Yn=new Map;function Zn(t){Cn(t instanceof Function,"Expected a class definition");let e=Yn.get(t);return e?(Cn(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Yn.set(t,e),e)}class ti{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return void 0===e?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}ti.type="NONE";const ei=ti;function ni(t,e,n){return`firebase:${t}:${e}:${n}`}class ii{constructor(t,e,n){this.persistence=t,this.auth=e,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=ni(this.userKey,i.apiKey,r),this.fullPersistenceKey=ni("persistence",i.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Xn._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=t,e?this.setCurrentUser(e):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,n="authUser"){if(!e.length)return new ii(Zn(ei),t,n);const i=(await Promise.all(e.map((async t=>{if(await t._isAvailable())return t})))).filter((t=>t));let r=i[0]||Zn(ei);const s=ni(n,t.config.apiKey,t.name);let o=null;for(const n of e)try{const e=await n._get(s);if(e){const i=Xn._fromJSON(t,e);n!==r&&(o=i),r=n;break}}catch(t){}const a=i.filter((t=>t._shouldAllowMigration));return r._shouldAllowMigration&&a.length?(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(e.map((async t=>{if(t!==r)try{await t._remove(s)}catch(t){}}))),new ii(r,t,n)):new ii(r,t,n)}}function ri(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ci(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(si(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(hi(e))return"Blackberry";if(li(e))return"Webos";if(oi(e))return"Safari";if((e.includes("chrome/")||ai(e))&&!e.includes("edge/"))return"Chrome";if(ui(e))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=t.match(e);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function si(t=l()){return/firefox\//i.test(t)}function oi(t=l()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function ai(t=l()){return/crios\//i.test(t)}function ci(t=l()){return/iemobile/i.test(t)}function ui(t=l()){return/android/i.test(t)}function hi(t=l()){return/blackberry/i.test(t)}function li(t=l()){return/webos/i.test(t)}function di(t=l()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function fi(t=l()){return di(t)||ui(t)||li(t)||hi(t)||/windows phone/i.test(t)||ci(t)}function pi(t,e=[]){let n;switch(t){case"Browser":n=ri(l());break;case"Worker":n=`${ri(l())}-${t}`;break;default:n=t}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${wt}/${i}`}async function gi(t,e){return Mn(t,"GET","/v2/recaptchaConfig",Ln(t,e))}function mi(t){return void 0!==t&&void 0!==t.enterprise}class yi{constructor(t){if(this.siteKey="",this.emailPasswordEnabled=!1,void 0===t.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=t.recaptchaKey.split("/")[3],this.emailPasswordEnabled=t.recaptchaEnforcementState.some((t=>"EMAIL_PASSWORD_PROVIDER"===t.provider&&"OFF"!==t.enforcementState))}}function vi(t){return new Promise(((e,n)=>{const i=document.createElement("script");var r,s;i.setAttribute("src",t),i.onload=e,i.onerror=t=>{const e=bn("internal-error");e.customData=t,n(e)},i.type="text/javascript",i.charset="UTF-8",(null!==(s=null===(r=document.getElementsByTagName("head"))||void 0===r?void 0:r[0])&&void 0!==s?s:document).appendChild(i)}))}function wi(t){return`__${t}${Math.floor(1e6*Math.random())}`}class Ii{constructor(t){this.type="recaptcha-enterprise",this.auth=Ti(t)}async verify(t="verify",e=!1){function n(e,n,i){const r=window.grecaptcha;mi(r)?r.enterprise.ready((()=>{r.enterprise.execute(e,{action:t}).then((t=>{n(t)})).catch((()=>{n("NO_RECAPTCHA")}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return new Promise(((t,i)=>{(async function(t){if(!e){if(null==t.tenantId&&null!=t._agentRecaptchaConfig)return t._agentRecaptchaConfig.siteKey;if(null!=t.tenantId&&void 0!==t._tenantRecaptchaConfigs[t.tenantId])return t._tenantRecaptchaConfigs[t.tenantId].siteKey}return new Promise((async(e,n)=>{gi(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new yi(i);return null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,e(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((t=>{n(t)}))}))})(this.auth).then((r=>{if(!e&&mi(window.grecaptcha))n(r,t,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));vi("https://www.google.com/recaptcha/enterprise.js?render="+r).then((()=>{n(r,t,i)})).catch((t=>{i(t)}))}})).catch((t=>{i(t)}))}))}}async function _i(t,e,n,i=!1){const r=new Ii(t);let s;try{s=await r.verify(n)}catch(t){s=await r.verify(n,!0)}const o=Object.assign({},e);return i?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}class bi{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const n=e=>new Promise(((n,i)=>{try{n(t(e))}catch(t){i(t)}}));n.onAbort=e,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const n of this.queue)await n(t),n.onAbort&&e.push(n.onAbort)}catch(t){e.reverse();for(const t of e)try{t()}catch(t){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==t?void 0:t.message})}}}class Ei{constructor(t,e,n,i){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Si(this),this.idTokenSubscription=new Si(this),this.beforeStateQueue=new bi(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=vn,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Zn(e)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await ii.create(this,t),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(t){}await this.initializeCurrentUser(e),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();return this.currentUser||t?this.currentUser&&t&&this.currentUser.uid===t.uid?(this._currentUser._assign(t),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(t,!0):void 0}async initializeCurrentUser(t){var e;const n=await this.assertedPersistence.getCurrentUser();let i=n,r=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(e=this.redirectUser)||void 0===e?void 0:e._redirectEventId,s=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(t);n&&n!==s||!(null==o?void 0:o.user)||(i=o.user,r=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(i)}catch(t){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(t)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Tn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch(t){await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await Wn(t)}catch(t){if("auth/network-request-failed"!==(null==t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(t){const e=t?N(t):null;return e&&Tn(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&Tn(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue((async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(t){return this.queue((async()=>{await this.assertedPersistence.setPersistence(Zn(t))}))}async initializeRecaptchaConfig(){const t=await gi(this,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),e=new yi(t);null==this.tenantId?this._agentRecaptchaConfig=e:this._tenantRecaptchaConfigs[this.tenantId]=e,e.emailPasswordEnabled&&new Ii(this).verify()}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new m("auth","Firebase",t())}onAuthStateChanged(t,e,n){return this.registerStateListener(this.authStateSubscription,t,e,n)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,n){return this.registerStateListener(this.idTokenSubscription,t,e,n)}authStateReady(){return new Promise(((t,e)=>{if(this.currentUser)t();else{const n=this.onAuthStateChanged((()=>{n(),t()}),e)}}))}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(t=this._currentUser)||void 0===t?void 0:t.toJSON()}}async _setRedirectUser(t,e){const n=await this.getOrInitRedirectPersistenceManager(e);return null===t?n.removeCurrentUser():n.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Zn(t)||this._popupRedirectResolver;Tn(e,this,"argument-error"),this.redirectPersistenceManager=await ii.create(this,[Zn(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(e=this._currentUser)||void 0===e?void 0:e._redirectEventId)===t?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(t)))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(e=null===(t=this.currentUser)||void 0===t?void 0:t.uid)&&void 0!==e?e:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,n,i){if(this._deleted)return()=>{};const r="function"==typeof e?e:e.next.bind(e),s=this._isInitialized?Promise.resolve():this._initializationPromise;return Tn(s,this,"internal-error"),s.then((()=>r(this.currentUser))),"function"==typeof e?t.addObserver(e,n,i):t.addObserver(e)}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return Tn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){t&&!this.frameworks.includes(t)&&(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=pi(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(t=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){var t;const e=await(null===(t=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===t?void 0:t.getToken());return(null==e?void 0:e.error)&&function(t,...e){wn.logLevel<=x.WARN&&wn.warn(`Auth (${wt}): ${t}`,...e)}(`Error while retrieving App Check token: ${e.error}`),null==e?void 0:e.token}}function Ti(t){return N(t)}class Si{constructor(t){this.auth=t,this.observer=null,this.addObserver=function(t,e){const n=new E(t,void 0);return n.subscribe.bind(n)}((t=>this.observer=t))}get next(){return Tn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ci(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function ki(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}class Ai{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Sn("not implemented")}_getIdTokenResponse(t){return Sn("not implemented")}_linkToIdToken(t,e){return Sn("not implemented")}_getReauthenticationResolver(t){return Sn("not implemented")}}async function Di(t,e){return Fn(t,"POST","/v1/accounts:signInWithPassword",Ln(t,e))}class Ni extends Ai{constructor(t,e,n,i=null){super("password",n),this._email=t,this._password=e,this._tenantId=i}static _fromEmailAndPassword(t,e){return new Ni(t,e,"password")}static _fromEmailAndCode(t,e,n=null){return new Ni(t,e,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t;if((null==e?void 0:e.email)&&(null==e?void 0:e.password)){if("password"===e.signInMethod)return this._fromEmailAndPassword(e.email,e.password);if("emailLink"===e.signInMethod)return this._fromEmailAndCode(e.email,e.password,e.tenantId)}return null}async _getIdTokenResponse(t){var e;switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};if(null===(e=t._getRecaptchaConfig())||void 0===e?void 0:e.emailPasswordEnabled){const e=await _i(t,n,"signInWithPassword");return Di(t,e)}return Di(t,n).catch((async e=>{if("auth/missing-recaptcha-token"===e.code){console.log("Sign-in with email address and password is protected by reCAPTCHA for this project. Automatically triggering the reCAPTCHA flow and restarting the sign-in flow.");const e=await _i(t,n,"signInWithPassword");return Di(t,e)}return Promise.reject(e)}));case"emailLink":return async function(t,e){return Fn(t,"POST","/v1/accounts:signInWithEmailLink",Ln(t,e))}(t,{email:this._email,oobCode:this._password});default:_n(t,"internal-error")}}async _linkToIdToken(t,e){switch(this.signInMethod){case"password":return async function(t,e){return Mn(t,"POST","/v1/accounts:update",e)}(t,{idToken:e,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(t,e){return Fn(t,"POST","/v1/accounts:signInWithEmailLink",Ln(t,e))}(t,{idToken:e,email:this._email,oobCode:this._password});default:_n(t,"internal-error")}}_getReauthenticationResolver(t){return this._getIdTokenResponse(t)}}async function Ri(t,e){return Fn(t,"POST","/v1/accounts:signInWithIdp",Ln(t,e))}class Oi extends Ai{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Oi(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):_n("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e="string"==typeof t?JSON.parse(t):t,{providerId:n,signInMethod:i}=e,r=mn(e,["providerId","signInMethod"]);if(!n||!i)return null;const s=new Oi(n,i);return s.idToken=r.idToken||void 0,s.accessToken=r.accessToken||void 0,s.secret=r.secret,s.nonce=r.nonce,s.pendingToken=r.pendingToken||null,s}_getIdTokenResponse(t){return Ri(t,this.buildRequest())}_linkToIdToken(t,e){const n=this.buildRequest();return n.idToken=e,Ri(t,n)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,Ri(t,e)}buildRequest(){const t={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=I(e)}return t}}const Pi={USER_NOT_FOUND:"user-not-found"};class Li extends Ai{constructor(t){super("phone","phone"),this.params=t}static _fromVerification(t,e){return new Li({verificationId:t,verificationCode:e})}static _fromTokenResponse(t,e){return new Li({phoneNumber:t,temporaryProof:e})}_getIdTokenResponse(t){return async function(t,e){return Fn(t,"POST","/v1/accounts:signInWithPhoneNumber",Ln(t,e))}(t,this._makeVerificationRequest())}_linkToIdToken(t,e){return async function(t,e){const n=await Fn(t,"POST","/v1/accounts:signInWithPhoneNumber",Ln(t,e));if(n.temporaryProof)throw jn(t,"account-exists-with-different-credential",n);return n}(t,Object.assign({idToken:e},this._makeVerificationRequest()))}_getReauthenticationResolver(t){return async function(t,e){return Fn(t,"POST","/v1/accounts:signInWithPhoneNumber",Ln(t,Object.assign(Object.assign({},e),{operation:"REAUTH"})),Pi)}(t,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:t,phoneNumber:e,verificationId:n,verificationCode:i}=this.params;return t&&e?{temporaryProof:t,phoneNumber:e}:{sessionInfo:n,code:i}}toJSON(){const t={providerId:this.providerId};return this.params.phoneNumber&&(t.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(t.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(t.verificationCode=this.params.verificationCode),this.params.verificationId&&(t.verificationId=this.params.verificationId),t}static fromJSON(t){"string"==typeof t&&(t=JSON.parse(t));const{verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:r}=t;return n||e||i||r?new Li({verificationId:e,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class Mi{constructor(t){var e,n,i,r,s,o;const a=_(b(t)),c=null!==(e=a.apiKey)&&void 0!==e?e:null,u=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);Tn(c&&u&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=u,this.continueUrl=null!==(r=a.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(s=a.languageCode)&&void 0!==s?s:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(t){const e=function(t){const e=_(b(t)).link,n=e?_(b(e)).deep_link_id:null,i=_(b(t)).deep_link_id;return(i?_(b(i)).link:null)||i||n||e||t}(t);try{return new Mi(e)}catch(t){return null}}}class xi{constructor(){this.providerId=xi.PROVIDER_ID}static credential(t,e){return Ni._fromEmailAndPassword(t,e)}static credentialWithLink(t,e){const n=Mi.parseLink(e);return Tn(n,"argument-error"),Ni._fromEmailAndCode(t,n.code,n.tenantId)}}xi.PROVIDER_ID="password",xi.EMAIL_PASSWORD_SIGN_IN_METHOD="password",xi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Fi{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Ui extends Fi{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class Vi extends Ui{constructor(){super("facebook.com")}static credential(t){return Oi._fromParams({providerId:Vi.PROVIDER_ID,signInMethod:Vi.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return Vi.credentialFromTaggedObject(t)}static credentialFromError(t){return Vi.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return Vi.credential(t.oauthAccessToken)}catch(t){return null}}}Vi.FACEBOOK_SIGN_IN_METHOD="facebook.com",Vi.PROVIDER_ID="facebook.com";class ji extends Ui{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Oi._fromParams({providerId:ji.PROVIDER_ID,signInMethod:ji.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return ji.credentialFromTaggedObject(t)}static credentialFromError(t){return ji.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:n}=t;if(!e&&!n)return null;try{return ji.credential(e,n)}catch(t){return null}}}ji.GOOGLE_SIGN_IN_METHOD="google.com",ji.PROVIDER_ID="google.com";class $i extends Ui{constructor(){super("github.com")}static credential(t){return Oi._fromParams({providerId:$i.PROVIDER_ID,signInMethod:$i.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return $i.credentialFromTaggedObject(t)}static credentialFromError(t){return $i.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t))return null;if(!t.oauthAccessToken)return null;try{return $i.credential(t.oauthAccessToken)}catch(t){return null}}}$i.GITHUB_SIGN_IN_METHOD="github.com",$i.PROVIDER_ID="github.com";class Bi extends Ui{constructor(){super("twitter.com")}static credential(t,e){return Oi._fromParams({providerId:Bi.PROVIDER_ID,signInMethod:Bi.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return Bi.credentialFromTaggedObject(t)}static credentialFromError(t){return Bi.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:n}=t;if(!e||!n)return null;try{return Bi.credential(e,n)}catch(t){return null}}}Bi.TWITTER_SIGN_IN_METHOD="twitter.com",Bi.PROVIDER_ID="twitter.com";class qi{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,n,i=!1){const r=await Xn._fromIdTokenResponse(t,n,i),s=zi(n);return new qi({user:r,providerId:s,_tokenResponse:n,operationType:e})}static async _forOperation(t,e,n){await t._updateTokensIfNecessary(n,!0);const i=zi(n);return new qi({user:t,providerId:i,_tokenResponse:n,operationType:e})}}function zi(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Ki extends g{constructor(t,e,n,i){var r;super(e.code,e.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Ki.prototype),this.customData={appName:t.name,tenantId:null!==(r=t.tenantId)&&void 0!==r?r:void 0,_serverResponse:e.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(t,e,n,i){return new Ki(t,e,n,i)}}function Hi(t,e,n,i){return("reauthenticate"===e?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Ki._fromErrorAndOperation(t,n,e,i);throw n}))}function Gi(t,e,n,i){return N(t).onAuthStateChanged(e,n,i)}function Wi(t){return N(t).signOut()}new WeakMap;const Qi="__sak";class Ji{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(Qi,"1"),this.storage.removeItem(Qi),Promise.resolve(!0)):Promise.resolve(!1)}catch(t){return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}class Xi extends Ji{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const t=l();return oi(t)||di(t)}()&&function(){try{return!(!window||window===window.top)}catch(t){return!1}}(),this.fallbackToPolling=fi(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const n=this.storage.getItem(e),i=this.localCache[e];n!==i&&t(e,i,n)}}onStorageEvent(t,e=!1){if(!t.key)return void this.forAllChangedKeys(((t,e,n)=>{this.notifyListeners(t,n)}));const n=t.key;if(e?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(t.newValue!==i)null!==t.newValue?this.storage.setItem(n,t.newValue):this.storage.removeItem(n);else if(this.localCache[n]===t.newValue&&!e)return}const i=()=>{const t=this.storage.getItem(n);(e||this.localCache[n]!==t)&&this.notifyListeners(n,t)},r=this.storage.getItem(n);!function(){const t=l();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}()||10!==document.documentMode||r===t.newValue||t.newValue===t.oldValue?i():setTimeout(i,10)}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e?JSON.parse(e):e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((t,e,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Xi.type="LOCAL";const Yi=Xi;class Zi extends Ji{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Zi.type="SESSION";const tr=Zi;class er{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find((e=>e.isListeningto(t)));if(e)return e;const n=new er(t);return this.receivers.push(n),n}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:n,eventType:i,data:r}=e.data,s=this.handlersMap[i];if(!(null==s?void 0:s.size))return;e.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(s).map((async t=>t(e.origin,r))),a=await function(t){return Promise.all(t.map((async t=>{try{return{fulfilled:!0,value:await t}}catch(t){return{fulfilled:!1,reason:t}}})))}(o);e.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(t,e){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),e&&0!==this.handlersMap[t].size||delete this.handlersMap[t],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function nr(t="",e=10){let n="";for(let t=0;t<e;t++)n+=Math.floor(10*Math.random());return t+n}er.receivers=[];class ir{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let r,s;return new Promise(((o,a)=>{const c=nr("",20);i.port1.start();const u=setTimeout((()=>{a(new Error("unsupported_event"))}),n);s={messageChannel:i,onMessage(t){const e=t;if(e.data.eventId===c)switch(e.data.status){case"ack":clearTimeout(u),r=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(r),o(e.data.response);break;default:clearTimeout(u),clearTimeout(r),a(new Error("invalid_response"))}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:t,eventId:c,data:e},[i.port2])})).finally((()=>{s&&this.removeMessageHandler(s)}))}}function rr(){return window}function sr(){return void 0!==rr().WorkerGlobalScope&&"function"==typeof rr().importScripts}const or="firebaseLocalStorageDb",ar="firebaseLocalStorage",cr="fbase_key";class ur{constructor(t){this.request=t}toPromise(){return new Promise(((t,e)=>{this.request.addEventListener("success",(()=>{t(this.request.result)})),this.request.addEventListener("error",(()=>{e(this.request.error)}))}))}}function hr(t,e){return t.transaction([ar],e?"readwrite":"readonly").objectStore(ar)}function lr(){const t=indexedDB.open(or,1);return new Promise(((e,n)=>{t.addEventListener("error",(()=>{n(t.error)})),t.addEventListener("upgradeneeded",(()=>{const e=t.result;try{e.createObjectStore(ar,{keyPath:cr})}catch(t){n(t)}})),t.addEventListener("success",(async()=>{const n=t.result;n.objectStoreNames.contains(ar)?e(n):(n.close(),await function(){const t=indexedDB.deleteDatabase(or);return new ur(t).toPromise()}(),e(await lr()))}))}))}async function dr(t,e,n){const i=hr(t,!0).put({[cr]:e,value:n});return new ur(i).toPromise()}function fr(t,e){const n=hr(t,!0).delete(e);return new ur(n).toPromise()}class pr{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await lr()),this.db}async _withRetries(t){let e=0;for(;;)try{const e=await this._openDb();return await t(e)}catch(t){if(e++>3)throw t;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return sr()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=er._getInstance(sr()?self:null),this.receiver._subscribe("keyChanged",(async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)}))),this.receiver._subscribe("ping",(async(t,e)=>["keyChanged"]))}async initializeSender(){var t,e;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(t){return null}}(),!this.activeServiceWorker)return;this.sender=new ir(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(t=n[0])||void 0===t?void 0:t.fulfilled)&&(null===(e=n[0])||void 0===e?void 0:e.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){var e;if(this.sender&&this.activeServiceWorker&&((null===(e=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===e?void 0:e.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch(e){}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await lr();return await dr(t,Qi,"1"),await fr(t,Qi),!0}catch(t){}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite((async()=>(await this._withRetries((n=>dr(n,t,e))),this.localCache[t]=e,this.notifyServiceWorker(t))))}async _get(t){const e=await this._withRetries((e=>async function(t,e){const n=hr(t,!1).get(e),i=await new ur(n).toPromise();return void 0===i?null:i.value}(e,t)));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite((async()=>(await this._withRetries((e=>fr(e,t))),delete this.localCache[t],this.notifyServiceWorker(t))))}async _poll(){const t=await this._withRetries((t=>{const e=hr(t,!1).getAll();return new ur(e).toPromise()}));if(!t)return[];if(0!==this.pendingWrites)return[];const e=[],n=new Set;for(const{fbase_key:i,value:r}of t)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),e.push(i));for(const t of Object.keys(this.localCache))this.localCache[t]&&!n.has(t)&&(this.notifyListeners(t,null),e.push(t));return e}notifyListeners(t,e){this.localCache[t]=e;const n=this.listeners[t];if(n)for(const t of Array.from(n))t(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),0===this.listeners[t].size&&delete this.listeners[t]),0===Object.keys(this.listeners).length&&this.stopPolling()}}pr.type="LOCAL";const gr=pr;wi("rcb"),new Dn(3e4,6e4);class mr{constructor(t){this.providerId=mr.PROVIDER_ID,this.auth=Ti(t)}verifyPhoneNumber(t,e){return async function(t,e,n){var i;const r=await n.verify();try{let s;if(Tn("string"==typeof r,t,"argument-error"),Tn("recaptcha"===n.type,t,"argument-error"),s="string"==typeof e?{phoneNumber:e}:e,"session"in s){const e=s.session;if("phoneNumber"in s){Tn("enroll"===e.type,t,"internal-error");const n=await function(t,e){return Mn(t,"POST","/v2/accounts/mfaEnrollment:start",Ln(t,e))}(t,{idToken:e.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:r}});return n.phoneSessionInfo.sessionInfo}{Tn("signin"===e.type,t,"internal-error");const n=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;Tn(n,t,"missing-multi-factor-info");const o=await function(t,e){return Mn(t,"POST","/v2/accounts/mfaSignIn:start",Ln(t,e))}(t,{mfaPendingCredential:e.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:r}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:e}=await async function(t,e){return Mn(t,"POST","/v1/accounts:sendVerificationCode",Ln(t,e))}(t,{phoneNumber:s.phoneNumber,recaptchaToken:r});return e}}finally{n._reset()}}(this.auth,t,N(e))}static credential(t,e){return Li._fromVerification(t,e)}static credentialFromResult(t){const e=t;return mr.credentialFromTaggedObject(e)}static credentialFromError(t){return mr.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{phoneNumber:e,temporaryProof:n}=t;return e&&n?Li._fromTokenResponse(e,n):null}}mr.PROVIDER_ID="phone",mr.PHONE_SIGN_IN_METHOD="phone";class yr extends Ai{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return Ri(t,this._buildIdpRequest())}_linkToIdToken(t,e){return Ri(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return Ri(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function vr(t){return async function(t,e,n=!1){const i="signIn",r=await Hi(t,i,e),s=await qi._fromIdTokenResponse(t,i,r);return n||await t._updateCurrentUser(s.user),s}(t.auth,new yr(t),t.bypassAuthState)}function wr(t){const{auth:e,user:n}=t;return Tn(n,e,"internal-error"),async function(t,e,n=!1){const{auth:i}=t,r="reauthenticate";try{const s=await Kn(t,Hi(i,r,e,t),n);Tn(s.idToken,i,"internal-error");const o=zn(s.idToken);Tn(o,i,"internal-error");const{sub:a}=o;return Tn(t.uid===a,i,"user-mismatch"),qi._forOperation(t,r,s)}catch(t){throw"auth/user-not-found"===(null==t?void 0:t.code)&&_n(i,"user-mismatch"),t}}(n,new yr(t),t.bypassAuthState)}async function Ir(t){const{auth:e,user:n}=t;return Tn(n,e,"internal-error"),async function(t,e,n=!1){const i=await Kn(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return qi._forOperation(t,"link",i)}(n,new yr(t),t.bypassAuthState)}class _r{constructor(t,e,n,i,r=!1){this.auth=t,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise((async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(t){this.reject(t)}}))}async onAuthEvent(t){const{urlResponse:e,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=t;if(s)return void this.reject(s);const a={auth:this.auth,requestUri:e,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(t){this.reject(t)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return vr;case"linkViaPopup":case"linkViaRedirect":return Ir;case"reauthViaPopup":case"reauthViaRedirect":return wr;default:_n(this.auth,"internal-error")}}resolve(t){Cn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Cn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const br=new Dn(2e3,1e4);class Er extends _r{constructor(t,e,n,i,r){super(t,e,i,r),this.provider=n,this.authWindow=null,this.pollId=null,Er.currentPopupAction&&Er.currentPopupAction.cancel(),Er.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return Tn(t,this.auth,"internal-error"),t}async onExecution(){Cn(1===this.filter.length,"Popup operations only handle one event");const t=nr();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch((t=>{this.reject(t)})),this.resolver._isIframeWebStorageSupported(this.auth,(t=>{t||this.reject(bn(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var t;return(null===(t=this.authWindow)||void 0===t?void 0:t.associatedEvent)||null}cancel(){this.reject(bn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Er.currentPopupAction=null}pollUserCancellation(){const t=()=>{var e,n;(null===(n=null===(e=this.authWindow)||void 0===e?void 0:e.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(bn(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(t,br.get())};t()}}Er.currentPopupAction=null;const Tr="pendingRedirect",Sr=new Map;class Cr extends _r{constructor(t,e,n=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,n),this.eventId=null}async execute(){let t=Sr.get(this.auth._key());if(!t){try{const e=await async function(t,e){const n=function(t){return ni(Tr,t.config.apiKey,t.name)}(e),i=function(t){return Zn(t._redirectPersistence)}(t);if(!await i._isAvailable())return!1;const r="true"===await i._get(n);return await i._remove(n),r}(this.resolver,this.auth),n=e?await super.execute():null;t=()=>Promise.resolve(n)}catch(e){t=()=>Promise.reject(e)}Sr.set(this.auth._key(),t)}return this.bypassAuthState||Sr.set(this.auth._key(),(()=>Promise.resolve(null))),t()}async onAuthEvent(t){if("signInViaRedirect"===t.type)return super.onAuthEvent(t);if("unknown"!==t.type){if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function kr(t,e){Sr.set(t._key(),e)}async function Ar(t,e,n=!1){const i=Ti(t),r=function(t,e){return e?Zn(e):(Tn(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}(i,e),s=new Cr(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}class Dr{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(t,n)&&(e=!0,this.sendToConsumer(t,n),this.saveEventToCache(t))})),this.hasHandledPotentialRedirect||!function(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Rr(t);default:return!1}}(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){var n;if(t.error&&!Rr(t)){const i=(null===(n=t.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";e.onError(bn(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const n=null===e.eventId||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&n}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Nr(t))}saveEventToCache(t){this.cachedEventUids.add(Nr(t)),this.lastProcessedEventTime=Date.now()}}function Nr(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter((t=>t)).join("-")}function Rr({type:t,error:e}){return"unknown"===t&&"auth/no-auth-event"===(null==e?void 0:e.code)}const Or=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Pr=/^https?/;function Lr(t){const e=kn(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const r=new URL(t);return""===r.hostname&&""===i?"chrome-extension:"===n&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!Pr.test(n))return!1;if(Or.test(t))return i===t;const r=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}const Mr=new Dn(3e4,6e4);function xr(){const t=rr().___jsl;if(null==t?void 0:t.H)for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let e=0;e<t.CP.length;e++)t.CP[e]=null}let Fr=null;function Ur(t){return Fr=Fr||function(t){return new Promise(((e,n)=>{var i,r,s;function o(){xr(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{xr(),n(bn(t,"network-request-failed"))},timeout:Mr.get()})}if(null===(r=null===(i=rr().gapi)||void 0===i?void 0:i.iframes)||void 0===r?void 0:r.Iframe)e(gapi.iframes.getContext());else{if(!(null===(s=rr().gapi)||void 0===s?void 0:s.load)){const e=wi("iframefcb");return rr()[e]=()=>{gapi.load?o():n(bn(t,"network-request-failed"))},vi(`https://apis.google.com/js/api.js?onload=${e}`).catch((t=>n(t)))}o()}})).catch((t=>{throw Fr=null,t}))}(t),Fr}const Vr=new Dn(5e3,15e3),jr={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},$r=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Br(t){const e=t.config;Tn(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Nn(e,"emulator/auth/iframe"):`https://${t.config.authDomain}/__/auth/iframe`,i={apiKey:e.apiKey,appName:t.name,v:wt},r=$r.get(t.config.apiHost);r&&(i.eid=r);const s=t._getFrameworks();return s.length&&(i.fw=s.join(",")),`${n}?${I(i).slice(1)}`}const qr={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class zr{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(t){}}}const Kr=encodeURIComponent("fac");async function Hr(t,e,n,i,r,s){Tn(t.config.authDomain,t,"auth-domain-config-required"),Tn(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:wt,eventId:r};if(e instanceof Fi){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[t,e]of Object.entries(s||{}))o[t]=e}if(e instanceof Ui){const t=e.getScopes().filter((t=>""!==t));t.length>0&&(o.scopes=t.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const t of Object.keys(a))void 0===a[t]&&delete a[t];const c=await t._getAppCheckToken(),u=c?`#${Kr}=${encodeURIComponent(c)}`:"";return`${function({config:t}){return t.emulator?Nn(t,"emulator/auth/handler"):`https://${t.authDomain}/__/auth/handler`}(t)}?${I(a).slice(1)}${u}`}const Gr="webStorageSupport",Wr=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=tr,this._completeRedirectFn=Ar,this._overrideRedirectResult=kr}async _openPopup(t,e,n,i){var r;return Cn(null===(r=this.eventManagers[t._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(t,e,n,i=500,r=600){const s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},qr),{width:i.toString(),height:r.toString(),top:s,left:o}),u=l().toLowerCase();n&&(a=ai(u)?"_blank":n),si(u)&&(e=e||"http://localhost",c.scrollbars="yes");const h=Object.entries(c).reduce(((t,[e,n])=>`${t}${e}=${n},`),"");if(function(t=l()){var e;return di(t)&&!!(null===(e=window.navigator)||void 0===e?void 0:e.standalone)}(u)&&"_self"!==a)return function(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(e||"",a),new zr(null);const d=window.open(e||"",a,h);Tn(d,t,"popup-blocked");try{d.focus()}catch(t){}return new zr(d)}(t,await Hr(t,e,n,kn(),i),nr())}async _openRedirect(t,e,n,i){return await this._originValidation(t),r=await Hr(t,e,n,kn(),i),rr().location.href=r,new Promise((()=>{}));var r}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:t,promise:n}=this.eventManagers[e];return t?Promise.resolve(t):(Cn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(t);return this.eventManagers[e]={promise:n},n.catch((()=>{delete this.eventManagers[e]})),n}async initAndGetManager(t){const e=await async function(t){const e=await Ur(t),n=rr().gapi;return Tn(n,t,"internal-error"),e.open({where:document.body,url:Br(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jr,dontclear:!0},(e=>new Promise((async(n,i)=>{await e.restyle({setHideOnLeave:!1});const r=bn(t,"network-request-failed"),s=rr().setTimeout((()=>{i(r)}),Vr.get());function o(){rr().clearTimeout(s),n(e)}e.ping(o).then(o,(()=>{i(r)}))}))))}(t),n=new Dr(t);return e.register("authEvent",(e=>(Tn(null==e?void 0:e.authEvent,t,"invalid-auth-event"),{status:n.onEvent(e.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:n},this.iframes[t._key()]=e,n}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Gr,{type:Gr},(n=>{var i;const r=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[Gr];void 0!==r&&e(!!r),_n(t,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=async function(t){if(t.config.emulator)return;const{authorizedDomains:e}=await async function(t,e={}){return Mn(t,"GET","/v1/projects",e)}(t);for(const t of e)try{if(Lr(t))return}catch(t){}_n(t,"unauthorized-domain")}(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return fi()||oi()||di()}};var Qr="@firebase/auth",Jr="1.1.0";class Xr{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),(null===(t=this.auth.currentUser)||void 0===t?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged((e=>{t((null==e?void 0:e.stsTokenManager.accessToken)||null)}));this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){Tn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const Yr=u("authIdTokenMaxAge")||300;let Zr=null;var ts;ts="Browser",gt(new R("auth",((t,{options:e})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=n.options;Tn(s&&!s.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:s,authDomain:o,clientPlatform:ts,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pi(ts)},c=new Ei(n,i,r,a);return function(t,e){const n=(null==e?void 0:e.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Zn);(null==e?void 0:e.errorMap)&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,null==e?void 0:e.popupRedirectResolver)}(c,e),c}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((t,e,n)=>{t.getProvider("auth-internal").initialize()}))),gt(new R("auth-internal",(t=>(t=>new Xr(t))(Ti(t.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),bt(Qr,Jr,function(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(ts)),bt(Qr,Jr,"esm2017");class es{constructor(t){this.message=t.message??document.createElement("div"),this.choices=t.choices??[],this.values=t.values??[],this.slideInDir=t.slideInDir??null,this.slideInDist=t.slideInDist??100,this.slideInDuration=t.slideInDuration??500,this.slideInTiming=t.slideInTiming??"ease",this.slideOutDir=t.slideOutDir??null,this.slideOutDist=t.slideOutDist??100,this.slideOutDuration=t.slideOutDuration??500,this.slideOutTiming=t.slideOutTiming??"ease",this.fadeIn=t.fadeIn??null,this.fadeInDuration=t.fadeInDuration??500,this.fadeInTiming=t.fadeInTiming??"ease",this.fadeOut=t.fadeOut??null,this.fadeOutDuration=t.fadeOutDuration??500,this.fadeOutTiming=t.fadeOutTiming??"ease",this.container=document.createElement("div"),this.blocking=t.blocking??!0,this.windowBackgroundColor=t.windowBackgroundColor??(this.blocking?"rgb(0, 0, 0, 0.5)":"transparent"),this.windowPadding=t.windowPadding??"2em",this.hideOnWindow=t.hideOnWindow??this.blocking,this.wrapper=document.createElement("div"),this.width=t.width??"auto",this.justify=t.justify??"center",this.align=t.align??"center",this.backgroundColor=t.backgroundColor??"#FFFFFF",this.messageColor=t.messageColor??"#5B5B5B",this.messageFontSize=t.messageFontSize??"inherit",this.messageFontWeight=t.messageFontWeight??"inherit",this.choiceColor=t.choiceColor??"#057AFB",this.choiceFontSize=t.choiceFontSize??"inherit",this.choiceFontWeight=t.choiceFontWeight??"inherit",this.borderRadius=t.borderRadius??"0.5em",this.shadow=t.shadow??"0 0 10px 1px rgba(0, 0, 0, 0.3)",this.padding=t.padding??"1em 2em",this.choicesBorderTop=t.choicesBorderTop??"1px solid #D5D5D5",this.justifyChoices=t.justifyChoices??"end",this.hideOnDialog=t.hideOnDialog??!this.blocking,this.timeout=t.timeout??null}show(){return new Promise(((t,e)=>{for(;this.wrapper.firstChild;)this.wrapper.removeChild(this.wrapper.firstChild);if(this.container.style.boxSizing="border-box",this.container.style.display="flex",this.container.style.flexDirection="row",this.container.style.justifyContent=this.justify,this.container.style.alignItems=this.align,this.container.style.position="fixed",this.container.style.top=0,this.container.style.left=0,this.container.style.zIndex=9999,this.container.style.width="100vw",this.container.style.height="100vh",this.container.style.padding=this.windowPadding,this.container.style.backgroundColor=this.windowBackgroundColor,this.blocking?this.container.style.pointerEvents="auto":this.container.style.pointerEvents="none",this.hideOnWindow&&this.container.addEventListener("click",(e=>{e.target===e.currentTarget&&(t(null),this.hide())})),this.wrapper.style.width=this.width,this.wrapper.style.backgroundColor=this.backgroundColor,this.wrapper.style.color=this.messageColor,this.wrapper.style.borderRadius=this.borderRadius,this.wrapper.style.boxShadow=this.shadow,this.wrapper.style.pointerEvents="auto",this.slideInDir)switch(this.slideInDir){case"down":this.wrapper.style.transform=`translateY(-${this.slideInDist}px)`;break;case"right":this.wrapper.style.transform=`translateX(-${this.slideInDist}px)`;break;case"up":this.wrapper.style.transform=`translateY(${this.slideInDist}px)`;break;case"left":this.wrapper.style.transform=`translateX(${this.slideInDist}px)`;break;default:this.wrapper.style.transform="transform(0px)"}this.fadeIn&&(this.wrapper.style.opacity=0),this.hideOnDialog&&this.wrapper.addEventListener("click",(()=>{t(null),this.hide()})),this.container.appendChild(this.wrapper);const n=document.createElement("div");if(n.style.padding=this.padding,"string"==typeof this.message?(n.textContent=this.message,n.style.fontSize=this.messageFontSize,n.style.fontWeight=this.messageFontWeight):n.appendChild(this.message),this.wrapper.appendChild(n),this.choices.length>0){const e=document.createElement("div");e.style.padding=this.padding,e.style.borderTop=this.choicesBorderTop,e.style.display="flex",e.style.flexDirection="row",e.style.justifyContent=this.justifyChoices,this.choices.forEach(((n,i)=>{let r;"string"==typeof n?(r=document.createElement("p"),r.style.margin="0",r.textContent=n,r.style.fontSize=this.choiceFontSize,r.style.fontWeight=this.choiceFontWeight):r=n,"end"===this.justifyChoices&&(r.style.paddingLeft="1em"),"start"===this.justifyChoices&&(r.style.paddingRight="1em"),r.style.cursor="pointer",r.style.color=this.choiceColor,r.addEventListener("click",(()=>{t(this.values[i]),this.hide()})),e.appendChild(r)})),this.wrapper.appendChild(e)}document.body.appendChild(this.container);let i=null;this.slideInDir&&(i=`transform ${this.slideInDuration}ms ${this.slideInTiming}`,requestAnimationFrame((()=>{this.wrapper.style.transform="translate(0px)"}))),this.fadeIn&&(i?i+=`, opacity ${this.fadeInDuration}ms ${this.fadeInTiming}`:i=`, opacity ${this.fadeInDuration}ms ${this.fadeInTiming}`,requestAnimationFrame((()=>{this.wrapper.style.opacity=1}))),i&&(this.wrapper.style.transition=i),this.timeout&&setTimeout((()=>{t(null),this.hide()}),this.timeout)}))}hide(){let t=null;this.slideOutDir&&(t=`transform ${this.slideOutDuration}ms ${this.slideOutTiming}`,requestAnimationFrame((()=>{switch(this.slideOutDir){case"up":this.wrapper.style.transform=`translateY(-${this.slideOutDist}px)`;break;case"right":this.wrapper.style.transform=`translateX(${this.slideOutDist}px)`;break;case"down":this.wrapper.style.transform=`translateY(${this.slideOutDist}px)`;break;case"left":this.wrapper.style.transform=`translateX(-${this.slideOutDist}px)`;break;default:this.wrapper.style.transform="transform(0px)"}}))),this.fadeOut&&(t?t+=`, opacity ${this.fadeOutDuration}ms ${this.fadeOutTiming}`:t=`, opacity ${this.fadeOutDuration}ms ${this.fadeOutTiming}`,requestAnimationFrame((()=>{this.wrapper.style.opacity=0}))),t&&(this.wrapper.style.transition=t),this.slideOutDir||this.fadeOut?setTimeout((()=>{this.container.remove()}),Math.max(this.slideOutDir?this.slideOutDuration:0,this.fadeOut?this.fadeOutDuration:0)):this.container.remove()}static alert(t,e={}){return new es({message:t,choices:["Close"],values:[null],width:"auto",...e}).show()}static confirm(t,e={}){return new es({message:t,choices:["Cancel","OK"],values:[!1,!0],width:"400px",...e}).show()}static prompt(t,e={}){const n=document.createElement("div"),i=document.createElement("textarea");i.style.display="block",i.style.width="400px",i.style.marginTop="1em",i.style.fontSize="16px",n.append(t,i);const r=new es({message:n,choices:["Cancel","OK"],values:[null,()=>i.value],width:"auto",...e}),s=new Promise(((t,e)=>{i.addEventListener("keyup",(e=>{"Enter"==e.key&&(e.ctrlKey||e.metaKey)&&(t(i.value),r.hide())}))})),o=r.show().then((t=>t&&t()));return Promise.race([s,o])}static toastMessage(t,e={}){return new es({message:t,backgroundColor:"#61A1EA",messageColor:"#FFFFFF",messageFontSize:"14px",messageFontWeight:700,blocking:!1,justify:"end",align:"start",shadow:"0 0 10px 1px rgba(0, 0, 0, 0.2)",slideInDir:"down",slideInDist:150,slideOutDir:"right",slideOutDist:300,timeout:5e3,...e}).show()}static toastError(t,e={}){return new es({message:t,backgroundColor:"#E36868",messageColor:"#FFFFFF",messageFontSize:"14px",messageFontWeight:700,blocking:!1,justify:"end",align:"start",shadow:"0 0 10px 1px rgba(0, 0, 0, 0.2)",slideInDir:"down",slideInDist:150,slideOutDir:"right",slideOutDist:300,timeout:5e3,...e}).show()}}class ns{constructor(t,e=(()=>{}),...n){this.date=t,this.callback=()=>e(...n),this.time=this.date.getTime()-(new Date).getTime(),this.elements=[],this.interval=setInterval((()=>{this.update()}),500)}update(){this.time=this.date.getTime()-(new Date).getTime(),this.time<=0?this.finish():this.show()}show(){const t=this.time,e=Math.floor(t/864e5),n=t%864e5,i=Math.floor(n/36e5),r=t%36e5,s=Math.floor(r/6e4),o=t%6e4,a=Math.floor(o/1e3);for(const t of this.elements)t.textContent=e?`${e}:${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:i?`${i.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`:`${s.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}attach(t){this.elements.push(t),this.show()}detach(t){const e=this.elements.indexOf(t);-1!==e&&(this.elements[e].textContent="",this.elements.splice(e,1),this.show())}cleanUp(){clearInterval(this.interval);for(let t=this.elements.length-1;t>=0;t--)this.detach(this.elements[t])}finish(){this.callback(),clearInterval(this.interval),this.time=0,this.show()}}const is=function(t=_t()){const e=mt(t,"auth");if(e.isInitialized())return e.getImmediate();const n=function(t,e){const n=mt(t,"auth");if(n.isInitialized()){const t=n.getImmediate();if(v(n.getOptions(),null!=e?e:{}))return t;_n(t,"already-initialized")}return n.initialize({options:e})}(t,{popupRedirectResolver:Wr,persistence:[gr,Yi,tr]}),i=u("authTokenSyncURL");if(i){const t=(r=i,async t=>{const e=t&&await t.getIdTokenResult(),n=e&&((new Date).getTime()-Date.parse(e.issuedAtTime))/1e3;if(n&&n>Yr)return;const i=null==e?void 0:e.token;Zr!==i&&(Zr=i,await fetch(r,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(t,e,n){N(t).beforeAuthStateChanged(e,n)}(n,t,(()=>t(n.currentUser))),function(e,n,i,r){N(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}var r;const s=a("auth");return s&&function(t,e,n){const i=Ti(t);Tn(i._canInitEmulator,i,"emulator-config-failed"),Tn(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),s=Ci(e),{host:o,port:a}=function(t){const e=Ci(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){const t=r[1];return{host:t,port:ki(i.substr(t.length+1))}}{const[t,e]=i.split(":");return{host:t,port:ki(e)}}}(e),c=null===a?"":`:${a}`;i.config.emulator={url:`${s}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:r})}),r||function(){function t(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t())}()}(n,`http://${s}`),n}(gn),rs=432e6;let ss,os,as;window.addEventListener("storage",(t=>{"authExpiration"===t.key&&us()})),window.addEventListener("DOMContentLoaded",(function(){!function(){if(hs("public",location.pathname))return;const t=document.createElement("div");t.id="siteWideLoadingScreen";const e=document.createElement("style");e.innerHTML="\n    #siteWideLoadingScreen {\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        height: 100vh;\n        width: 100vw;\n        position: absolute;\n        background-color: white;\n        z-index: 9999;\n        display: flex;\n    }\n      \n    body.authorized > #siteWideLoadingScreen {\n        display: none;\n    }\n      \n    #siteWideLoadingScreen:before {\n        content: '';\n        display: block;\n        border: 20px solid white;\n        border-top: 20px solid #110D65;\n        border-radius: 50%;\n        width: 100px;\n        height: 100px;\n        animation: spin 2s linear infinite;\n        left: 0;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        margin: auto;\n        position: absolute;\n    }\n      \n    @keyframes spin {\n        0% { transform: rotate(0deg); }\n        100% { transform: rotate(360deg); }\n    }\n    ",document.body.appendChild(e),document.body.appendChild(t),document.body.classList.remove("authorized")}();try{Gi(is,(async t=>{let e=location.pathname;if(t){if(!localStorage.getItem("authExpiration")||parseInt(localStorage.getItem("authExpiration"))<(new Date).getTime())return void ls(!0);const n=(await Bn(t)).claims.role,i=new URLSearchParams(document.location.search).get("redirect");if(i)return void window.location.replace(location.origin+decodeURI(i));if(!hs(n,e))return void function(t,e){switch(t){case"public":default:window.location.replace(`${location.origin}/sign-in`);break;case"student":window.location.replace(`${location.origin}/test-taker/${e}`);break;case"parent":window.location.replace(`${location.origin}/Dashboard/Parent`);break;case"tutor":window.location.replace(`${location.origin}/Dashboard/Tutor`);break;case"admin":window.location.replace(`${location.origin}/Dashboard/Admin`);break;case"dev":window.location.replace(`${location.origin}/Dashboard/Dev`)}}(n,t.uid);localStorage.setItem("authExpiration",((new Date).getTime()+rs).toString()),us()}else if(!hs("public",e)){const t=encodeURI(e);return void window.location.replace(location.origin+"/sign-in?redirect="+t)}document.body.classList.add("authorized")}))}catch(t){console.log(t),window.location.replace(location.origin+"/sign-in")}}));let cs={all:["/","/free-test-taker","/pricing","/why","/careers","/sign-up"],public:["/sign-in"],student:["/Dashboard/Student","/test-taker/*"],parent:["/Dashboard/Parent","/test-taker/*"],tutor:["/Dashboard/Tutor","/new-assignment","/view-curriculum","/student-overview/*","/test-taker/*"],admin:["&student","&parent","&tutor","/Dashboard/Admin","/new-parent","/new-student","/new-tutor"],dev:["&student","&parent","&tutor","&admin","/Dashboard/Dev","/testEditor","/analytics"]};async function us(){as&&as.hide(),ss&&ss.cleanUp(),os&&os.cleanUp();const t=localStorage.getItem("authExpiration")&&parseInt(localStorage.getItem("authExpiration"));ss=new ns(new Date(t),(()=>{ls(!0)})),os=new ns(new Date(t-3e5),(async()=>{const t=document.createElement("p");t.style.margin="0",t.textContent="Are you still there? You will be signed out in ";const e=document.createElement("span");ss.attach(e),t.appendChild(e),as=new es({message:t,choices:["YES","NO"],values:[!0,!1],timeout:ss.time,slideInDir:"down",fadeIn:!0});const n=await as.show();!0===n?(localStorage.setItem("authExpiration",((new Date).getTime()+rs).toString()),us()):!1===n&&(as.hide(),localStorage.setItem("authExpiration",((new Date).getTime()+rs).toString()),us(),ls())}))}function hs(t,e){const n=[...cs[t]??[],...cs.all];for(const t of n){const n=t.split("/"),i=e.split("/");if(n.length>i.length)continue;let r=!0;for(let t=0;t<i.length;t++){if(t<n.length&&i[t]!==n[t]&&"*"!==n[t]&&"**"!==n[t]){r=!1;break}if(t>=n.length&&"**"!==n[n.length-1]){r=!1;break}}if(!0===r)return!0}return!1}async function ls(t=!1){if(t)await Wi(is);else{const t=new es({message:"Are you sure you want to sign out?",choices:["YES","NO"],values:[!0,!1],slideInDir:"down",fadeIn:!0});await t.show()&&await Wi(is)}}!function(){for(const t in cs)cs[t]=cs[t].flatMap((t=>"&"===t.charAt(0)?cs[t.slice(1)]:t))}();var ds,fs="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ps={},gs=gs||{},ms=fs||self;function ys(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function vs(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var ws="closure_uid_"+(1e9*Math.random()>>>0),Is=0;function _s(t,e,n){return t.call.apply(t.bind,arguments)}function bs(t,e,n){if(!t)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Es(t,e,n){return(Es=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?_s:bs).apply(null,arguments)}function Ts(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Ss(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,i){for(var r=Array(arguments.length-2),s=2;s<arguments.length;s++)r[s-2]=arguments[s];return e.prototype[n].apply(t,r)}}function Cs(){this.s=this.s,this.o=this.o}Cs.prototype.s=!1,Cs.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,ws)&&t[ws]||(t[ws]=++Is))},Cs.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const ks=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function As(t){const e=t.length;if(0<e){const n=Array(e);for(let i=0;i<e;i++)n[i]=t[i];return n}return[]}function Ds(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(ys(n)){const e=t.length||0,i=n.length||0;t.length=e+i;for(let r=0;r<i;r++)t[e+r]=n[r]}else t.push(n)}}function Ns(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Ns.prototype.h=function(){this.defaultPrevented=!0};var Rs=function(){if(!ms.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{ms.addEventListener("test",(()=>{}),e),ms.removeEventListener("test",(()=>{}),e)}catch(t){}return t}();function Os(t){return/^[\s\xa0]*$/.test(t)}function Ps(){var t=ms.navigator;return t&&(t=t.userAgent)?t:""}function Ls(t){return-1!=Ps().indexOf(t)}function Ms(t){return Ms[" "](t),t}Ms[" "]=function(){};var xs,Fs,Us,Vs=Ls("Opera"),js=Ls("Trident")||Ls("MSIE"),$s=Ls("Edge"),Bs=$s||js,qs=Ls("Gecko")&&!(-1!=Ps().toLowerCase().indexOf("webkit")&&!Ls("Edge"))&&!(Ls("Trident")||Ls("MSIE"))&&!Ls("Edge"),zs=-1!=Ps().toLowerCase().indexOf("webkit")&&!Ls("Edge");function Ks(){var t=ms.document;return t?t.documentMode:void 0}t:{var Hs="",Gs=(Fs=Ps(),qs?/rv:([^\);]+)(\)|;)/.exec(Fs):$s?/Edge\/([\d\.]+)/.exec(Fs):js?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Fs):zs?/WebKit\/(\S+)/.exec(Fs):Vs?/(?:Version)[ \/]?(\S+)/.exec(Fs):void 0);if(Gs&&(Hs=Gs?Gs[1]:""),js){var Ws=Ks();if(null!=Ws&&Ws>parseFloat(Hs)){xs=String(Ws);break t}}xs=Hs}ms.document&&js?Us=Ks()||parseInt(xs,10)||void 0:Us=void 0;var Qs=Us;function Js(t,e){if(Ns.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,i=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(qs){t:{try{Ms(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Xs[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Js.$.h.call(this)}}Ss(Js,Ns);var Xs={2:"touch",3:"pen",4:"mouse"};Js.prototype.h=function(){Js.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),Zs=0;function to(t,e,n,i,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!i,this.la=r,this.key=++Zs,this.fa=this.ia=!1}function eo(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function no(t,e,n){for(const i in t)e.call(n,t[i],i,t)}function io(t){const e={};for(const n in t)e[n]=t[n];return e}const ro="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function so(t,e){let n,i;for(let e=1;e<arguments.length;e++){for(n in i=arguments[e],i)t[n]=i[n];for(let e=0;e<ro.length;e++)n=ro[e],Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}}function oo(t){this.src=t,this.g={},this.h=0}function ao(t,e){var n=e.type;if(n in t.g){var i,r=t.g[n],s=ks(r,e);(i=0<=s)&&Array.prototype.splice.call(r,s,1),i&&(eo(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function co(t,e,n,i){for(var r=0;r<t.length;++r){var s=t[r];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==i)return r}return-1}oo.prototype.add=function(t,e,n,i,r){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=co(t,e,i,r);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new to(e,this.src,s,!!i,r)).ia=n,t.push(e)),e};var uo="closure_lm_"+(1e6*Math.random()|0),ho={};function lo(t,e,n,i,r){if(i&&i.once)return po(t,e,n,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)lo(t,e[s],n,i,r);return null}return n=_o(n),t&&t[Ys]?t.O(e,n,vs(i)?!!i.capture:!!i,r):fo(t,e,n,!1,i,r)}function fo(t,e,n,i,r,s){if(!e)throw Error("Invalid event type");var o=vs(r)?!!r.capture:!!r,a=wo(t);if(a||(t[uo]=a=new oo(t)),(n=a.add(e,n,i,o,s)).proxy)return n;if(i=function(){const t=vo;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=i,i.src=t,i.listener=n,t.addEventListener)Rs||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),i,r);else if(t.attachEvent)t.attachEvent(yo(e.toString()),i);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(i)}return n}function po(t,e,n,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)po(t,e[s],n,i,r);return null}return n=_o(n),t&&t[Ys]?t.P(e,n,vs(i)?!!i.capture:!!i,r):fo(t,e,n,!0,i,r)}function go(t,e,n,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)go(t,e[s],n,i,r);else i=vs(i)?!!i.capture:!!i,n=_o(n),t&&t[Ys]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=co(s=t.g[e],n,i,r))&&(eo(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=wo(t))&&(e=t.g[e.toString()],t=-1,e&&(t=co(e,n,i,r)),(n=-1<t?e[t]:null)&&mo(n))}function mo(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[Ys])ao(e.i,t);else{var n=t.type,i=t.proxy;e.removeEventListener?e.removeEventListener(n,i,t.capture):e.detachEvent?e.detachEvent(yo(n),i):e.addListener&&e.removeListener&&e.removeListener(i),(n=wo(e))?(ao(n,t),0==n.h&&(n.src=null,e[uo]=null)):eo(t)}}}function yo(t){return t in ho?ho[t]:ho[t]="on"+t}function vo(t,e){if(t.fa)t=!0;else{e=new Js(e,this);var n=t.listener,i=t.la||t.src;t.ia&&mo(t),t=n.call(i,e)}return t}function wo(t){return(t=t[uo])instanceof oo?t:null}var Io="__closure_events_fn_"+(1e9*Math.random()>>>0);function _o(t){return"function"==typeof t?t:(t[Io]||(t[Io]=function(e){return t.handleEvent(e)}),t[Io])}function bo(){Cs.call(this),this.i=new oo(this),this.S=this,this.J=null}function Eo(t,e){var n,i=t.J;if(i)for(n=[];i;i=i.J)n.push(i);if(t=t.S,i=e.type||e,"string"==typeof e)e=new Ns(e,t);else if(e instanceof Ns)e.target=e.target||t;else{var r=e;so(e=new Ns(i,t),r)}if(r=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];r=To(o,i,!0,e)&&r}if(r=To(o=e.g=t,i,!0,e)&&r,r=To(o,i,!1,e)&&r,n)for(s=0;s<n.length;s++)r=To(o=e.g=n[s],i,!1,e)&&r}function To(t,e,n,i){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&ao(t.i,o),r=!1!==a.call(c,i)&&r}}return r&&!i.defaultPrevented}Ss(bo,Cs),bo.prototype[Ys]=!0,bo.prototype.removeEventListener=function(t,e,n,i){go(this,t,e,n,i)},bo.prototype.N=function(){if(bo.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],i=0;i<n.length;i++)eo(n[i]);delete e.g[t],e.h--}}this.J=null},bo.prototype.O=function(t,e,n,i){return this.i.add(String(t),e,!1,n,i)},bo.prototype.P=function(t,e,n,i){return this.i.add(String(t),e,!0,n,i)};var So=ms.JSON.stringify;function Co(){var t=Po;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var ko=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ao),(t=>t.reset()));class Ao{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Do(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function No(t){ms.setTimeout((()=>{throw t}),0)}let Ro,Oo=!1,Po=new class{constructor(){this.h=this.g=null}add(t,e){const n=ko.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Lo=()=>{const t=ms.Promise.resolve(void 0);Ro=()=>{t.then(Mo)}};var Mo=()=>{for(var t;t=Co();){try{t.h.call(t.g)}catch(t){No(t)}var e=ko;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Oo=!1};function xo(t,e){bo.call(this),this.h=t||1,this.g=e||ms,this.j=Es(this.qb,this),this.l=Date.now()}function Fo(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function Uo(t,e,n){if("function"==typeof t)n&&(t=Es(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Es(t.handleEvent,t)}return 2147483647<Number(e)?-1:ms.setTimeout(t,e||0)}function Vo(t){t.g=Uo((()=>{t.g=null,t.i&&(t.i=!1,Vo(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}Ss(xo,bo),(ds=xo.prototype).ga=!1,ds.T=null,ds.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Eo(this,"tick"),this.ga&&(Fo(this),this.start()))}},ds.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},ds.N=function(){xo.$.N.call(this),Fo(this),delete this.g};class jo extends Cs{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Vo(this)}N(){super.N(),this.g&&(ms.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $o(t){Cs.call(this),this.h=t,this.g={}}Ss($o,Cs);var Bo=[];function qo(t,e,n,i){Array.isArray(n)||(n&&(Bo[0]=n.toString()),n=Bo);for(var r=0;r<n.length;r++){var s=lo(e,n[r],i||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function zo(t){no(t.g,(function(t,e){this.g.hasOwnProperty(e)&&mo(t)}),t),t.g={}}function Ko(){this.g=!0}function Ho(t,e,n,i){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var i=n[t];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<r.length;o++)r[o]=""}}}return So(n)}catch(t){return e}}(t,n)+(i?" "+i:"")}))}$o.prototype.N=function(){$o.$.N.call(this),zo(this)},$o.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ko.prototype.Ea=function(){this.g=!1},Ko.prototype.info=function(){};var Go={},Wo=null;function Qo(){return Wo=Wo||new bo}function Jo(t){Ns.call(this,Go.Ta,t)}function Xo(t){const e=Qo();Eo(e,new Jo(e))}function Yo(t,e){Ns.call(this,Go.STAT_EVENT,t),this.stat=e}function Zo(t){const e=Qo();Eo(e,new Yo(e,t))}function ta(t,e){Ns.call(this,Go.Ua,t),this.size=e}function ea(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return ms.setTimeout((function(){t()}),e)}Go.Ta="serverreachability",Ss(Jo,Ns),Go.STAT_EVENT="statevent",Ss(Yo,Ns),Go.Ua="timingevent",Ss(ta,Ns);var na={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ia={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ra(){}function sa(t){return t.h||(t.h=t.i())}function oa(){}ra.prototype.h=null;var aa,ca={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function ua(){Ns.call(this,"d")}function ha(){Ns.call(this,"c")}function la(){}function da(t,e,n,i){this.l=t,this.j=e,this.m=n,this.W=i||1,this.U=new $o(this),this.P=pa,t=Bs?125:void 0,this.V=new xo(t),this.I=null,this.i=!1,this.s=this.A=this.v=this.L=this.G=this.Y=this.B=null,this.F=[],this.g=null,this.C=0,this.o=this.u=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new fa}function fa(){this.i=null,this.g="",this.h=!1}Ss(ua,Ns),Ss(ha,Ns),Ss(la,ra),la.prototype.g=function(){return new XMLHttpRequest},la.prototype.i=function(){return{}},aa=new la;var pa=45e3,ga={},ma={};function ya(t,e,n){t.L=1,t.v=xa(Ra(e)),t.s=n,t.S=!0,va(t,null)}function va(t,e){t.G=Date.now(),ba(t),t.A=Ra(t.v);var n=t.A,i=t.W;Array.isArray(i)||(i=[String(i)]),Qa(n.i,"t",i),t.C=0,n=t.l.J,t.h=new fa,t.g=Wc(t.l,n?e:null,!t.s),0<t.O&&(t.M=new jo(Es(t.Pa,t,t.g),t.O)),qo(t.U,t.g,"readystatechange",t.nb),e=t.I?io(t.I):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.A,t.u,t.s,e)):(t.u="GET",t.g.ha(t.A,t.u,null,e)),Xo(),function(t,e,n,i,r,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.W,t.s)}function wa(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.l.Ha}function Ia(t,e,n){let i,r=!0;for(;!t.J&&t.C<n.length;){if(i=_a(t,n),i==ma){4==e&&(t.o=4,Zo(14),r=!1),Ho(t.j,t.m,null,"[Incomplete Response]");break}if(i==ga){t.o=4,Zo(15),Ho(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}Ho(t.j,t.m,i,null),ka(t,i)}wa(t)&&i!=ma&&i!=ga&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,Zo(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),jc(e),e.M=!0,Zo(11))):(Ho(t.j,t.m,n,"[Invalid Chunked Response]"),Ca(t),Sa(t))}function _a(t,e){var n=t.C,i=e.indexOf("\n",n);return-1==i?ma:(n=Number(e.substring(n,i)),isNaN(n)?ga:(i+=1)+n>e.length?ma:(e=e.slice(i,i+n),t.C=i+n,e))}function ba(t){t.Y=Date.now()+t.P,Ea(t,t.P)}function Ea(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=ea(Es(t.lb,t),e)}function Ta(t){t.B&&(ms.clearTimeout(t.B),t.B=null)}function Sa(t){0==t.l.H||t.J||qc(t.l,t)}function Ca(t){Ta(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,Fo(t.V),zo(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function ka(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||ec(n.i,t)))if(!t.K&&ec(n.i,t)&&3==n.H){try{var i=n.Ja.g.parse(e)}catch(t){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Bc(n),Oc(n)}Vc(n),Zo(18)}}else n.Fa=r[1],0<n.Fa-n.V&&37500>r[2]&&n.G&&0==n.A&&!n.v&&(n.v=ea(Es(n.ib,n),6e3));if(1>=tc(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Kc(n,11)}else if((t.K||n.g==t)&&Bc(n),!Os(e))for(r=n.Ja.g.parse(e),e=0;e<r.length;e++){let u=r[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const r=u[4];null!=r&&(n.Ga=r,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(i=1.5*h,n.L=i,n.l.info("backChannelRequestTimeoutMs_="+i)),i=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=i.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(nc(s,s.h),s.h=null))}if(i.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(i.Da=t,Ma(i.I,i.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((i=n).wa=Gc(i,i.J?i.pa:null,i.Y),o.K){ic(i.i,o);var a=o,c=i.L;c&&a.setTimeout(c),a.B&&(Ta(a),ba(a)),i.g=o}else Uc(i);0<n.j.length&&Lc(n)}else"stop"!=u[0]&&"close"!=u[0]||Kc(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Kc(n,7):Rc(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}Xo()}catch(t){}}function Aa(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(ys(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(ys(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const i in t)e[n++]=i;return e}}}(t),i=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(ys(t)){for(var e=[],n=t.length,i=0;i<n;i++)e.push(t[i]);return e}for(i in e=[],n=0,t)e[n++]=t[i];return e}(t),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],n&&n[s],t)}(ds=da.prototype).setTimeout=function(t){this.P=t},ds.nb=function(t){t=t.target;const e=this.M;e&&3==Sc(t)?e.l():this.Pa(t)},ds.Pa=function(t){try{if(t==this.g)t:{const h=Sc(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||Bs||this.g&&(this.h.h||this.g.ja()||Cc(this.g)))){this.J||4!=h||7==e||Xo(),Ta(this);var n=this.g.da();this.ca=n;e:if(wa(this)){var i=Cc(this.g);t="";var r=i.length,s=4==Sc(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ca(this),Sa(this);var o="";break e}this.h.i=new ms.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,i,r,s,o){t.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.u,this.A,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Os(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,Zo(12),Ca(this),Sa(this);break t}Ho(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ka(this,n)}this.S?(Ia(this,h,o),Bs&&this.i&&3==h&&(qo(this.U,this.V,"tick",this.mb),this.V.start())):(Ho(this.j,this.m,o,null),ka(this,o)),4==h&&Ca(this),this.i&&!this.J&&(4==h?qc(this.l,this):(this.i=!1,ba(this)))}else(function(t){const e={};t=(t.g&&2<=Sc(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<t.length;i++){if(Os(t[i]))continue;var n=Do(t[i]);const r=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[r]||[];e[r]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.o=3,Zo(12)):(this.o=0,Zo(13)),Ca(this),Sa(this)}}}catch(t){}},ds.mb=function(){if(this.g){var t=Sc(this.g),e=this.g.ja();this.C<e.length&&(Ta(this),Ia(this,t,e),this.i&&4!=t&&ba(this))}},ds.cancel=function(){this.J=!0,Ca(this)},ds.lb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.L&&(Xo(),Zo(17)),Ca(this),this.o=2,Sa(this)):Ea(this,this.Y-t)};var Da=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Na(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Na){this.h=t.h,Oa(this,t.j),this.s=t.s,this.g=t.g,Pa(this,t.m),this.l=t.l;var e=t.i,n=new Ka;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),La(this,n),this.o=t.o}else t&&(e=String(t).match(Da))?(this.h=!1,Oa(this,e[1]||"",!0),this.s=Fa(e[2]||""),this.g=Fa(e[3]||"",!0),Pa(this,e[4]),this.l=Fa(e[5]||"",!0),La(this,e[6]||"",!0),this.o=Fa(e[7]||"")):(this.h=!1,this.i=new Ka(null,this.h))}function Ra(t){return new Na(t)}function Oa(t,e,n){t.j=n?Fa(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Pa(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function La(t,e,n){e instanceof Ka?(t.i=e,function(t,e){e&&!t.j&&(Ha(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ga(this,e),Qa(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=Ua(e,qa)),t.i=new Ka(e,t.h))}function Ma(t,e,n){t.i.set(e,n)}function xa(t){return Ma(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Fa(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ua(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Va),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Va(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Na.prototype.toString=function(){var t=[],e=this.j;e&&t.push(Ua(e,ja,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(Ua(e,ja,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ua(n,"/"==n.charAt(0)?Ba:$a,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",Ua(n,za)),t.join("")};var ja=/[#\/\?@]/g,$a=/[#\?:]/g,Ba=/[#\?]/g,qa=/[#\?@]/g,za=/#/g;function Ka(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Ha(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var i=t[n].indexOf("="),r=null;if(0<=i){var s=t[n].substring(0,i);r=t[n].substring(i+1)}else s=t[n];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ga(t,e){Ha(t),e=Ja(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Wa(t,e){return Ha(t),e=Ja(t,e),t.g.has(e)}function Qa(t,e,n){Ga(t,e),0<n.length&&(t.i=null,t.g.set(Ja(t,e),As(n)),t.h+=n.length)}function Ja(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Xa(t){this.l=t||Ya,t=ms.PerformanceNavigationTiming?0<(t=ms.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(ms.g&&ms.g.Ka&&ms.g.Ka()&&ms.g.Ka().ec),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(ds=Ka.prototype).add=function(t,e){Ha(this),this.i=null,t=Ja(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},ds.forEach=function(t,e){Ha(this),this.g.forEach((function(n,i){n.forEach((function(n){t.call(e,n,i,this)}),this)}),this)},ds.ta=function(){Ha(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let i=0;i<e.length;i++){const r=t[i];for(let t=0;t<r.length;t++)n.push(e[i])}return n},ds.Z=function(t){Ha(this);let e=[];if("string"==typeof t)Wa(this,t)&&(e=e.concat(this.g.get(Ja(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},ds.set=function(t,e){return Ha(this),this.i=null,Wa(this,t=Ja(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},ds.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},ds.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var i=e[n];const s=encodeURIComponent(String(i)),o=this.Z(i);for(i=0;i<o.length;i++){var r=s;""!==o[i]&&(r+="="+encodeURIComponent(String(o[i]))),t.push(r)}}return this.i=t.join("&")};var Ya=10;function Za(t){return!!t.h||!!t.g&&t.g.size>=t.j}function tc(t){return t.h?1:t.g?t.g.size:0}function ec(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function nc(t,e){t.g?t.g.add(e):t.h=e}function ic(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function rc(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return As(t.i)}Xa.prototype.cancel=function(){if(this.i=rc(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var sc=class{stringify(t){return ms.JSON.stringify(t,void 0)}parse(t){return ms.JSON.parse(t,void 0)}};function oc(){this.g=new sc}function ac(t,e,n){const i=n||"";try{Aa(t,(function(t,n){let r=t;vs(t)&&(r=So(t)),e.push(i+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(i+"type="+encodeURIComponent("_badmap")),t}}function cc(t,e,n,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(t){}}function uc(t){this.l=t.fc||null,this.j=t.ob||!1}function hc(t,e){bo.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=lc,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ss(uc,ra),uc.prototype.g=function(){return new hc(this.l,this.j)},uc.prototype.i=function(t){return function(){return t}}({}),Ss(hc,bo);var lc=0;function dc(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function fc(t){t.readyState=4,t.l=null,t.j=null,t.A=null,pc(t)}function pc(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(ds=hc.prototype).open=function(t,e){if(this.readyState!=lc)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,pc(this)},ds.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||ms).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},ds.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,fc(this)),this.readyState=lc},ds.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,pc(this)),this.g&&(this.readyState=3,pc(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==ms.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;dc(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},ds.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?fc(this):pc(this),3==this.readyState&&dc(this)}},ds.Za=function(t){this.g&&(this.response=this.responseText=t,fc(this))},ds.Ya=function(t){this.g&&(this.response=t,fc(this))},ds.ka=function(){this.g&&fc(this)},ds.setRequestHeader=function(t,e){this.v.append(t,e)},ds.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},ds.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(hc.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var gc=ms.JSON.parse;function mc(t){bo.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=yc,this.L=this.M=!1}Ss(mc,bo);var yc="",vc=/^https?$/i,wc=["POST","PUT"];function Ic(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,_c(t),Ec(t)}function _c(t){t.F||(t.F=!0,Eo(t,"complete"),Eo(t,"error"))}function bc(t){if(t.h&&void 0!==gs&&(!t.C[1]||4!=Sc(t)||2!=t.da()))if(t.v&&4==Sc(t))Uo(t.La,0,t);else if(Eo(t,"readystatechange"),4==Sc(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var i;if(i=0===o){var r=String(t.I).match(Da)[1]||null;!r&&ms.self&&ms.self.location&&(r=ms.self.location.protocol.slice(0,-1)),i=!vc.test(r?r.toLowerCase():"")}n=i}if(n)Eo(t,"complete"),Eo(t,"success");else{t.m=6;try{var s=2<Sc(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",_c(t)}}finally{Ec(t)}}}function Ec(t,e){if(t.g){Tc(t);const n=t.g,i=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Eo(t,"ready");try{n.onreadystatechange=i}catch(t){}}}function Tc(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(ms.clearTimeout(t.A),t.A=null)}function Sc(t){return t.g?t.g.readyState:0}function Cc(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case yc:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function kc(t){let e="";return no(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Ac(t,e,n){t:{for(i in n){var i=!1;break t}i=!0}i||(n=kc(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Ma(t,e,n))}function Dc(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Nc(t){this.Ga=0,this.j=[],this.l=new Ko,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Dc("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Dc("baseRetryDelayMs",5e3,t),this.hb=Dc("retryDelaySeedMs",1e4,t),this.eb=Dc("forwardChannelMaxRetries",2,t),this.xa=Dc("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.dc||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new Xa(t&&t.concurrentRequestLimit),this.Ja=new oc,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Rc(t){if(Pc(t),3==t.H){var e=t.W++,n=Ra(t.I);if(Ma(n,"SID",t.K),Ma(n,"RID",e),Ma(n,"TYPE","terminate"),xc(t,n),(e=new da(t,t.l,e)).L=2,e.v=xa(Ra(n)),n=!1,ms.navigator&&ms.navigator.sendBeacon)try{n=ms.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&ms.Image&&((new Image).src=e.v,n=!0),n||(e.g=Wc(e.l,null),e.g.ha(e.v)),e.G=Date.now(),ba(e)}Hc(t)}function Oc(t){t.g&&(jc(t),t.g.cancel(),t.g=null)}function Pc(t){Oc(t),t.u&&(ms.clearTimeout(t.u),t.u=null),Bc(t),t.i.cancel(),t.m&&("number"==typeof t.m&&ms.clearTimeout(t.m),t.m=null)}function Lc(t){if(!Za(t.i)&&!t.m){t.m=!0;var e=t.Na;Ro||Lo(),Oo||(Ro(),Oo=!0),Po.add(e,t),t.C=0}}function Mc(t,e){var n;n=e?e.m:t.W++;const i=Ra(t.I);Ma(i,"SID",t.K),Ma(i,"RID",n),Ma(i,"AID",t.V),xc(t,i),t.o&&t.s&&Ac(i,t.o,t.s),n=new da(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=Fc(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),nc(t.i,n),ya(n,i,e)}function xc(t,e){t.na&&no(t.na,(function(t,n){Ma(e,n,t)})),t.h&&Aa({},(function(t,n){Ma(e,n,t)}))}function Fc(t,e,n){n=Math.min(t.j.length,n);var i=t.h?Es(t.h.Va,t.h,t):null;t:{var r=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=r[o].g;const a=r[o].map;if(n-=e,0>n)e=Math.max(0,r[o].g-100),s=!1;else try{ac(a,t,"req"+n+"_")}catch(t){i&&i(a)}}if(s){i=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,i}function Uc(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Ro||Lo(),Oo||(Ro(),Oo=!0),Po.add(e,t),t.A=0}}function Vc(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=ea(Es(t.Ma,t),zc(t,t.A)),t.A++,0))}function jc(t){null!=t.B&&(ms.clearTimeout(t.B),t.B=null)}function $c(t){t.g=new da(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Ra(t.wa);Ma(e,"RID","rpc"),Ma(e,"SID",t.K),Ma(e,"AID",t.V),Ma(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Ma(e,"TO",t.qa),Ma(e,"TYPE","xmlhttp"),xc(t,e),t.o&&t.s&&Ac(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.v=xa(Ra(e)),n.s=null,n.S=!0,va(n,t)}function Bc(t){null!=t.v&&(ms.clearTimeout(t.v),t.v=null)}function qc(t,e){var n=null;if(t.g==e){Bc(t),jc(t),t.g=null;var i=2}else{if(!ec(t.i,e))return;n=e.F,ic(t.i,e),i=1}if(0!=t.H)if(e.i)if(1==i){n=e.s?e.s.length:0,e=Date.now()-e.G;var r=t.C;Eo(i=Qo(),new ta(i,n)),Lc(t)}else Uc(t);else if(3==(r=e.o)||0==r&&0<e.ca||!(1==i&&function(t,e){return!(tc(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=ea(Es(t.Na,t,e),zc(t,t.C)),t.C++,0)))}(t,e)||2==i&&Vc(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Kc(t,5);break;case 4:Kc(t,10);break;case 3:Kc(t,6);break;default:Kc(t,2)}}function zc(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Kc(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var i=Es(t.pb,t);n||(n=new Na("//www.google.com/images/cleardot.gif"),ms.location&&"http"==ms.location.protocol||Oa(n,"https"),xa(n)),function(t,e){const n=new Ko;if(ms.Image){const i=new Image;i.onload=Ts(cc,n,i,"TestLoadImage: loaded",!0,e),i.onerror=Ts(cc,n,i,"TestLoadImage: error",!1,e),i.onabort=Ts(cc,n,i,"TestLoadImage: abort",!1,e),i.ontimeout=Ts(cc,n,i,"TestLoadImage: timeout",!1,e),ms.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=t}else e(!1)}(n.toString(),i)}else Zo(2);t.H=0,t.h&&t.h.za(e),Hc(t),Pc(t)}function Hc(t){if(t.H=0,t.ma=[],t.h){const e=rc(t.i);0==e.length&&0==t.j.length||(Ds(t.ma,e),Ds(t.ma,t.j),t.i.i.length=0,As(t.j),t.j.length=0),t.h.ya()}}function Gc(t,e,n){var i=n instanceof Na?Ra(n):new Na(n);if(""!=i.g)e&&(i.g=e+"."+i.g),Pa(i,i.m);else{var r=ms.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new Na(null);i&&Oa(s,i),e&&(s.g=e),r&&Pa(s,r),n&&(s.l=n),i=s}return n=t.F,e=t.Da,n&&e&&Ma(i,n,e),Ma(i,"VER",t.ra),xc(t,i),i}function Wc(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ha&&!t.va?new mc(new uc({ob:!0})):new mc(t.va)).Oa(t.J),e}function Qc(){}function Jc(){if(js&&!(10<=Number(Qs)))throw Error("Environmental error: no available transport.")}function Xc(t,e){bo.call(this),this.g=new Nc(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Os(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Os(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new tu(this)}function Yc(t){ua.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Zc(){ha.call(this),this.status=1}function tu(t){this.g=t}function eu(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function nu(t,e,n){n||(n=0);var i=Array(16);if("string"==typeof e)for(var r=0;16>r;++r)i[r]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(r=0;16>r;++r)i[r]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],r=t.g[2];var s=t.g[3],o=e+(s^n&(r^s))+i[0]+3614090360&4294967295;o=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=(n=(r=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(r^s))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(r^e&(n^r))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=r+(n^s&(e^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^r&(s^e))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(r^s&(n^r))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(r^s&(n^r))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^r&(e^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=r+(e^n&(s^e))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(r^s))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^r^s)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^r^s)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^r)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=r+(s^e^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(r^s^e)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(r^(n|~s))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(r^(n|~s))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=r+(e^(s|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(r|~e))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(r^(n|~s))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~r))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((r=s+((o=r+(e^(s|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+i[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(r+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+r&4294967295,t.g[3]=t.g[3]+s&4294967295}function iu(t,e){this.h=e;for(var n=[],i=!0,r=t.length-1;0<=r;r--){var s=0|t[r];i&&s==e||(n[r]=s,i=!1)}this.g=n}(ds=mc.prototype).Oa=function(t){this.M=t},ds.ha=function(t,e,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():aa.g(),this.C=this.u?sa(this.u):sa(aa),this.g.onreadystatechange=Es(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Ic(this,t)}if(t=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const t of i.keys())n.set(t,i.get(t))}i=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),r=ms.FormData&&t instanceof ms.FormData,!(0<=ks(wc,e))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{Tc(this),0<this.B&&((this.L=function(t){return js&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Es(this.ua,this)):this.A=Uo(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ic(this,t)}},ds.ua=function(){void 0!==gs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Eo(this,"timeout"),this.abort(8))},ds.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Eo(this,"complete"),Eo(this,"abort"),Ec(this))},ds.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ec(this,!0)),mc.$.N.call(this)},ds.La=function(){this.s||(this.G||this.v||this.l?bc(this):this.kb())},ds.kb=function(){bc(this)},ds.isActive=function(){return!!this.g},ds.da=function(){try{return 2<Sc(this)?this.g.status:-1}catch(t){return-1}},ds.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},ds.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),gc(e)}},ds.Ia=function(){return this.m},ds.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(ds=Nc.prototype).ra=8,ds.H=1,ds.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const r=new da(this,this.l,t);let s=this.s;if(this.U&&(s?(s=io(s),so(s,this.U)):s=this.U),null!==this.o||this.O||(r.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var i=this.j[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Fc(this,r,e),Ma(n=Ra(this.I),"RID",t),Ma(n,"CVER",22),this.F&&Ma(n,"X-HTTP-Session-Id",this.F),xc(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(kc(s)))+"&"+e:this.o&&Ac(n,this.o,s)),nc(this.i,r),this.bb&&Ma(n,"TYPE","init"),this.P?(Ma(n,"$req",e),Ma(n,"SID","null"),r.aa=!0,ya(r,n,null)):ya(r,n,e),this.H=2}}else 3==this.H&&(t?Mc(this,t):0==this.j.length||Za(this.i)||Mc(this))},ds.Ma=function(){if(this.u=null,$c(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=ea(Es(this.jb,this),t)}},ds.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Zo(10),Oc(this),$c(this))},ds.ib=function(){null!=this.v&&(this.v=null,Oc(this),Vc(this),Zo(19))},ds.pb=function(t){t?(this.l.info("Successfully pinged google.com"),Zo(2)):(this.l.info("Failed to ping google.com"),Zo(1))},ds.isActive=function(){return!!this.h&&this.h.isActive(this)},(ds=Qc.prototype).Ba=function(){},ds.Aa=function(){},ds.za=function(){},ds.ya=function(){},ds.isActive=function(){return!0},ds.Va=function(){},Jc.prototype.g=function(t,e){return new Xc(t,e)},Ss(Xc,bo),Xc.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;Zo(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Gc(t,null,t.Y),Lc(t)},Xc.prototype.close=function(){Rc(this.g)},Xc.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=So(t),t=n);e.j.push(new class{constructor(t,e){this.g=t,this.map=e}}(e.fb++,t)),3==e.H&&Lc(e)},Xc.prototype.N=function(){this.g.h=null,delete this.j,Rc(this.g),delete this.g,Xc.$.N.call(this)},Ss(Yc,ua),Ss(Zc,ha),Ss(tu,Qc),tu.prototype.Ba=function(){Eo(this.g,"a")},tu.prototype.Aa=function(t){Eo(this.g,new Yc(t))},tu.prototype.za=function(t){Eo(this.g,new Zc)},tu.prototype.ya=function(){Eo(this.g,"b")},Ss(eu,(function(){this.blockSize=-1})),eu.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},eu.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,i=this.m,r=this.h,s=0;s<e;){if(0==r)for(;s<=n;)nu(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(i[r++]=t.charCodeAt(s++),r==this.blockSize){nu(this,i),r=0;break}}else for(;s<e;)if(i[r++]=t[s++],r==this.blockSize){nu(this,i),r=0;break}}this.h=r,this.i+=e},eu.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var i=0;32>i;i+=8)t[n++]=this.g[e]>>>i&255;return t};var ru={};function su(t){return-128<=t&&128>t?function(t,e){var n=ru;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new iu([0|t],0>t?-1:0)}(t)}(t):new iu([0|t],0>t?-1:0)}function ou(t){if(isNaN(t)||!isFinite(t))return cu;if(0>t)return fu(ou(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=au;return new iu(e,0)}var au=4294967296,cu=su(0),uu=su(1),hu=su(16777216);function lu(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function du(t){return-1==t.h}function fu(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new iu(n,~t.h).add(uu)}function pu(t,e){return t.add(fu(e))}function gu(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function mu(t,e){this.g=t,this.h=e}function yu(t,e){if(lu(e))throw Error("division by zero");if(lu(t))return new mu(cu,cu);if(du(t))return e=yu(fu(t),e),new mu(fu(e.g),fu(e.h));if(du(e))return e=yu(t,fu(e)),new mu(fu(e.g),e.h);if(30<t.g.length){if(du(t)||du(e))throw Error("slowDivide_ only works with positive integers.");for(var n=uu,i=e;0>=i.X(t);)n=vu(n),i=vu(i);var r=wu(n,1),s=wu(i,1);for(i=wu(i,2),n=wu(n,2);!lu(i);){var o=s.add(i);0>=o.X(t)&&(r=r.add(n),s=o),i=wu(i,1),n=wu(n,1)}return e=pu(t,r.R(e)),new mu(r,e)}for(r=cu;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(s=ou(n)).R(e);du(o)||0<o.X(t);)o=(s=ou(n-=i)).R(e);lu(s)&&(s=uu),r=r.add(s),t=pu(t,o)}return new mu(r,t)}function vu(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.D(i)<<1|t.D(i-1)>>>31;return new iu(n,t.h)}function wu(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,r=[],s=0;s<i;s++)r[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new iu(r,t.h)}(ds=iu.prototype).ea=function(){if(du(this))return-fu(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var i=this.D(n);t+=(0<=i?i:au+i)*e,e*=au}return t},ds.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(lu(this))return"0";if(du(this))return"-"+fu(this).toString(t);for(var e=ou(Math.pow(t,6)),n=this,i="";;){var r=yu(n,e).g,s=((0<(n=pu(n,r.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(lu(n=r))return s+i;for(;6>s.length;)s="0"+s;i=s+i}},ds.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},ds.X=function(t){return du(t=pu(this,t))?-1:lu(t)?0:1},ds.abs=function(){return du(this)?fu(this):this},ds.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,r=0;r<=e;r++){var s=i+(65535&this.D(r))+(65535&t.D(r)),o=(s>>>16)+(this.D(r)>>>16)+(t.D(r)>>>16);i=o>>>16,s&=65535,o&=65535,n[r]=o<<16|s}return new iu(n,-2147483648&n[n.length-1]?-1:0)},ds.R=function(t){if(lu(this)||lu(t))return cu;if(du(this))return du(t)?fu(this).R(fu(t)):fu(fu(this).R(t));if(du(t))return fu(this.R(fu(t)));if(0>this.X(hu)&&0>t.X(hu))return ou(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var r=0;r<t.g.length;r++){var s=this.D(i)>>>16,o=65535&this.D(i),a=t.D(r)>>>16,c=65535&t.D(r);n[2*i+2*r]+=o*c,gu(n,2*i+2*r),n[2*i+2*r+1]+=s*c,gu(n,2*i+2*r+1),n[2*i+2*r+1]+=o*a,gu(n,2*i+2*r+1),n[2*i+2*r+2]+=s*a,gu(n,2*i+2*r+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new iu(n,0)},ds.gb=function(t){return yu(this,t).h},ds.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)&t.D(i);return new iu(n,this.h&t.h)},ds.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)|t.D(i);return new iu(n,this.h|t.h)},ds.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.D(i)^t.D(i);return new iu(n,this.h^t.h)},Jc.prototype.createWebChannel=Jc.prototype.g,Xc.prototype.send=Xc.prototype.u,Xc.prototype.open=Xc.prototype.m,Xc.prototype.close=Xc.prototype.close,na.NO_ERROR=0,na.TIMEOUT=8,na.HTTP_ERROR=6,ia.COMPLETE="complete",oa.EventType=ca,ca.OPEN="a",ca.CLOSE="b",ca.ERROR="c",ca.MESSAGE="d",bo.prototype.listen=bo.prototype.O,mc.prototype.listenOnce=mc.prototype.P,mc.prototype.getLastError=mc.prototype.Sa,mc.prototype.getLastErrorCode=mc.prototype.Ia,mc.prototype.getStatus=mc.prototype.da,mc.prototype.getResponseJson=mc.prototype.Wa,mc.prototype.getResponseText=mc.prototype.ja,mc.prototype.send=mc.prototype.ha,mc.prototype.setWithCredentials=mc.prototype.Oa,eu.prototype.digest=eu.prototype.l,eu.prototype.reset=eu.prototype.reset,eu.prototype.update=eu.prototype.j,iu.prototype.add=iu.prototype.add,iu.prototype.multiply=iu.prototype.R,iu.prototype.modulo=iu.prototype.gb,iu.prototype.compare=iu.prototype.X,iu.prototype.toNumber=iu.prototype.ea,iu.prototype.toString=iu.prototype.toString,iu.prototype.getBits=iu.prototype.D,iu.fromNumber=ou,iu.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return fu(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=ou(Math.pow(n,8)),r=cu,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=ou(Math.pow(n,o)),r=r.R(o).add(ou(a))):r=(r=r.R(i)).add(ou(a))}return r};var Iu=ps.createWebChannelTransport=function(){return new Jc},_u=ps.getStatEventTarget=function(){return Qo()},bu=ps.ErrorCode=na,Eu=ps.EventType=ia,Tu=ps.Event=Go,Su=ps.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Cu=ps.FetchXmlHttpFactory=uc,ku=ps.WebChannel=oa,Au=ps.XhrIo=mc,Du=ps.Md5=eu,Nu=ps.Integer=iu;const Ru="@firebase/firestore";class Ou{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ou.UNAUTHENTICATED=new Ou(null),Ou.GOOGLE_CREDENTIALS=new Ou("google-credentials-uid"),Ou.FIRST_PARTY=new Ou("first-party-uid"),Ou.MOCK_USER=new Ou("mock-user");let Pu="10.1.0";const Lu=new B("@firebase/firestore");function Mu(){return Lu.logLevel}function xu(t,...e){if(Lu.logLevel<=x.DEBUG){const n=e.map(Vu);Lu.debug(`Firestore (${Pu}): ${t}`,...n)}}function Fu(t,...e){if(Lu.logLevel<=x.ERROR){const n=e.map(Vu);Lu.error(`Firestore (${Pu}): ${t}`,...n)}}function Uu(t,...e){if(Lu.logLevel<=x.WARN){const n=e.map(Vu);Lu.warn(`Firestore (${Pu}): ${t}`,...n)}}function Vu(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function ju(t="Unexpected state"){const e=`FIRESTORE (${Pu}) INTERNAL ASSERTION FAILED: `+t;throw Fu(e),new Error(e)}function $u(t,e){t||ju()}function Bu(t,e){return t}const qu={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class zu extends g{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ku{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Hu{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Gu{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ou.UNAUTHENTICATED)))}shutdown(){}}class Wu{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Qu{constructor(t){this.t=t,this.currentUser=Ou.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const i=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new Ku;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Ku,t.enqueueRetryable((()=>i(this.currentUser)))};const s=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await i(this.currentUser)}))},o=t=>{xu("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(xu("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Ku)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(xu("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?($u("string"==typeof e.accessToken),new Hu(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return $u(null===t||"string"==typeof t),new Ou(t)}}class Ju{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Ou.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Xu{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new Ju(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Ou.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Yu{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Zu{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&xu("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,xu("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const i=t=>{xu("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>i(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?i(t):xu("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?($u("string"==typeof t.token),this.R=t.token,new Yu(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function th(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class eh{static V(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=th(40);for(let i=0;i<n.length;++i)e.length<20&&n[i]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return e}}function nh(t,e){return t<e?-1:t>e?1:0}function ih(t,e,n){return t.length===e.length&&t.every(((t,i)=>n(t,e[i])))}class rh{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new zu(qu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new zu(qu.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new zu(qu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new zu(qu.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return rh.fromMillis(Date.now())}static fromDate(t){return rh.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new rh(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?nh(this.nanoseconds,t.nanoseconds):nh(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class sh{constructor(t){this.timestamp=t}static fromTimestamp(t){return new sh(t)}static min(){return new sh(new rh(0,0))}static max(){return new sh(new rh(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class oh{constructor(t,e,n){void 0===e?e=0:e>t.length&&ju(),void 0===n?n=t.length-e:n>t.length-e&&ju(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===oh.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof oh?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const n=t.get(i),r=e.get(i);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ah extends oh{construct(t,e,n){return new ah(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new zu(qu.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ah(e)}static emptyPath(){return new ah([])}}const ch=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class uh extends oh{construct(t,e,n){return new uh(t,e,n)}static isValidIdentifier(t){return ch.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),uh.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new uh(["__name__"])}static fromServerFormat(t){const e=[];let n="",i=0;const r=()=>{if(0===n.length)throw new zu(qu.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;i<t.length;){const e=t[i];if("\\"===e){if(i+1===t.length)throw new zu(qu.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[i+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new zu(qu.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,i+=2}else"`"===e?(s=!s,i++):"."!==e||s?(n+=e,i++):(r(),i++)}if(r(),s)throw new zu(qu.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new uh(e)}static emptyPath(){return new uh([])}}class hh{constructor(t){this.path=t}static fromPath(t){return new hh(ah.fromString(t))}static fromName(t){return new hh(ah.fromString(t).popFirst(5))}static empty(){return new hh(ah.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ah.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ah.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new hh(new ah(t.slice()))}}function lh(t){return new dh(t.readTime,t.key,-1)}class dh{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new dh(sh.min(),hh.empty(),-1)}static max(){return new dh(sh.max(),hh.empty(),-1)}}function fh(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=hh.comparator(t.documentKey,e.documentKey),0!==n?n:nh(t.largestBatchId,e.largestBatchId))}const ph="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class gh{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function mh(t){if(t.code!==qu.FAILED_PRECONDITION||t.message!==ph)throw t;xu("LocalStore","Unexpectedly lost primary lease")}class yh{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&ju(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new yh(((n,i)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,i)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,i)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof yh?e:yh.resolve(e)}catch(t){return yh.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):yh.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):yh.reject(e)}static resolve(t){return new yh(((e,n)=>{e(t)}))}static reject(t){return new yh(((e,n)=>{n(t)}))}static waitFor(t){return new yh(((e,n)=>{let i=0,r=0,s=!1;t.forEach((t=>{++i,t.next((()=>{++r,s&&r===i&&e()}),(t=>n(t)))})),s=!0,r===i&&e()}))}static or(t){let e=yh.resolve(!1);for(const n of t)e=e.next((t=>t?yh.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,i)=>{n.push(e.call(this,t,i))})),this.waitFor(n)}static mapArray(t,e){return new yh(((n,i)=>{const r=t.length,s=new Array(r);let o=0;for(let a=0;a<r;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===r&&n(s)}),(t=>i(t)))}}))}static doWhile(t,e){return new yh(((n,i)=>{const r=()=>{!0===t()?e().next((()=>{r()}),i):n()};r()}))}}function vh(t){return"IndexedDbTransactionError"===t.name}class wh{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.oe(t),this._e=t=>e.writeSequenceNumber(t))}oe(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this._e&&this._e(t),t}}function Ih(t){return null==t}function _h(t){return 0===t&&1/t==-1/0}wh.ae=-1;function bh(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Eh(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Th(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Sh{constructor(t,e){this.comparator=t,this.root=e||kh.EMPTY}insert(t,e){return new Sh(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,kh.BLACK,null,null))}remove(t){return new Sh(this.comparator,this.root.remove(t,this.comparator).copy(null,null,kh.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(t,n.key);if(0===i)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ch(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ch(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ch(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ch(this.root,t,this.comparator,!0)}}class Ch{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,e&&i&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class kh{constructor(t,e,n,i,r){this.key=t,this.value=e,this.color=null!=n?n:kh.RED,this.left=null!=i?i:kh.EMPTY,this.right=null!=r?r:kh.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,r){return new kh(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this;const r=n(t,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(t,e,n),null):0===r?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return kh.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===e(t,i.key)){if(i.right.isEmpty())return kh.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,kh.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,kh.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ju();if(this.right.isRed())throw ju();const t=this.left.check();if(t!==this.right.check())throw ju();return t+(this.isRed()?0:1)}}kh.EMPTY=null,kh.RED=!0,kh.BLACK=!1,kh.EMPTY=new class{constructor(){this.size=0}get key(){throw ju()}get value(){throw ju()}get color(){throw ju()}get left(){throw ju()}get right(){throw ju()}copy(t,e,n,i,r){return this}insert(t,e,n){return new kh(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Ah{constructor(t){this.comparator=t,this.data=new Sh(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Dh(this.data.getIterator())}getIteratorFrom(t){return new Dh(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Ah))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(0!==this.comparator(t,i))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Ah(this.comparator);return e.data=t,e}}class Dh{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Nh{constructor(t){this.fields=t,t.sort(uh.comparator)}static empty(){return new Nh([])}unionWith(t){let e=new Ah(uh.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Nh(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return ih(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class Rh extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Oh{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new Rh("Invalid base64 string: "+t):t}}(t);return new Oh(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Oh(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return nh(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Oh.EMPTY_BYTE_STRING=new Oh("");const Ph=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Lh(t){if($u(!!t),"string"==typeof t){let e=0;const n=Ph.exec(t);if($u(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Mh(t.seconds),nanos:Mh(t.nanos)}}function Mh(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function xh(t){return"string"==typeof t?Oh.fromBase64String(t):Oh.fromUint8Array(t)}function Fh(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Uh(t){const e=t.mapValue.fields.__previous_value__;return Fh(e)?Uh(e):e}function Vh(t){const e=Lh(t.mapValue.fields.__local_write_time__.timestampValue);return new rh(e.seconds,e.nanos)}class jh{constructor(t,e,n,i,r,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=r,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class $h{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new $h("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof $h&&t.projectId===this.projectId&&t.database===this.database}}const Bh={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function qh(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Fh(t)?4:il(t)?9007199254740991:10:ju()}function zh(t,e){if(t===e)return!0;const n=qh(t);if(n!==qh(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vh(t).isEqual(Vh(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Lh(t.timestampValue),i=Lh(e.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return xh(t.bytesValue).isEqual(xh(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Mh(t.geoPointValue.latitude)===Mh(e.geoPointValue.latitude)&&Mh(t.geoPointValue.longitude)===Mh(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Mh(t.integerValue)===Mh(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Mh(t.doubleValue),i=Mh(e.doubleValue);return n===i?_h(n)===_h(i):isNaN(n)&&isNaN(i)}return!1}(t,e);case 9:return ih(t.arrayValue.values||[],e.arrayValue.values||[],zh);case 10:return function(t,e){const n=t.mapValue.fields||{},i=e.mapValue.fields||{};if(bh(n)!==bh(i))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===i[t]||!zh(n[t],i[t])))return!1;return!0}(t,e);default:return ju()}}function Kh(t,e){return void 0!==(t.values||[]).find((t=>zh(t,e)))}function Hh(t,e){if(t===e)return 0;const n=qh(t),i=qh(e);if(n!==i)return nh(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return nh(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Mh(t.integerValue||t.doubleValue),i=Mh(e.integerValue||e.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(t,e);case 3:return Gh(t.timestampValue,e.timestampValue);case 4:return Gh(Vh(t),Vh(e));case 5:return nh(t.stringValue,e.stringValue);case 6:return function(t,e){const n=xh(t),i=xh(e);return n.compareTo(i)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),i=e.split("/");for(let t=0;t<n.length&&t<i.length;t++){const e=nh(n[t],i[t]);if(0!==e)return e}return nh(n.length,i.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=nh(Mh(t.latitude),Mh(e.latitude));return 0!==n?n:nh(Mh(t.longitude),Mh(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],i=e.values||[];for(let t=0;t<n.length&&t<i.length;++t){const e=Hh(n[t],i[t]);if(e)return e}return nh(n.length,i.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===Bh.mapValue&&e===Bh.mapValue)return 0;if(t===Bh.mapValue)return 1;if(e===Bh.mapValue)return-1;const n=t.fields||{},i=Object.keys(n),r=e.fields||{},s=Object.keys(r);i.sort(),s.sort();for(let t=0;t<i.length&&t<s.length;++t){const e=nh(i[t],s[t]);if(0!==e)return e;const o=Hh(n[i[t]],r[s[t]]);if(0!==o)return o}return nh(i.length,s.length)}(t.mapValue,e.mapValue);default:throw ju()}}function Gh(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return nh(t,e);const n=Lh(t),i=Lh(e),r=nh(n.seconds,i.seconds);return 0!==r?r:nh(n.nanos,i.nanos)}function Wh(t){return Qh(t)}function Qh(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Lh(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return xh(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return hh.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const i of t.values||[])n?n=!1:e+=",",e+=Qh(i);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",i=!0;for(const r of e)i?i=!1:n+=",",n+=`${r}:${Qh(t.fields[r])}`;return n+"}"}(t.mapValue):ju()}function Jh(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Xh(t){return!!t&&"integerValue"in t}function Yh(t){return!!t&&"arrayValue"in t}function Zh(t){return!!t&&"nullValue"in t}function tl(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function el(t){return!!t&&"mapValue"in t}function nl(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Eh(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=nl(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=nl(t.arrayValue.values[n]);return e}return Object.assign({},t)}function il(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class rl{constructor(t){this.value=t}static empty(){return new rl({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!el(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=nl(e)}setAll(t){let e=uh.emptyPath(),n={},i=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,i),n={},i=[],e=r.popLast()}t?n[r.lastSegment()]=nl(t):i.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,i)}delete(t){const e=this.field(t.popLast());el(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return zh(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];el(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){Eh(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new rl(nl(this.value))}}class sl{constructor(t,e,n,i,r,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=r,this.data=s,this.documentState=o}static newInvalidDocument(t){return new sl(t,0,sh.min(),sh.min(),sh.min(),rl.empty(),0)}static newFoundDocument(t,e,n,i){return new sl(t,1,e,sh.min(),n,i,0)}static newNoDocument(t,e){return new sl(t,2,e,sh.min(),sh.min(),rl.empty(),0)}static newUnknownDocument(t,e){return new sl(t,3,e,sh.min(),sh.min(),rl.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(sh.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=rl.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=rl.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=sh.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof sl&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new sl(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class ol{constructor(t,e){this.position=t,this.inclusive=e}}function al(t,e,n){let i=0;for(let r=0;r<t.position.length;r++){const s=e[r],o=t.position[r];if(i=s.field.isKeyField()?hh.comparator(hh.fromName(o.referenceValue),n.key):Hh(o,n.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function cl(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!zh(t.position[n],e.position[n]))return!1;return!0}class ul{constructor(t,e="asc"){this.field=t,this.dir=e}}function hl(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class ll{}class dl extends ll{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new wl(t,e,n):"array-contains"===e?new El(t,n):"in"===e?new Tl(t,n):"not-in"===e?new Sl(t,n):"array-contains-any"===e?new Cl(t,n):new dl(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Il(t,n):new _l(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(Hh(e,this.value)):null!==e&&qh(this.value)===qh(e)&&this.matchesComparison(Hh(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return ju()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class fl extends ll{constructor(t,e){super(),this.filters=t,this.op=e,this.ce=null}static create(t,e){return new fl(t,e)}matches(t){return pl(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ce||(this.ce=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ce}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const t=this.le((t=>t.isInequality()));return null!==t?t.field:null}le(t){for(const e of this.getFlattenedFilters())if(t(e))return e;return null}}function pl(t){return"and"===t.op}function gl(t){return function(t){for(const e of t.filters)if(e instanceof fl)return!1;return!0}(t)&&pl(t)}function ml(t){if(t instanceof dl)return t.field.canonicalString()+t.op.toString()+Wh(t.value);if(gl(t))return t.filters.map((t=>ml(t))).join(",");{const e=t.filters.map((t=>ml(t))).join(",");return`${t.op}(${e})`}}function yl(t,e){return t instanceof dl?function(t,e){return e instanceof dl&&t.op===e.op&&t.field.isEqual(e.field)&&zh(t.value,e.value)}(t,e):t instanceof fl?function(t,e){return e instanceof fl&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,i)=>t&&yl(n,e.filters[i])),!0)}(t,e):void ju()}function vl(t){return t instanceof dl?function(t){return`${t.field.canonicalString()} ${t.op} ${Wh(t.value)}`}(t):t instanceof fl?function(t){return t.op.toString()+" {"+t.getFilters().map(vl).join(" ,")+"}"}(t):"Filter"}class wl extends dl{constructor(t,e,n){super(t,e,n),this.key=hh.fromName(n.referenceValue)}matches(t){const e=hh.comparator(t.key,this.key);return this.matchesComparison(e)}}class Il extends dl{constructor(t,e){super(t,"in",e),this.keys=bl(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class _l extends dl{constructor(t,e){super(t,"not-in",e),this.keys=bl(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function bl(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>hh.fromName(t.referenceValue)))}class El extends dl{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Yh(e)&&Kh(e.arrayValue,this.value)}}class Tl extends dl{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Kh(this.value.arrayValue,e)}}class Sl extends dl{constructor(t,e){super(t,"not-in",e)}matches(t){if(Kh(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Kh(this.value.arrayValue,e)}}class Cl extends dl{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Yh(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Kh(this.value.arrayValue,t)))}}class kl{constructor(t,e=null,n=[],i=[],r=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=r,this.startAt=s,this.endAt=o,this.he=null}}function Al(t,e=null,n=[],i=[],r=null,s=null,o=null){return new kl(t,e,n,i,r,s,o)}function Dl(t){const e=Bu(t);if(null===e.he){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ml(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Ih(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Wh(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Wh(t))).join(",")),e.he=t}return e.he}function Nl(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!hl(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!yl(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!cl(t.startAt,e.startAt)&&cl(t.endAt,e.endAt)}function Rl(t){return hh.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ol{constructor(t,e=null,n=[],i=[],r=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=r,this.limitType=s,this.startAt=o,this.endAt=a,this.Pe=null,this.Ie=null,this.startAt,this.endAt}}function Pl(t){return new Ol(t)}function Ll(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ml(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function xl(t){for(const e of t.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Fl(t){return null!==t.collectionGroup}function Ul(t){const e=Bu(t);if(null===e.Pe){e.Pe=[];const t=xl(e),n=Ml(e);if(null!==t&&null===n)t.isKeyField()||e.Pe.push(new ul(t)),e.Pe.push(new ul(uh.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.Pe.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.Pe.push(new ul(uh.keyField(),t))}}}return e.Pe}function Vl(t){const e=Bu(t);if(!e.Ie)if("F"===e.limitType)e.Ie=Al(e.path,e.collectionGroup,Ul(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Ul(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ul(n.field,e))}const n=e.endAt?new ol(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new ol(e.startAt.position,e.startAt.inclusive):null;e.Ie=Al(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}return e.Ie}function jl(t,e){e.getFirstInequalityField(),xl(t);const n=t.filters.concat([e]);return new Ol(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function $l(t,e,n){return new Ol(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Bl(t,e){return Nl(Vl(t),Vl(e))&&t.limitType===e.limitType}function ql(t){return`${Dl(Vl(t))}|lt:${t.limitType}`}function zl(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>vl(t))).join(", ")}]`),Ih(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Wh(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Wh(t))).join(",")),`Target(${e})`}(Vl(t))}; limitType=${t.limitType})`}function Kl(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):hh.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Ul(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const i=al(t,e,n);return t.inclusive?i<=0:i<0}(t.startAt,Ul(t),e)||t.endAt&&!function(t,e,n){const i=al(t,e,n);return t.inclusive?i>=0:i>0}(t.endAt,Ul(t),e))}(t,e)}function Hl(t){return(e,n)=>{let i=!1;for(const r of Ul(t)){const t=Gl(r,e,n);if(0!==t)return t;i=i||r.field.isKeyField()}return 0}}function Gl(t,e,n){const i=t.field.isKeyField()?hh.comparator(e.key,n.key):function(t,e,n){const i=e.data.field(t),r=n.data.field(t);return null!==i&&null!==r?Hh(i,r):ju()}(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return ju()}}class Wl{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,i]of n)if(this.equalsFn(e,t))return i}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),i=this.inner[n];if(void 0===i)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],t))return void(i[n]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return 1===n.length?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){Eh(this.inner,((e,n)=>{for(const[e,i]of n)t(e,i)}))}isEmpty(){return Th(this.inner)}size(){return this.innerSize}}const Ql=new Sh(hh.comparator);function Jl(){return Ql}const Xl=new Sh(hh.comparator);function Yl(...t){let e=Xl;for(const n of t)e=e.insert(n.key,n);return e}function Zl(t){let e=Xl;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function td(){return nd()}function ed(){return nd()}function nd(){return new Wl((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Sh(hh.comparator);const id=new Ah(hh.comparator);function rd(...t){let e=id;for(const n of t)e=e.add(n);return e}const sd=new Ah(nh);function od(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:_h(e)?"-0":e}}function ad(t){return{integerValue:""+t}}function cd(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!_h(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?ad(e):od(t,e)}class ud{constructor(){this._=void 0}}function hd(t,e,n){return t instanceof dd?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Fh(e)&&(e=Uh(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof fd?pd(t,e):t instanceof gd?md(t,e):function(t,e){const n=function(t,e){return t instanceof yd?function(t){return Xh(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),i=vd(n)+vd(t.Te);return Xh(n)&&Xh(t.Te)?ad(i):od(t.serializer,i)}(t,e)}function ld(t,e,n){return t instanceof fd?pd(t,e):t instanceof gd?md(t,e):n}class dd extends ud{}class fd extends ud{constructor(t){super(),this.elements=t}}function pd(t,e){const n=wd(e);for(const e of t.elements)n.some((t=>zh(t,e)))||n.push(e);return{arrayValue:{values:n}}}class gd extends ud{constructor(t){super(),this.elements=t}}function md(t,e){let n=wd(e);for(const e of t.elements)n=n.filter((t=>!zh(t,e)));return{arrayValue:{values:n}}}class yd extends ud{constructor(t,e){super(),this.serializer=t,this.Te=e}}function vd(t){return Mh(t.integerValue||t.doubleValue)}function wd(t){return Yh(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Id{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Id}static exists(t){return new Id(void 0,t)}static updateTime(t){return new Id(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function _d(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class bd{}function Ed(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Od(t.key,Id.none()):new kd(t.key,t.data,Id.none());{const n=t.data,i=rl.empty();let r=new Ah(uh.comparator);for(let t of e.fields)if(!r.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?i.delete(t):i.set(t,e),r=r.add(t)}return new Ad(t.key,i,new Nh(r.toArray()),Id.none())}}function Td(t,e,n){t instanceof kd?function(t,e,n){const i=t.value.clone(),r=Nd(t.fieldTransforms,e,n.transformResults);i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):t instanceof Ad?function(t,e,n){if(!_d(t.precondition,e))return void e.convertToUnknownDocument(n.version);const i=Nd(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(Dd(t)),r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Sd(t,e,n,i){return t instanceof kd?function(t,e,n,i){if(!_d(t.precondition,e))return n;const r=t.value.clone(),s=Rd(t.fieldTransforms,i,e);return r.setAll(s),e.convertToFoundDocument(e.version,r).setHasLocalMutations(),null}(t,e,n,i):t instanceof Ad?function(t,e,n,i){if(!_d(t.precondition,e))return n;const r=Rd(t.fieldTransforms,i,e),s=e.data;return s.setAll(Dd(t)),s.setAll(r),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,i):function(t,e,n){return _d(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Cd(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&ih(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof fd&&e instanceof fd||t instanceof gd&&e instanceof gd?ih(t.elements,e.elements,zh):t instanceof yd&&e instanceof yd?zh(t.Te,e.Te):t instanceof dd&&e instanceof dd}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class kd extends bd{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ad extends bd{constructor(t,e,n,i,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function Dd(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function Nd(t,e,n){const i=new Map;$u(t.length===n.length);for(let r=0;r<n.length;r++){const s=t[r],o=s.transform,a=e.data.field(s.field);i.set(s.field,ld(o,a,n[r]))}return i}function Rd(t,e,n){const i=new Map;for(const r of t){const t=r.transform,s=n.data.field(r.field);i.set(r.field,hd(t,s,e))}return i}class Od extends bd{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Pd{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const i=this.mutations[e];i.key.isEqual(t.key)&&Td(i,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Sd(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Sd(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ed();return this.mutations.forEach((i=>{const r=t.get(i.key),s=r.overlayedDocument;let o=this.applyToLocalView(s,r.mutatedFields);o=e.has(i.key)?null:o;const a=Ed(s,o);null!==a&&n.set(i.key,a),s.isValidDocument()||s.convertToNoDocument(sh.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),rd())}isEqual(t){return this.batchId===t.batchId&&ih(this.mutations,t.mutations,((t,e)=>Cd(t,e)))&&ih(this.baseMutations,t.baseMutations,((t,e)=>Cd(t,e)))}}class Ld{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Md{constructor(t,e){this.count=t,this.unchangedNames=e}}var xd,Fd;function Ud(t){if(void 0===t)return Fu("GRPC error has no .code"),qu.UNKNOWN;switch(t){case xd.OK:return qu.OK;case xd.CANCELLED:return qu.CANCELLED;case xd.UNKNOWN:return qu.UNKNOWN;case xd.DEADLINE_EXCEEDED:return qu.DEADLINE_EXCEEDED;case xd.RESOURCE_EXHAUSTED:return qu.RESOURCE_EXHAUSTED;case xd.INTERNAL:return qu.INTERNAL;case xd.UNAVAILABLE:return qu.UNAVAILABLE;case xd.UNAUTHENTICATED:return qu.UNAUTHENTICATED;case xd.INVALID_ARGUMENT:return qu.INVALID_ARGUMENT;case xd.NOT_FOUND:return qu.NOT_FOUND;case xd.ALREADY_EXISTS:return qu.ALREADY_EXISTS;case xd.PERMISSION_DENIED:return qu.PERMISSION_DENIED;case xd.FAILED_PRECONDITION:return qu.FAILED_PRECONDITION;case xd.ABORTED:return qu.ABORTED;case xd.OUT_OF_RANGE:return qu.OUT_OF_RANGE;case xd.UNIMPLEMENTED:return qu.UNIMPLEMENTED;case xd.DATA_LOSS:return qu.DATA_LOSS;default:return ju()}}(Fd=xd||(xd={}))[Fd.OK=0]="OK",Fd[Fd.CANCELLED=1]="CANCELLED",Fd[Fd.UNKNOWN=2]="UNKNOWN",Fd[Fd.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fd[Fd.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fd[Fd.NOT_FOUND=5]="NOT_FOUND",Fd[Fd.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fd[Fd.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fd[Fd.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fd[Fd.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fd[Fd.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fd[Fd.ABORTED=10]="ABORTED",Fd[Fd.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fd[Fd.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fd[Fd.INTERNAL=13]="INTERNAL",Fd[Fd.UNAVAILABLE=14]="UNAVAILABLE",Fd[Fd.DATA_LOSS=15]="DATA_LOSS";class Vd{constructor(){this.onExistenceFilterMismatchCallbacks=new Map}static get instance(){return jd}static getOrCreateInstance(){return null===jd&&(jd=new Vd),jd}onExistenceFilterMismatch(t){const e=Symbol();return this.onExistenceFilterMismatchCallbacks.set(e,t),()=>this.onExistenceFilterMismatchCallbacks.delete(e)}notifyOnExistenceFilterMismatch(t){this.onExistenceFilterMismatchCallbacks.forEach((e=>e(t)))}}let jd=null;const $d=new Nu([4294967295,4294967295],0);function Bd(t){const e=(new TextEncoder).encode(t),n=new Du;return n.update(e),new Uint8Array(n.digest())}function qd(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),r=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Nu([n,i],0),new Nu([r,s],0)]}class zd{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Kd(`Invalid padding: ${e}`);if(n<0)throw new Kd(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Kd(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Kd(`Invalid padding when bitmap length is 0: ${e}`);this.de=8*t.length-e,this.Ae=Nu.fromNumber(this.de)}Re(t,e,n){let i=t.add(e.multiply(Nu.fromNumber(n)));return 1===i.compare($d)&&(i=new Nu([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ae).toNumber()}Ve(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.de)return!1;const e=Bd(t),[n,i]=qd(e);for(let t=0;t<this.hashCount;t++){const e=this.Re(n,i,t);if(!this.Ve(e))return!1}return!0}static create(t,e,n){const i=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),s=new zd(r,i,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.de)return;const e=Bd(t),[n,i]=qd(e);for(let t=0;t<this.hashCount;t++){const e=this.Re(n,i,t);this.me(e)}}me(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Kd extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Hd{constructor(t,e,n,i,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const i=new Map;return i.set(t,Gd.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Hd(sh.min(),i,new Sh(nh),Jl(),rd())}}class Gd{constructor(t,e,n,i,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Gd(n,e,rd(),rd(),rd())}}class Wd{constructor(t,e,n,i){this.fe=t,this.removedTargetIds=e,this.key=n,this.ge=i}}class Qd{constructor(t,e){this.targetId=t,this.pe=e}}class Jd{constructor(t,e,n=Oh.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}}class Xd{constructor(){this.ye=0,this.we=tf(),this.Se=Oh.EMPTY_BYTE_STRING,this.be=!1,this.De=!0}get current(){return this.be}get resumeToken(){return this.Se}get ve(){return 0!==this.ye}get Ce(){return this.De}Fe(t){t.approximateByteSize()>0&&(this.De=!0,this.Se=t)}Me(){let t=rd(),e=rd(),n=rd();return this.we.forEach(((i,r)=>{switch(r){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:ju()}})),new Gd(this.Se,this.be,t,e,n)}xe(){this.De=!1,this.we=tf()}Oe(t,e){this.De=!0,this.we=this.we.insert(t,e)}Ne(t){this.De=!0,this.we=this.we.remove(t)}Be(){this.ye+=1}Le(){this.ye-=1}ke(){this.De=!0,this.be=!0}}class Yd{constructor(t){this.qe=t,this.Qe=new Map,this.Ke=Jl(),this.$e=Zd(),this.Ue=new Sh(nh)}We(t){for(const e of t.fe)t.ge&&t.ge.isFoundDocument()?this.Ge(e,t.ge):this.ze(e,t.key,t.ge);for(const e of t.removedTargetIds)this.ze(e,t.key,t.ge)}je(t){this.forEachTarget(t,(e=>{const n=this.He(e);switch(t.state){case 0:this.Je(e)&&n.Fe(t.resumeToken);break;case 1:n.Le(),n.ve||n.xe(),n.Fe(t.resumeToken);break;case 2:n.Le(),n.ve||this.removeTarget(e);break;case 3:this.Je(e)&&(n.ke(),n.Fe(t.resumeToken));break;case 4:this.Je(e)&&(this.Ye(e),n.Fe(t.resumeToken));break;default:ju()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Qe.forEach(((t,n)=>{this.Je(n)&&e(n)}))}Ze(t){var e,n;const i=t.targetId,r=t.pe.count,s=this.Xe(i);if(s){const o=s.target;if(Rl(o))if(0===r){const t=new hh(o.path);this.ze(i,t,sl.newNoDocument(t,sh.min()))}else $u(1===r);else{const s=this.et(i);if(s!==r){const r=this.tt(t,s);if(0!==r.status){this.Ye(i);const t=2===r.status?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ue=this.Ue.insert(i,t)}null===(e=Vd.instance)||void 0===e||e.notifyOnExistenceFilterMismatch(function(t,e,n,i){var r,s,o,a,c,u;const h={localCacheCount:n,existenceFilterCount:i.count},l=i.unchangedNames;return l&&(h.bloomFilter={applied:0===t,hashCount:null!==(r=null==l?void 0:l.hashCount)&&void 0!==r?r:0,bitmapLength:null!==(a=null===(o=null===(s=null==l?void 0:l.bits)||void 0===s?void 0:s.bitmap)||void 0===o?void 0:o.length)&&void 0!==a?a:0,padding:null!==(u=null===(c=null==l?void 0:l.bits)||void 0===c?void 0:c.padding)&&void 0!==u?u:0},e&&(h.bloomFilter.mightContain=e)),h}(r.status,null!==(n=r.nt)&&void 0!==n?n:null,s,t.pe))}}}}tt(t,e){const{unchangedNames:n,count:i}=t.pe;if(!n||!n.bits)return{status:1};const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=n;let a,c;try{a=xh(r).toUint8Array()}catch(t){if(t instanceof Rh)return Uu("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),{status:1};throw t}try{c=new zd(a,s,o)}catch(t){return Uu(t instanceof Kd?"BloomFilter error: ":"Applying bloom filter failed: ",t),{status:1}}const u=t=>{const e=this.qe.rt();return c.mightContain(`projects/${e.projectId}/databases/${e.database}/documents/${t}`)};return 0===c.de?{status:1}:{status:i===e-this.it(t.targetId,u)?0:2,nt:u}}it(t,e){const n=this.qe.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{e(n.path.canonicalString())||(this.ze(t,n,null),i++)})),i}st(t){const e=new Map;this.Qe.forEach(((n,i)=>{const r=this.Xe(i);if(r){if(n.current&&Rl(r.target)){const e=new hh(r.target.path);null!==this.Ke.get(e)||this.ot(i,e)||this.ze(i,e,sl.newNoDocument(e,t))}n.Ce&&(e.set(i,n.Me()),n.xe())}}));let n=rd();this.$e.forEach(((t,e)=>{let i=!0;e.forEachWhile((t=>{const e=this.Xe(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(i=!1,!1)})),i&&(n=n.add(t))})),this.Ke.forEach(((e,n)=>n.setReadTime(t)));const i=new Hd(t,e,this.Ue,this.Ke,n);return this.Ke=Jl(),this.$e=Zd(),this.Ue=new Sh(nh),i}Ge(t,e){if(!this.Je(t))return;const n=this.ot(t,e.key)?2:0;this.He(t).Oe(e.key,n),this.Ke=this.Ke.insert(e.key,e),this.$e=this.$e.insert(e.key,this._t(e.key).add(t))}ze(t,e,n){if(!this.Je(t))return;const i=this.He(t);this.ot(t,e)?i.Oe(e,1):i.Ne(e),this.$e=this.$e.insert(e,this._t(e).delete(t)),n&&(this.Ke=this.Ke.insert(e,n))}removeTarget(t){this.Qe.delete(t)}et(t){const e=this.He(t).Me();return this.qe.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Be(t){this.He(t).Be()}He(t){let e=this.Qe.get(t);return e||(e=new Xd,this.Qe.set(t,e)),e}_t(t){let e=this.$e.get(t);return e||(e=new Ah(nh),this.$e=this.$e.insert(t,e)),e}Je(t){const e=null!==this.Xe(t);return e||xu("WatchChangeAggregator","Detected inactive target",t),e}Xe(t){const e=this.Qe.get(t);return e&&e.ve?null:this.qe.ut(t)}Ye(t){this.Qe.set(t,new Xd),this.qe.getRemoteKeysForTarget(t).forEach((e=>{this.ze(t,e,null)}))}ot(t,e){return this.qe.getRemoteKeysForTarget(t).has(e)}}function Zd(){return new Sh(hh.comparator)}function tf(){return new Sh(hh.comparator)}const ef={asc:"ASCENDING",desc:"DESCENDING"},nf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},rf={and:"AND",or:"OR"};class sf{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function of(t,e){return t.useProto3Json||Ih(e)?e:{value:e}}function af(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function cf(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function uf(t){return $u(!!t),sh.fromTimestamp(function(t){const e=Lh(t);return new rh(e.seconds,e.nanos)}(t))}function hf(t,e){return function(t){return new ah(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function lf(t){const e=ah.fromString(t);return $u(Cf(e)),e}function df(t,e){const n=lf(e);if(n.get(1)!==t.databaseId.projectId)throw new zu(qu.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new zu(qu.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new hh(gf(n))}function ff(t,e){return hf(t.databaseId,e)}function pf(t){return new ah(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function gf(t){return $u(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function mf(t,e){return{documents:[ff(t,e.path)]}}function yf(t,e){const n={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(n.parent=ff(t,i),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ff(t,i.popLast()),n.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(t){if(0!==t.length)return Sf(fl.create(t,"and"))}(e.filters);r&&(n.structuredQuery.where=r);const s=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Ef(t.field),direction:If(t.dir)}}(t)))}(e.orderBy);s&&(n.structuredQuery.orderBy=s);const o=of(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function vf(t){let e=function(t){const e=lf(t);return 4===e.length?ah.emptyPath():gf(e)}(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let r=null;if(i>0){$u(1===i);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=wf(t);return e instanceof fl&&gl(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new ul(Tf(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ih(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new ol(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new ol(n,e)}(n.endAt)),function(t,e,n,i,r,s,o,a){return new Ol(t,e,n,i,r,s,o,a)}(e,r,o,s,a,"F",c,u)}function wf(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Tf(t.unaryFilter.field);return dl.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Tf(t.unaryFilter.field);return dl.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Tf(t.unaryFilter.field);return dl.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Tf(t.unaryFilter.field);return dl.create(r,"!=",{nullValue:"NULL_VALUE"});default:return ju()}}(t):void 0!==t.fieldFilter?function(t){return dl.create(Tf(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return ju()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return fl.create(t.compositeFilter.filters.map((t=>wf(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return ju()}}(t.compositeFilter.op))}(t):ju()}function If(t){return ef[t]}function _f(t){return nf[t]}function bf(t){return rf[t]}function Ef(t){return{fieldPath:t.canonicalString()}}function Tf(t){return uh.fromServerFormat(t.fieldPath)}function Sf(t){return t instanceof dl?function(t){if("=="===t.op){if(tl(t.value))return{unaryFilter:{field:Ef(t.field),op:"IS_NAN"}};if(Zh(t.value))return{unaryFilter:{field:Ef(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(tl(t.value))return{unaryFilter:{field:Ef(t.field),op:"IS_NOT_NAN"}};if(Zh(t.value))return{unaryFilter:{field:Ef(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ef(t.field),op:_f(t.op),value:t.value}}}(t):t instanceof fl?function(t){const e=t.getFilters().map((t=>Sf(t)));return 1===e.length?e[0]:{compositeFilter:{op:bf(t.op),filters:e}}}(t):ju()}function Cf(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class kf{constructor(t,e,n,i,r=sh.min(),s=sh.min(),o=Oh.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new kf(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new kf(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new kf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new kf(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Af{constructor(t){this.ct=t}}function Df(t){const e=vf({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?$l(e,e.limit,"L"):e}class Nf{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Mh(t.integerValue));else if("doubleValue"in t){const n=Mh(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),_h(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(xh(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?il(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):ju()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),hh.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}Nf.bt=new Nf;class Rf{constructor(){this.sn=new Of}addToCollectionParentIndex(t,e){return this.sn.add(e),yh.resolve()}getCollectionParents(t,e){return yh.resolve(this.sn.getEntries(e))}addFieldIndex(t,e){return yh.resolve()}deleteFieldIndex(t,e){return yh.resolve()}getDocumentsMatchingTarget(t,e){return yh.resolve(null)}getIndexType(t,e){return yh.resolve(0)}getFieldIndexes(t,e){return yh.resolve([])}getNextCollectionGroupToUpdate(t){return yh.resolve(null)}getMinOffset(t,e){return yh.resolve(dh.min())}getMinOffsetFromCollectionGroup(t,e){return yh.resolve(dh.min())}updateCollectionGroup(t,e,n){return yh.resolve()}updateIndexEntries(t,e){return yh.resolve()}}class Of{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new Ah(ah.comparator),r=!i.has(n);return this.index[e]=i.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new Ah(ah.comparator)).toArray()}}new Uint8Array(0);class Pf{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Pf(t,Pf.DEFAULT_COLLECTION_PERCENTILE,Pf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Pf.DEFAULT_COLLECTION_PERCENTILE=10,Pf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Pf.DEFAULT=new Pf(41943040,Pf.DEFAULT_COLLECTION_PERCENTILE,Pf.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Pf.DISABLED=new Pf(-1,0,0);class Lf{constructor(t){this.Mn=t}next(){return this.Mn+=2,this.Mn}static xn(){return new Lf(0)}static On(){return new Lf(-1)}}class Mf{constructor(){this.changes=new Wl((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,sl.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?yh.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class xf{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Ff{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((i=>(n=i,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Sd(n.mutation,t,Nh.empty(),rh.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,rd()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=rd()){const i=td();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,n).next((t=>{let e=Yl();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=td();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,rd())))}populateOverlays(t,e,n){const i=[];return n.forEach((t=>{e.has(t)||i.push(t)})),this.documentOverlayCache.getOverlays(t,i).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,i){let r=Jl();const s=nd(),o=nd();return e.forEach(((t,e)=>{const o=n.get(e.key);i.has(e.key)&&(void 0===o||o.mutation instanceof Ad)?r=r.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Sd(o.mutation,e,o.mutation.getFieldMask(),rh.now())):s.set(e.key,Nh.empty())})),this.recalculateAndSaveOverlays(t,r).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new xf(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=nd();let i=new Sh(((t,e)=>t-e)),r=rd();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const r of t)r.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Nh.empty();o=r.applyToLocalView(s,o),n.set(t,o);const a=(i.get(r.batchId)||rd()).add(t);i=i.insert(r.batchId,a)}))})).next((()=>{const s=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,c=i.value,u=ed();c.forEach((t=>{if(!r.has(t)){const i=Ed(e.get(t),n.get(t));null!==i&&u.set(t,i),r=r.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return yh.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n){return function(t){return hh.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Fl(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n):this.getDocumentsMatchingCollectionQuery(t,e,n)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next((r=>{const s=i-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-r.size):yh.resolve(td());let o=-1,a=r;return s.next((e=>yh.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),r.get(e)?yh.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,r))).next((()=>this.computeViews(t,a,e,rd()))).next((t=>({batchId:o,changes:Zl(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new hh(e)).next((t=>{let e=Yl();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n){const i=e.collectionGroup;let r=Yl();return this.indexManager.getCollectionParents(t,i).next((s=>yh.forEach(s,(s=>{const o=function(t,e){return new Ol(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return this.getDocumentsMatchingCollectionQuery(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(t,e,n){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((r=>(i=r,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i)))).next((t=>{i.forEach(((e,n)=>{const i=n.getKey();null===t.get(i)&&(t=t.insert(i,sl.newInvalidDocument(i)))}));let n=Yl();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Sd(s.mutation,r,Nh.empty(),rh.now()),Kl(e,r)&&(n=n.insert(t,r))})),n}))}}class Uf{constructor(t){this.serializer=t,this.ar=new Map,this.ur=new Map}getBundleMetadata(t,e){return yh.resolve(this.ar.get(e))}saveBundleMetadata(t,e){return this.ar.set(e.id,function(t){return{id:t.id,version:t.version,createTime:uf(t.createTime)}}(e)),yh.resolve()}getNamedQuery(t,e){return yh.resolve(this.ur.get(e))}saveNamedQuery(t,e){return this.ur.set(e.name,function(t){return{name:t.name,query:Df(t.bundledQuery),readTime:uf(t.readTime)}}(e)),yh.resolve()}}class Vf{constructor(){this.overlays=new Sh(hh.comparator),this.cr=new Map}getOverlay(t,e){return yh.resolve(this.overlays.get(e))}getOverlays(t,e){const n=td();return yh.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,i)=>{this.ht(t,e,i)})),yh.resolve()}removeOverlaysForBatchId(t,e,n){const i=this.cr.get(n);return void 0!==i&&(i.forEach((t=>this.overlays=this.overlays.remove(t))),this.cr.delete(n)),yh.resolve()}getOverlaysForCollection(t,e,n){const i=td(),r=e.length+1,s=new hh(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===r&&t.largestBatchId>n&&i.set(t.getKey(),t)}return yh.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let r=new Sh(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=td(),r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=td(),a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=i)););return yh.resolve(o)}ht(t,e,n){const i=this.overlays.get(n.key);if(null!==i){const t=this.cr.get(i.largestBatchId).delete(n.key);this.cr.set(i.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ld(e,n));let r=this.cr.get(e);void 0===r&&(r=rd(),this.cr.set(e,r)),this.cr.set(e,r.add(n.key))}}class jf{constructor(){this.lr=new Ah($f.hr),this.Pr=new Ah($f.Ir)}isEmpty(){return this.lr.isEmpty()}addReference(t,e){const n=new $f(t,e);this.lr=this.lr.add(n),this.Pr=this.Pr.add(n)}Tr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Er(new $f(t,e))}dr(t,e){t.forEach((t=>this.removeReference(t,e)))}Ar(t){const e=new hh(new ah([])),n=new $f(e,t),i=new $f(e,t+1),r=[];return this.Pr.forEachInRange([n,i],(t=>{this.Er(t),r.push(t.key)})),r}Rr(){this.lr.forEach((t=>this.Er(t)))}Er(t){this.lr=this.lr.delete(t),this.Pr=this.Pr.delete(t)}Vr(t){const e=new hh(new ah([])),n=new $f(e,t),i=new $f(e,t+1);let r=rd();return this.Pr.forEachInRange([n,i],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new $f(t,0),n=this.lr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class $f{constructor(t,e){this.key=t,this.mr=e}static hr(t,e){return hh.comparator(t.key,e.key)||nh(t.mr,e.mr)}static Ir(t,e){return nh(t.mr,e.mr)||hh.comparator(t.key,e.key)}}class Bf{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.gr=1,this.pr=new Ah($f.hr)}checkEmpty(t){return yh.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,i){const r=this.gr;this.gr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Pd(r,e,n,i);this.mutationQueue.push(s);for(const e of i)this.pr=this.pr.add(new $f(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return yh.resolve(s)}lookupMutationBatch(t,e){return yh.resolve(this.yr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,i=this.wr(n),r=i<0?0:i;return yh.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return yh.resolve(0===this.mutationQueue.length?-1:this.gr-1)}getAllMutationBatches(t){return yh.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new $f(e,0),i=new $f(e,Number.POSITIVE_INFINITY),r=[];return this.pr.forEachInRange([n,i],(t=>{const e=this.yr(t.mr);r.push(e)})),yh.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Ah(nh);return e.forEach((t=>{const e=new $f(t,0),i=new $f(t,Number.POSITIVE_INFINITY);this.pr.forEachInRange([e,i],(t=>{n=n.add(t.mr)}))})),yh.resolve(this.Sr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,i=n.length+1;let r=n;hh.isDocumentKey(r)||(r=r.child(""));const s=new $f(new hh(r),0);let o=new Ah(nh);return this.pr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===i&&(o=o.add(t.mr)),!0)}),s),yh.resolve(this.Sr(o))}Sr(t){const e=[];return t.forEach((t=>{const n=this.yr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){$u(0===this.br(e.batchId,"removed")),this.mutationQueue.shift();let n=this.pr;return yh.forEach(e.mutations,(i=>{const r=new $f(i.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)})).next((()=>{this.pr=n}))}Cn(t){}containsKey(t,e){const n=new $f(e,0),i=this.pr.firstAfterOrEqual(n);return yh.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,yh.resolve()}br(t,e){return this.wr(t)}wr(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}yr(t){const e=this.wr(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class qf{constructor(t){this.Dr=t,this.docs=new Sh(hh.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,i=this.docs.get(n),r=i?i.size:0,s=this.Dr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return yh.resolve(n?n.document.mutableCopy():sl.newInvalidDocument(e))}getEntries(t,e){let n=Jl();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():sl.newInvalidDocument(t))})),yh.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let r=Jl();const s=e.path,o=new hh(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||fh(lh(o),n)<=0||(i.has(o.key)||Kl(e,o))&&(r=r.insert(o.key,o.mutableCopy()))}return yh.resolve(r)}getAllFromCollectionGroup(t,e,n,i){ju()}vr(t,e){return yh.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new zf(this)}getSize(t){return yh.resolve(this.size)}}class zf extends Mf{constructor(t){super(),this.sr=t}applyChanges(t){const e=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?e.push(this.sr.addEntry(t,i)):this.sr.removeEntry(n)})),yh.waitFor(e)}getFromCache(t,e){return this.sr.getEntry(t,e)}getAllFromCache(t,e){return this.sr.getEntries(t,e)}}class Kf{constructor(t){this.persistence=t,this.Cr=new Wl((t=>Dl(t)),Nl),this.lastRemoteSnapshotVersion=sh.min(),this.highestTargetId=0,this.Fr=0,this.Mr=new jf,this.targetCount=0,this.Or=Lf.xn()}forEachTarget(t,e){return this.Cr.forEach(((t,n)=>e(n))),yh.resolve()}getLastRemoteSnapshotVersion(t){return yh.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return yh.resolve(this.Fr)}allocateTargetId(t){return this.highestTargetId=this.Or.next(),yh.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Fr&&(this.Fr=e),yh.resolve()}Ln(t){this.Cr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Or=new Lf(e),this.highestTargetId=e),t.sequenceNumber>this.Fr&&(this.Fr=t.sequenceNumber)}addTargetData(t,e){return this.Ln(e),this.targetCount+=1,yh.resolve()}updateTargetData(t,e){return this.Ln(e),yh.resolve()}removeTargetData(t,e){return this.Cr.delete(e.target),this.Mr.Ar(e.targetId),this.targetCount-=1,yh.resolve()}removeTargets(t,e,n){let i=0;const r=[];return this.Cr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Cr.delete(s),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),i++)})),yh.waitFor(r).next((()=>i))}getTargetCount(t){return yh.resolve(this.targetCount)}getTargetData(t,e){const n=this.Cr.get(e)||null;return yh.resolve(n)}addMatchingKeys(t,e,n){return this.Mr.Tr(e,n),yh.resolve()}removeMatchingKeys(t,e,n){this.Mr.dr(e,n);const i=this.persistence.referenceDelegate,r=[];return i&&e.forEach((e=>{r.push(i.markPotentiallyOrphaned(t,e))})),yh.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.Mr.Ar(e),yh.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Mr.Vr(e);return yh.resolve(n)}containsKey(t,e){return yh.resolve(this.Mr.containsKey(e))}}class Hf{constructor(t,e){this.Nr={},this.overlays={},this.Br=new wh(0),this.Lr=!1,this.Lr=!0,this.referenceDelegate=t(this),this.kr=new Kf(this),this.indexManager=new Rf,this.remoteDocumentCache=function(t){return new qf(t)}((t=>this.referenceDelegate.qr(t))),this.serializer=new Af(e),this.Qr=new Uf(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Lr=!1,Promise.resolve()}get started(){return this.Lr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Vf,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Nr[t.toKey()];return n||(n=new Bf(e,this.referenceDelegate),this.Nr[t.toKey()]=n),n}getTargetCache(){return this.kr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Qr}runTransaction(t,e,n){xu("MemoryPersistence","Starting transaction:",t);const i=new Gf(this.Br.next());return this.referenceDelegate.Kr(),n(i).next((t=>this.referenceDelegate.$r(i).next((()=>t)))).toPromise().then((t=>(i.raiseOnCommittedEvent(),t)))}Ur(t,e){return yh.or(Object.values(this.Nr).map((n=>()=>n.containsKey(t,e))))}}class Gf extends gh{constructor(t){super(),this.currentSequenceNumber=t}}class Wf{constructor(t){this.persistence=t,this.Wr=new jf,this.Gr=null}static zr(t){return new Wf(t)}get jr(){if(this.Gr)return this.Gr;throw ju()}addReference(t,e,n){return this.Wr.addReference(n,e),this.jr.delete(n.toString()),yh.resolve()}removeReference(t,e,n){return this.Wr.removeReference(n,e),this.jr.add(n.toString()),yh.resolve()}markPotentiallyOrphaned(t,e){return this.jr.add(e.toString()),yh.resolve()}removeTarget(t,e){this.Wr.Ar(e.targetId).forEach((t=>this.jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Kr(){this.Gr=new Set}$r(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return yh.forEach(this.jr,(n=>{const i=hh.fromPath(n);return this.Hr(t,i).next((t=>{t||e.removeEntry(i,sh.min())}))})).next((()=>(this.Gr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Hr(t,e).next((t=>{t?this.jr.delete(e.toString()):this.jr.add(e.toString())}))}qr(t){return 0}Hr(t,e){return yh.or([()=>yh.resolve(this.Wr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ur(t,e)])}}class Qf{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.Li=n,this.ki=i}static qi(t,e){let n=rd(),i=rd();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:i=i.add(t.doc.key)}return new Qf(t,e.fromCache,n,i)}}class Jf{constructor(){this.Qi=!1}initialize(t,e){this.Ki=t,this.indexManager=e,this.Qi=!0}getDocumentsMatchingQuery(t,e,n,i){return this.$i(t,e).next((r=>r||this.Ui(t,e,i,n))).next((n=>n||this.Wi(t,e)))}$i(t,e){if(Ll(e))return yh.resolve(null);let n=Vl(e);return this.indexManager.getIndexType(t,n).next((i=>0===i?null:(null!==e.limit&&1===i&&(e=$l(e,null,"F"),n=Vl(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((i=>{const r=rd(...i);return this.Ki.getDocuments(t,r).next((i=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Gi(e,i);return this.zi(e,s,r,n.readTime)?this.$i(t,$l(e,null,"F")):this.ji(t,s,e,n)}))))})))))}Ui(t,e,n,i){return Ll(e)||i.isEqual(sh.min())?this.Wi(t,e):this.Ki.getDocuments(t,n).next((r=>{const s=this.Gi(e,r);return this.zi(e,s,n,i)?this.Wi(t,e):(Mu()<=x.DEBUG&&xu("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),zl(e)),this.ji(t,s,e,function(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,r=sh.fromTimestamp(1e9===i?new rh(n+1,0):new rh(n,i));return new dh(r,hh.empty(),e)}(i,-1)))}))}Gi(t,e){let n=new Ah(Hl(t));return e.forEach(((e,i)=>{Kl(t,i)&&(n=n.add(i))})),n}zi(t,e,n,i){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const r="F"===t.limitType?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(i)>0)}Wi(t,e){return Mu()<=x.DEBUG&&xu("QueryEngine","Using full collection scan to execute query:",zl(e)),this.Ki.getDocumentsMatchingQuery(t,e,dh.min())}ji(t,e,n,i){return this.Ki.getDocumentsMatchingQuery(t,n,i).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Xf{constructor(t,e,n,i){this.persistence=t,this.Hi=e,this.serializer=i,this.Ji=new Sh(nh),this.Yi=new Wl((t=>Dl(t)),Nl),this.Zi=new Map,this.Xi=t.getRemoteDocumentCache(),this.kr=t.getTargetCache(),this.Qr=t.getBundleCache(),this.es(n)}es(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ff(this.Xi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Xi.setIndexManager(this.indexManager),this.Hi.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ji)))}}async function Yf(t,e){const n=Bu(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let i;return n.mutationQueue.getAllMutationBatches(t).next((r=>(i=r,n.es(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const r=[],s=[];let o=rd();for(const t of i){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({ts:t,removedBatchIds:r,addedBatchIds:s})))}))}))}function Zf(t){const e=Bu(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.kr.getLastRemoteSnapshotVersion(t)))}async function tp(t,e,n){const i=Bu(t),r=i.Ji.get(e),s=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",s,(t=>i.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!vh(t))throw t;xu("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}i.Ji=i.Ji.remove(e),i.Yi.delete(r.target)}function ep(t,e,n){const i=Bu(t);let r=sh.min(),s=rd();return i.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const i=Bu(t),r=i.Yi.get(n);return void 0!==r?yh.resolve(i.Ji.get(r)):i.kr.getTargetData(e,n)}(i,t,Vl(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,i.kr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>i.Hi.getDocumentsMatchingQuery(t,e,n?r:sh.min(),n?s:rd()))).next((t=>(function(t,e,n){let i=t.Zi.get(e)||sh.min();n.forEach(((t,e)=>{e.readTime.compareTo(i)>0&&(i=e.readTime)})),t.Zi.set(e,i)}(i,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,ss:s})))))}class np{constructor(){this.activeTargetIds=sd}hs(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ps(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ls(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ip{constructor(){this.Hs=new np,this.Js={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.Hs.hs(t),this.Js[t]||"not-current"}updateQueryState(t,e,n){this.Js[t]=e}removeLocalQueryTarget(t){this.Hs.Ps(t)}isLocalQueryTarget(t){return this.Hs.activeTargetIds.has(t)}clearQueryState(t){delete this.Js[t]}getAllActiveQueryTargets(){return this.Hs.activeTargetIds}isActiveQueryTarget(t){return this.Hs.activeTargetIds.has(t)}start(){return this.Hs=new np,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class rp{Ys(t){}shutdown(){}}class sp{constructor(){this.Zs=()=>this.Xs(),this.eo=()=>this.no(),this.ro=[],this.io()}Ys(t){this.ro.push(t)}shutdown(){window.removeEventListener("online",this.Zs),window.removeEventListener("offline",this.eo)}io(){window.addEventListener("online",this.Zs),window.addEventListener("offline",this.eo)}Xs(){xu("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.ro)t(0)}no(){xu("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.ro)t(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let op=null;function ap(){return null===op?op=268435456+Math.round(2147483648*Math.random()):op++,"0x"+op.toString(16)}const cp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class up{constructor(t){this.so=t.so,this.oo=t.oo}_o(t){this.ao=t}uo(t){this.co=t}onMessage(t){this.lo=t}close(){this.oo()}send(t){this.so(t)}ho(){this.ao()}Po(t){this.co(t)}Io(t){this.lo(t)}}const hp="WebChannelConnection";class lp extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.To=e+"://"+t.host,this.Eo=`projects/${n}/databases/${i}`,this.Ao="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${i}`}get Ro(){return!1}Vo(t,e,n,i,r){const s=ap(),o=this.mo(t,e);xu("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Eo,"x-goog-request-params":this.Ao};return this.fo(a,i,r),this.po(t,o,a,n).then((e=>(xu("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw Uu("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}yo(t,e,n,i,r,s){return this.Vo(t,e,n,i,r)}fo(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Pu,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}mo(t,e){const n=cp[t];return`${this.To}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}po(t,e,n,i){const r=ap();return new Promise(((s,o)=>{const a=new Au;a.setWithCredentials(!0),a.listenOnce(Eu.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case bu.NO_ERROR:const e=a.getResponseJson();xu(hp,`XHR for RPC '${t}' ${r} received:`,JSON.stringify(e)),s(e);break;case bu.TIMEOUT:xu(hp,`RPC '${t}' ${r} timed out`),o(new zu(qu.DEADLINE_EXCEEDED,"Request time out"));break;case bu.HTTP_ERROR:const n=a.getStatus();if(xu(hp,`RPC '${t}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(qu).indexOf(e)>=0?e:qu.UNKNOWN}(e.status);o(new zu(t,e.message))}else o(new zu(qu.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new zu(qu.UNAVAILABLE,"Connection failed."));break;default:ju()}}finally{xu(hp,`RPC '${t}' ${r} completed.`)}}));const c=JSON.stringify(i);xu(hp,`RPC '${t}' ${r} sending request:`,i),a.send(e,"POST",c,n,15)}))}wo(t,e,n){const i=ap(),r=[this.To,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Iu(),o=_u(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.xmlHttpFactory=new Cu({})),this.fo(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=r.join("");xu(hp,`Creating RPC '${t}' stream ${i}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new up({so:e=>{d?xu(hp,`Not sending because RPC '${t}' stream ${i} is closed:`,e):(l||(xu(hp,`Opening RPC '${t}' stream ${i} transport.`),h.open(),l=!0),xu(hp,`RPC '${t}' stream ${i} sending:`,e),h.send(e))},oo:()=>h.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,ku.EventType.OPEN,(()=>{d||xu(hp,`RPC '${t}' stream ${i} transport opened.`)})),p(h,ku.EventType.CLOSE,(()=>{d||(d=!0,xu(hp,`RPC '${t}' stream ${i} transport closed`),f.Po())})),p(h,ku.EventType.ERROR,(e=>{d||(d=!0,Uu(hp,`RPC '${t}' stream ${i} transport errored:`,e),f.Po(new zu(qu.UNAVAILABLE,"The operation could not be completed")))})),p(h,ku.EventType.MESSAGE,(e=>{var n;if(!d){const r=e.data[0];$u(!!r);const s=r,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){xu(hp,`RPC '${t}' stream ${i} received error:`,o);const e=o.status;let n=function(t){const e=xd[t];if(void 0!==e)return Ud(e)}(e),r=o.message;void 0===n&&(n=qu.INTERNAL,r="Unknown error status: "+e+" with message "+o.message),d=!0,f.Po(new zu(n,r)),h.close()}else xu(hp,`RPC '${t}' stream ${i} received:`,r),f.Io(r)}})),p(o,Tu.STAT_EVENT,(e=>{e.stat===Su.PROXY?xu(hp,`RPC '${t}' stream ${i} detected buffering proxy`):e.stat===Su.NOPROXY&&xu(hp,`RPC '${t}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{f.ho()}),0),f}}function dp(){return"undefined"!=typeof document?document:null}function fp(t){return new sf(t,!0)}class pp{constructor(t,e,n=1e3,i=1.5,r=6e4){this.ii=t,this.timerId=e,this.So=n,this.bo=i,this.Do=r,this.vo=0,this.Co=null,this.Fo=Date.now(),this.reset()}reset(){this.vo=0}Mo(){this.vo=this.Do}xo(t){this.cancel();const e=Math.floor(this.vo+this.Oo()),n=Math.max(0,Date.now()-this.Fo),i=Math.max(0,e-n);i>0&&xu("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.vo} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Co=this.ii.enqueueAfterDelay(this.timerId,i,(()=>(this.Fo=Date.now(),t()))),this.vo*=this.bo,this.vo<this.So&&(this.vo=this.So),this.vo>this.Do&&(this.vo=this.Do)}No(){null!==this.Co&&(this.Co.skipDelay(),this.Co=null)}cancel(){null!==this.Co&&(this.Co.cancel(),this.Co=null)}Oo(){return(Math.random()-.5)*this.vo}}class gp{constructor(t,e,n,i,r,s,o,a){this.ii=t,this.Bo=n,this.Lo=i,this.connection=r,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.ko=0,this.qo=null,this.Qo=null,this.stream=null,this.Ko=new pp(t,e)}$o(){return 1===this.state||5===this.state||this.Uo()}Uo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Wo()}async stop(){this.$o()&&await this.close(0)}Go(){this.state=0,this.Ko.reset()}zo(){this.Uo()&&null===this.qo&&(this.qo=this.ii.enqueueAfterDelay(this.Bo,6e4,(()=>this.jo())))}Ho(t){this.Jo(),this.stream.send(t)}async jo(){if(this.Uo())return this.close(0)}Jo(){this.qo&&(this.qo.cancel(),this.qo=null)}Yo(){this.Qo&&(this.Qo.cancel(),this.Qo=null)}async close(t,e){this.Jo(),this.Yo(),this.Ko.cancel(),this.ko++,4!==t?this.Ko.reset():e&&e.code===qu.RESOURCE_EXHAUSTED?(Fu(e.toString()),Fu("Using maximum backoff delay to prevent overloading the backend."),this.Ko.Mo()):e&&e.code===qu.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Zo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.uo(e)}Zo(){}auth(){this.state=1;const t=this.Xo(this.ko),e=this.ko;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.ko===e&&this.e_(t,n)}),(e=>{t((()=>{const t=new zu(qu.UNKNOWN,"Fetching auth token failed: "+e.message);return this.t_(t)}))}))}e_(t,e){const n=this.Xo(this.ko);this.stream=this.n_(t,e),this.stream._o((()=>{n((()=>(this.state=2,this.Qo=this.ii.enqueueAfterDelay(this.Lo,1e4,(()=>(this.Uo()&&(this.state=3),Promise.resolve()))),this.listener._o())))})),this.stream.uo((t=>{n((()=>this.t_(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Wo(){this.state=5,this.Ko.xo((async()=>{this.state=0,this.start()}))}t_(t){return xu("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}Xo(t){return e=>{this.ii.enqueueAndForget((()=>this.ko===t?e():(xu("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class mp extends gp{constructor(t,e,n,i,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,s),this.serializer=r}n_(t,e){return this.connection.wo("Listen",t,e)}onMessage(t){this.Ko.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const i=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:ju()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?($u(void 0===e||"string"==typeof e),Oh.fromBase64String(e||"")):($u(void 0===e||e instanceof Uint8Array),Oh.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?qu.UNKNOWN:Ud(t.code);return new zu(e,t.message||"")}(o);n=new Jd(i,r,s,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const r=df(t,i.document.name),s=uf(i.document.updateTime),o=i.document.createTime?uf(i.document.createTime):sh.min(),a=new rl({mapValue:{fields:i.document.fields}}),c=sl.newFoundDocument(r,s,o,a),u=i.targetIds||[],h=i.removedTargetIds||[];n=new Wd(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const r=df(t,i.document),s=i.readTime?uf(i.readTime):sh.min(),o=sl.newNoDocument(r,s),a=i.removedTargetIds||[];n=new Wd([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const r=df(t,i.document),s=i.removedTargetIds||[];n=new Wd([],s,r,null)}else{if(!("filter"in e))return ju();{e.filter;const t=e.filter;t.targetId;const{count:i=0,unchangedNames:r}=t,s=new Md(i,r),o=t.targetId;n=new Qd(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return sh.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?sh.min():e.readTime?uf(e.readTime):sh.min()}(t);return this.listener.r_(e,n)}i_(t){const e={};e.database=pf(this.serializer),e.addTarget=function(t,e){let n;const i=e.target;if(n=Rl(i)?{documents:mf(t,i)}:{query:yf(t,i)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=cf(t,e.resumeToken);const i=of(t,e.expectedCount);null!==i&&(n.expectedCount=i)}else if(e.snapshotVersion.compareTo(sh.min())>0){n.readTime=af(t,e.snapshotVersion.toTimestamp());const i=of(t,e.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ju()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Ho(e)}s_(t){const e={};e.database=pf(this.serializer),e.removeTarget=t,this.Ho(e)}}class yp extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.h_=!1}P_(){if(this.h_)throw new zu(qu.FAILED_PRECONDITION,"The client has already been terminated.")}Vo(t,e,n){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,r])=>this.connection.Vo(t,e,n,i,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===qu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new zu(qu.UNKNOWN,t.toString())}))}yo(t,e,n,i){return this.P_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,s])=>this.connection.yo(t,e,n,r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===qu.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new zu(qu.UNKNOWN,t.toString())}))}terminate(){this.h_=!0}}class vp{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.T_=0,this.E_=null,this.d_=!0}A_(){0===this.T_&&(this.R_("Unknown"),this.E_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.E_=null,this.V_("Backend didn't respond within 10 seconds."),this.R_("Offline"),Promise.resolve()))))}m_(t){"Online"===this.state?this.R_("Unknown"):(this.T_++,this.T_>=1&&(this.f_(),this.V_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.R_("Offline")))}set(t){this.f_(),this.T_=0,"Online"===t&&(this.d_=!1),this.R_(t)}R_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}V_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.d_?(Fu(e),this.d_=!1):xu("OnlineStateTracker",e)}f_(){null!==this.E_&&(this.E_.cancel(),this.E_=null)}}class wp{constructor(t,e,n,i,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.g_=[],this.p_=new Map,this.y_=new Set,this.w_=[],this.S_=r,this.S_.Ys((t=>{n.enqueueAndForget((async()=>{Ap(this)&&(xu("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Bu(t);e.y_.add(4),await _p(e),e.b_.set("Unknown"),e.y_.delete(4),await Ip(e)}(this))}))})),this.b_=new vp(n,i)}}async function Ip(t){if(Ap(t))for(const e of t.w_)await e(!0)}async function _p(t){for(const e of t.w_)await e(!1)}function bp(t,e){const n=Bu(t);n.p_.has(e.targetId)||(n.p_.set(e.targetId,e),kp(n)?Cp(n):Mp(n).Uo()&&Tp(n,e))}function Ep(t,e){const n=Bu(t),i=Mp(n);n.p_.delete(e),i.Uo()&&Sp(n,e),0===n.p_.size&&(i.Uo()?i.zo():Ap(n)&&n.b_.set("Unknown"))}function Tp(t,e){if(t.D_.Be(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(sh.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Mp(t).i_(e)}function Sp(t,e){t.D_.Be(e),Mp(t).s_(e)}function Cp(t){t.D_=new Yd({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ut:e=>t.p_.get(e)||null,rt:()=>t.datastore.serializer.databaseId}),Mp(t).start(),t.b_.A_()}function kp(t){return Ap(t)&&!Mp(t).$o()&&t.p_.size>0}function Ap(t){return 0===Bu(t).y_.size}function Dp(t){t.D_=void 0}async function Np(t){t.p_.forEach(((e,n)=>{Tp(t,e)}))}async function Rp(t,e){Dp(t),kp(t)?(t.b_.m_(e),Cp(t)):t.b_.set("Unknown")}async function Op(t,e,n){if(t.b_.set("Online"),e instanceof Jd&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const i of e.targetIds)t.p_.has(i)&&(await t.remoteSyncer.rejectListen(i,n),t.p_.delete(i),t.D_.removeTarget(i))}(t,e)}catch(n){xu("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Pp(t,n)}else if(e instanceof Wd?t.D_.We(e):e instanceof Qd?t.D_.Ze(e):t.D_.je(e),!n.isEqual(sh.min()))try{const e=await Zf(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.D_.st(e);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.p_.get(i);r&&t.p_.set(i,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const i=t.p_.get(e);if(!i)return;t.p_.set(e,i.withResumeToken(Oh.EMPTY_BYTE_STRING,i.snapshotVersion)),Sp(t,e);const r=new kf(i.target,e,n,i.sequenceNumber);Tp(t,r)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){xu("RemoteStore","Failed to raise snapshot:",e),await Pp(t,e)}}async function Pp(t,e,n){if(!vh(e))throw e;t.y_.add(1),await _p(t),t.b_.set("Offline"),n||(n=()=>Zf(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{xu("RemoteStore","Retrying IndexedDB access"),await n(),t.y_.delete(1),await Ip(t)}))}async function Lp(t,e){const n=Bu(t);n.asyncQueue.verifyOperationInProgress(),xu("RemoteStore","RemoteStore received new credentials");const i=Ap(n);n.y_.add(3),await _p(n),i&&n.b_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.y_.delete(3),await Ip(n)}function Mp(t){return t.v_||(t.v_=function(t,e,n){const i=Bu(t);return i.P_(),new mp(e,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(t.datastore,t.asyncQueue,{_o:Np.bind(null,t),uo:Rp.bind(null,t),r_:Op.bind(null,t)}),t.w_.push((async e=>{e?(t.v_.Go(),kp(t)?Cp(t):t.b_.set("Unknown")):(await t.v_.stop(),Dp(t))}))),t.v_}class xp{constructor(t,e,n,i,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=r,this.deferred=new Ku,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,i,r){const s=Date.now()+n,o=new xp(t,e,s,i,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new zu(qu.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fp(t,e){if(Fu("AsyncQueue",`${e}: ${t}`),vh(t))return new zu(qu.UNAVAILABLE,`${e}: ${t}`);throw t}class Up{constructor(t){this.comparator=t?(e,n)=>t(e,n)||hh.comparator(e.key,n.key):(t,e)=>hh.comparator(t.key,e.key),this.keyedMap=Yl(),this.sortedSet=new Sh(this.comparator)}static emptySet(t){return new Up(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Up))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,i=n.getNext().key;if(!t.isEqual(i))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Up;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Vp{constructor(){this.F_=new Sh(hh.comparator)}track(t){const e=t.doc.key,n=this.F_.get(e);n?0!==t.type&&3===n.type?this.F_=this.F_.insert(e,t):3===t.type&&1!==n.type?this.F_=this.F_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.F_=this.F_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.F_=this.F_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.F_=this.F_.remove(e):1===t.type&&2===n.type?this.F_=this.F_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.F_=this.F_.insert(e,{type:2,doc:t.doc}):ju():this.F_=this.F_.insert(e,t)}M_(){const t=[];return this.F_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class jp{constructor(t,e,n,i,r,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=r,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,i,r){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new jp(t,e,Up.emptySet(e),s,n,i,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Bl(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class $p{constructor(){this.x_=void 0,this.listeners=[]}}class Bp{constructor(){this.queries=new Wl((t=>ql(t)),Bl),this.onlineState="Unknown",this.O_=new Set}}function qp(t,e){const n=Bu(t);let i=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.listeners)e.B_(t)&&(i=!0);r.x_=t}}i&&Kp(n)}function zp(t,e,n){const i=Bu(t),r=i.queries.get(e);if(r)for(const t of r.listeners)t.onError(n);i.queries.delete(e)}function Kp(t){t.O_.forEach((t=>{t.next()}))}class Hp{constructor(t,e,n){this.query=t,this.L_=e,this.k_=!1,this.q_=null,this.onlineState="Unknown",this.options=n||{}}B_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new jp(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.k_?this.Q_(t)&&(this.L_.next(t),e=!0):this.K_(t,this.onlineState)&&(this.U_(t),e=!0),this.q_=t,e}onError(t){this.L_.error(t)}N_(t){this.onlineState=t;let e=!1;return this.q_&&!this.k_&&this.K_(this.q_,t)&&(this.U_(this.q_),e=!0),e}K_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.W_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}Q_(t){if(t.docChanges.length>0)return!0;const e=this.q_&&this.q_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}U_(t){t=jp.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.k_=!0,this.L_.next(t)}}class Gp{constructor(t){this.key=t}}class Wp{constructor(t){this.key=t}}class Qp{constructor(t,e){this.query=t,this.X_=e,this.ea=null,this.hasCachedResults=!1,this.current=!1,this.ta=rd(),this.mutatedKeys=rd(),this.na=Hl(t),this.ra=new Up(this.na)}get ia(){return this.X_}sa(t,e){const n=e?e.oa:new Vp,i=e?e.ra:this.ra;let r=e?e.mutatedKeys:this.mutatedKeys,s=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,c="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(((t,e)=>{const u=i.get(t),h=Kl(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this._a(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.na(h,a)>0||c&&this.na(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),r=d?r.add(t):r.delete(t)):(s=s.delete(t),r=r.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{ra:s,oa:n,zi:o,mutatedKeys:r}}_a(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const i=this.ra;this.ra=t.ra,this.mutatedKeys=t.mutatedKeys;const r=t.oa.M_();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ju()}};return n(t)-n(e)}(t.type,e.type)||this.na(t.doc,e.doc))),this.aa(n);const s=e?this.ua():[],o=0===this.ta.size&&this.current?1:0,a=o!==this.ea;return this.ea=o,0!==r.length||a?{snapshot:new jp(this.query,t.ra,i,r,t.mutatedKeys,0===o,a,!1,!!n&&n.resumeToken.approximateByteSize()>0),ca:s}:{ca:s}}N_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ra:this.ra,oa:new Vp,mutatedKeys:this.mutatedKeys,zi:!1},!1)):{ca:[]}}la(t){return!this.X_.has(t)&&!!this.ra.has(t)&&!this.ra.get(t).hasLocalMutations}aa(t){t&&(t.addedDocuments.forEach((t=>this.X_=this.X_.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.X_=this.X_.delete(t))),this.current=t.current)}ua(){if(!this.current)return[];const t=this.ta;this.ta=rd(),this.ra.forEach((t=>{this.la(t.key)&&(this.ta=this.ta.add(t.key))}));const e=[];return t.forEach((t=>{this.ta.has(t)||e.push(new Wp(t))})),this.ta.forEach((n=>{t.has(n)||e.push(new Gp(n))})),e}ha(t){this.X_=t.ss,this.ta=rd();const e=this.sa(t.documents);return this.applyChanges(e,!0)}Pa(){return jp.fromInitialDocuments(this.query,this.ra,this.mutatedKeys,0===this.ea,this.hasCachedResults)}}class Jp{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Xp{constructor(t){this.key=t,this.Ia=!1}}class Yp{constructor(t,e,n,i,r,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=r,this.maxConcurrentLimboResolutions=s,this.Ta={},this.Ea=new Wl((t=>ql(t)),Bl),this.da=new Map,this.Aa=new Set,this.Ra=new Sh(hh.comparator),this.Va=new Map,this.ma=new jf,this.fa={},this.ga=new Map,this.pa=Lf.On(),this.onlineState="Unknown",this.ya=void 0}get isPrimaryClient(){return!0===this.ya}}async function Zp(t,e){const n=function(t){const e=Bu(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=eg.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lg.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ig.bind(null,e),e.Ta.r_=qp.bind(null,e.eventManager),e.Ta.Sa=zp.bind(null,e.eventManager),e}(t);let i,r;const s=n.Ea.get(e);if(s)i=s.targetId,n.sharedClientState.addLocalQueryTarget(i),r=s.view.Pa();else{const t=await function(t,e){const n=Bu(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let i;return n.kr.getTargetData(t,e).next((r=>r?(i=r,yh.resolve(i)):n.kr.allocateTargetId(t).next((r=>(i=new kf(e,r,"TargetPurposeListen",t.currentSequenceNumber),n.kr.addTargetData(t,i).next((()=>i)))))))})).then((t=>{const i=n.Ji.get(t.targetId);return(null===i||t.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Ji=n.Ji.insert(t.targetId,t),n.Yi.set(e,t.targetId)),t}))}(n.localStore,Vl(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);i=t.targetId,r=await async function(t,e,n,i,r){t.wa=(e,n,i)=>async function(t,e,n,i){let r=e.view.sa(n);r.zi&&(r=await ep(t.localStore,e.query,!1).then((({documents:t})=>e.view.sa(t,r))));const s=i&&i.targetChanges.get(e.targetId),o=e.view.applyChanges(r,t.isPrimaryClient,s);return og(t,e.targetId,o.ca),o.snapshot}(t,e,n,i);const s=await ep(t.localStore,e,!0),o=new Qp(e,s.ss),a=o.sa(s.documents),c=Gd.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==t.onlineState,r),u=o.applyChanges(a,t.isPrimaryClient,c);og(t,n,u.ca);const h=new Jp(e,n,o);return t.Ea.set(e,h),t.da.has(n)?t.da.get(n).push(e):t.da.set(n,[e]),u.snapshot}(n,e,i,"current"===s,t.resumeToken),n.isPrimaryClient&&bp(n.remoteStore,t)}return r}async function tg(t,e){const n=Bu(t),i=n.Ea.get(e),r=n.da.get(i.targetId);if(r.length>1)return n.da.set(i.targetId,r.filter((t=>!Bl(t,e)))),void n.Ea.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await tp(n.localStore,i.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(i.targetId),Ep(n.remoteStore,i.targetId),rg(n,i.targetId)})).catch(mh)):(rg(n,i.targetId),await tp(n.localStore,i.targetId,!0))}async function eg(t,e){const n=Bu(t);try{const t=await function(t,e){const n=Bu(t),i=e.snapshotVersion;let r=n.Ji;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.Xi.newChangeBuffer({trackRemovals:!0});r=n.Ji;const o=[];e.targetChanges.forEach(((s,a)=>{const c=r.get(a);if(!c)return;o.push(n.kr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.kr.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Oh.EMPTY_BYTE_STRING,sh.min()).withLastLimboFreeSnapshotVersion(sh.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,i)),r=r.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.kr.updateTargetData(t,u))}));let a=Jl(),c=rd();if(e.documentUpdates.forEach((i=>{e.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,i))})),o.push(function(t,e,n){let i=rd(),r=rd();return n.forEach((t=>i=i.add(t))),e.getEntries(t,i).next((t=>{let i=Jl();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(r=r.add(n)),s.isNoDocument()&&s.version.isEqual(sh.min())?(e.removeEntry(n,s.readTime),i=i.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),i=i.insert(n,s)):xu("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{ns:i,rs:r}}))}(t,s,e.documentUpdates).next((t=>{a=t.ns,c=t.rs}))),!i.isEqual(sh.min())){const e=n.kr.getLastRemoteSnapshotVersion(t).next((e=>n.kr.setTargetsMetadata(t,t.currentSequenceNumber,i)));o.push(e)}return yh.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.Ji=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const i=n.Va.get(e);i&&($u(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?i.Ia=!0:t.modifiedDocuments.size>0?$u(i.Ia):t.removedDocuments.size>0&&($u(i.Ia),i.Ia=!1))})),await ug(n,t,e)}catch(t){await mh(t)}}function ng(t,e,n){const i=Bu(t);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const t=[];i.Ea.forEach(((n,i)=>{const r=i.view.N_(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=Bu(t);n.onlineState=e;let i=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.N_(e)&&(i=!0)})),i&&Kp(n)}(i.eventManager,e),t.length&&i.Ta.r_(t),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function ig(t,e,n){const i=Bu(t);i.sharedClientState.updateQueryState(e,"rejected",n);const r=i.Va.get(e),s=r&&r.key;if(s){let t=new Sh(hh.comparator);t=t.insert(s,sl.newNoDocument(s,sh.min()));const n=rd().add(s),r=new Hd(sh.min(),new Map,new Sh(nh),t,n);await eg(i,r),i.Ra=i.Ra.remove(s),i.Va.delete(e),cg(i)}else await tp(i.localStore,e,!1).then((()=>rg(i,e,n))).catch(mh)}function rg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.da.get(e))t.Ea.delete(i),n&&t.Ta.Sa(i,n);t.da.delete(e),t.isPrimaryClient&&t.ma.Ar(e).forEach((e=>{t.ma.containsKey(e)||sg(t,e)}))}function sg(t,e){t.Aa.delete(e.path.canonicalString());const n=t.Ra.get(e);null!==n&&(Ep(t.remoteStore,n),t.Ra=t.Ra.remove(e),t.Va.delete(n),cg(t))}function og(t,e,n){for(const i of n)i instanceof Gp?(t.ma.addReference(i.key,e),ag(t,i)):i instanceof Wp?(xu("SyncEngine","Document no longer in limbo: "+i.key),t.ma.removeReference(i.key,e),t.ma.containsKey(i.key)||sg(t,i.key)):ju()}function ag(t,e){const n=e.key,i=n.path.canonicalString();t.Ra.get(n)||t.Aa.has(i)||(xu("SyncEngine","New document in limbo: "+n),t.Aa.add(i),cg(t))}function cg(t){for(;t.Aa.size>0&&t.Ra.size<t.maxConcurrentLimboResolutions;){const e=t.Aa.values().next().value;t.Aa.delete(e);const n=new hh(ah.fromString(e)),i=t.pa.next();t.Va.set(i,new Xp(n)),t.Ra=t.Ra.insert(n,i),bp(t.remoteStore,new kf(Vl(Pl(n.path)),i,"TargetPurposeLimboResolution",wh.ae))}}async function ug(t,e,n){const i=Bu(t),r=[],s=[],o=[];i.Ea.isEmpty()||(i.Ea.forEach(((t,a)=>{o.push(i.wa(a,e,n).then((t=>{if((t||n)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){r.push(t);const e=Qf.qi(a.targetId,t);s.push(e)}})))})),await Promise.all(o),i.Ta.r_(r),await async function(t,e){const n=Bu(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>yh.forEach(e,(e=>yh.forEach(e.Li,(i=>n.persistence.referenceDelegate.addReference(t,e.targetId,i))).next((()=>yh.forEach(e.ki,(i=>n.persistence.referenceDelegate.removeReference(t,e.targetId,i)))))))))}catch(t){if(!vh(t))throw t;xu("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ji.get(e),i=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(i);n.Ji=n.Ji.insert(e,r)}}}(i.localStore,s))}async function hg(t,e){const n=Bu(t);if(!n.currentUser.isEqual(e)){xu("SyncEngine","User change. New user:",e.toKey());const t=await Yf(n.localStore,e);n.currentUser=e,function(t,e){t.ga.forEach((t=>{t.forEach((t=>{t.reject(new zu(qu.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.ga.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await ug(n,t.ts)}}function lg(t,e){const n=Bu(t),i=n.Va.get(e);if(i&&i.Ia)return rd().add(i.key);{let t=rd();const i=n.da.get(e);if(!i)return t;for(const e of i){const i=n.Ea.get(e);t=t.unionWith(i.view.ia)}return t}}class dg{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=fp(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,i){return new Xf(t,e,n,i)}(this.persistence,new Jf,t.initialUser,this.serializer)}createPersistence(t){return new Hf(Wf.zr,this.serializer)}createSharedClientState(t){return new ip}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class fg{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>ng(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=hg.bind(null,this.syncEngine),await async function(t,e){const n=Bu(t);e?(n.y_.delete(2),await Ip(n)):e||(n.y_.add(2),await _p(n),n.b_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Bp}createDatastore(t){const e=fp(t.databaseInfo.databaseId),n=function(t){return new lp(t)}(t.databaseInfo);return function(t,e,n,i){return new yp(t,e,n,i)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,i,r){return new wp(t,e,n,i,r)}(this.localStore,this.datastore,t.asyncQueue,(t=>ng(this.syncEngine,t,0)),sp.v()?new sp:new rp)}createSyncEngine(t,e){return function(t,e,n,i,r,s,o){const a=new Yp(t,e,n,i,r,s);return o&&(a.ya=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=Bu(t);xu("RemoteStore","RemoteStore shutting down."),e.y_.add(5),await _p(e),e.S_.shutdown(),e.b_.set("Unknown")}(this.remoteStore)}}class pg{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.va(this.observer.next,t)}error(t){this.observer.error?this.va(this.observer.error,t):Fu("Uncaught Error in snapshot listener:",t.toString())}Ca(){this.muted=!0}va(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class gg{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=Ou.UNAUTHENTICATED,this.clientId=eh.V(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{xu("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(xu("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new zu(qu.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ku;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Fp(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function mg(t,e){t.asyncQueue.verifyOperationInProgress(),xu("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async t=>{i.isEqual(t)||(await Yf(e.localStore,t),i=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function yg(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){xu("FirestoreClient","Using user provided OfflineComponentProvider");try{await mg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===qu.FAILED_PRECONDITION||t.code===qu.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;Uu("Error using user provided cache. Falling back to memory cache: "+n),await mg(t,new dg)}}else xu("FirestoreClient","Using default OfflineComponentProvider"),await mg(t,new dg);return t._offlineComponents}(t);xu("FirestoreClient","Initializing OnlineComponentProvider");const i=await t.getConfiguration();await e.initialize(n,i),t.setCredentialChangeListener((t=>Lp(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Lp(e.remoteStore,n))),t._onlineComponents=e}async function vg(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(xu("FirestoreClient","Using user provided OnlineComponentProvider"),await yg(t,t._uninitializedComponentsProvider._online)):(xu("FirestoreClient","Using default OnlineComponentProvider"),await yg(t,new fg))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=Zp.bind(null,e.syncEngine),n.onUnlisten=tg.bind(null,e.syncEngine),n}function wg(t,e,n={}){const i=new Ku;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,i,r){const s=new pg({next:n=>{e.enqueueAndForget((()=>async function(t,e){const n=Bu(t),i=e.query;let r=!1;const s=n.queries.get(i);if(s){const t=s.listeners.indexOf(e);t>=0&&(s.listeners.splice(t,1),r=0===s.listeners.length)}if(r)return n.queries.delete(i),n.onUnlisten(i)}(t,o))),n.fromCache&&"server"===i.source?r.reject(new zu(qu.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new Hp(n,s,{includeMetadataChanges:!0,W_:!0});return async function(t,e){const n=Bu(t),i=e.query;let r=!1,s=n.queries.get(i);if(s||(r=!0,s=new $p),r)try{s.x_=await n.onListen(i)}catch(t){const n=Fp(t,`Initialization of query '${zl(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.listeners.push(e),e.N_(n.onlineState),s.x_&&e.B_(s.x_)&&Kp(n)}(t,o)}(await vg(t),t.asyncQueue,e,n,i))),i.promise}function Ig(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const _g=new Map;function bg(t){if(hh.isDocumentKey(t))throw new zu(qu.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Eg(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":ju()}function Tg(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new zu(qu.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Eg(t);throw new zu(qu.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Sg{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new zu(qu.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new zu(qu.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,i){if(!0===e&&!0===i)throw new zu(qu.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Ig(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new zu(qu.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new zu(qu.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new zu(qu.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Cg{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sg({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new zu(qu.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new zu(qu.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sg(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Gu;switch(t.type){case"firstParty":return new Xu(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new zu(qu.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=_g.get(t);e&&(xu("ComponentProvider","Removing Datastore"),_g.delete(t),e.terminate())}(this),Promise.resolve()}}class kg{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new kg(this.firestore,t,this._query)}}class Ag{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Dg(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Ag(this.firestore,t,this._key)}}class Dg extends kg{constructor(t,e,n){super(t,e,Pl(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Ag(this.firestore,null,new hh(t))}withConverter(t){return new Dg(this.firestore,t,this._path)}}function Ng(t,e,...n){if(t=N(t),function(t,e,n){if(!n)throw new zu(qu.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("collection","path",e),t instanceof Cg){const i=ah.fromString(e,...n);return bg(i),new Dg(t,null,i)}{if(!(t instanceof Ag||t instanceof Dg))throw new zu(qu.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(ah.fromString(e,...n));return bg(i),new Dg(t.firestore,null,i)}}class Rg{constructor(){this.Wa=Promise.resolve(),this.Ga=[],this.za=!1,this.ja=[],this.Ha=null,this.Ja=!1,this.Ya=!1,this.Za=[],this.Ko=new pp(this,"async_queue_retry"),this.Xa=()=>{const t=dp();t&&xu("AsyncQueue","Visibility state changed to "+t.visibilityState),this.Ko.No()};const t=dp();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Xa)}get isShuttingDown(){return this.za}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.eu(),this.tu(t)}enterRestrictedMode(t){if(!this.za){this.za=!0,this.Ya=t||!1;const e=dp();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Xa)}}enqueue(t){if(this.eu(),this.za)return new Promise((()=>{}));const e=new Ku;return this.tu((()=>this.za&&this.Ya?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Ga.push(t),this.nu())))}async nu(){if(0!==this.Ga.length){try{await this.Ga[0](),this.Ga.shift(),this.Ko.reset()}catch(t){if(!vh(t))throw t;xu("AsyncQueue","Operation failed with retryable error: "+t)}this.Ga.length>0&&this.Ko.xo((()=>this.nu()))}}tu(t){const e=this.Wa.then((()=>(this.Ja=!0,t().catch((t=>{this.Ha=t,this.Ja=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw Fu("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.Ja=!1,t))))));return this.Wa=e,e}enqueueAfterDelay(t,e,n){this.eu(),this.Za.indexOf(t)>-1&&(e=0);const i=xp.createAndSchedule(this,t,e,n,(t=>this.ru(t)));return this.ja.push(i),i}eu(){this.Ha&&ju()}verifyOperationInProgress(){}async iu(){let t;do{t=this.Wa,await t}while(t!==this.Wa)}su(t){for(const e of this.ja)if(e.timerId===t)return!0;return!1}ou(t){return this.iu().then((()=>{this.ja.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.ja)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.iu()}))}_u(t){this.Za.push(t)}ru(t){const e=this.ja.indexOf(t);this.ja.splice(e,1)}}class Og extends Cg{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=new Rg,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Pg(this),this._firestoreClient.terminate()}}function Pg(t){var e,n,i;const r=t._freezeSettings(),s=function(t,e,n,i){return new jh(t,e,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,Ig(i.experimentalLongPollingOptions),i.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,r);t._firestoreClient=new gg(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=r.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=r.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:r.localCache.kind,_offline:r.localCache._offlineComponentProvider,_online:r.localCache._onlineComponentProvider})}class Lg{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Lg(Oh.fromBase64String(t))}catch(t){throw new zu(qu.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Lg(Oh.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Mg{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new zu(qu.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new uh(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class xg{constructor(t){this._methodName=t}}class Fg{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new zu(qu.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new zu(qu.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return nh(this._lat,t._lat)||nh(this._long,t._long)}}const Ug=/^__.*__$/;function Vg(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ju()}}class jg{constructor(t,e,n,i,r,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===r&&this.au(),this.fieldTransforms=r||[],this.fieldMask=s||[]}get path(){return this.settings.path}get uu(){return this.settings.uu}cu(t){return new jg(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}lu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.cu({path:n,hu:!1});return i.Pu(t),i}Iu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),i=this.cu({path:n,hu:!1});return i.au(),i}Tu(t){return this.cu({path:void 0,hu:!0})}Eu(t){return Gg(t,this.settings.methodName,this.settings.du||!1,this.path,this.settings.Au)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}au(){if(this.path)for(let t=0;t<this.path.length;t++)this.Pu(this.path.get(t))}Pu(t){if(0===t.length)throw this.Eu("Document fields must not be empty");if(Vg(this.uu)&&Ug.test(t))throw this.Eu('Document fields cannot begin and end with "__"')}}class $g{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||fp(t)}Ru(t,e,n,i=!1){return new jg({uu:t,methodName:e,Au:n,path:uh.emptyPath(),hu:!1,du:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Bg(t){const e=t._freezeSettings(),n=fp(t._databaseId);return new $g(t._databaseId,!!e.ignoreUndefinedProperties,n)}function qg(t,e,n,i=!1){return zg(n,t.Ru(i?4:3,e))}function zg(t,e){if(Kg(t=N(t)))return function(t,e,n){if(!Kg(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const i=Eg(n);throw"an object"===i?e.Eu(t+" a custom object"):e.Eu(t+" "+i)}}("Unsupported field value:",e,t),function(t,e){const n={};return Th(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Eh(t,((t,i)=>{const r=zg(i,e.lu(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}(t,e);if(t instanceof xg)return function(t,e){if(!Vg(e.uu))throw e.Eu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Eu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.hu&&4!==e.uu)throw e.Eu("Nested arrays are not supported");return function(t,e){const n=[];let i=0;for(const r of t){let t=zg(r,e.Tu(i));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),i++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=N(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return cd(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=rh.fromDate(t);return{timestampValue:af(e.serializer,n)}}if(t instanceof rh){const n=new rh(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:af(e.serializer,n)}}if(t instanceof Fg)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Lg)return{bytesValue:cf(e.serializer,t._byteString)};if(t instanceof Ag){const n=e.databaseId,i=t.firestore._databaseId;if(!i.isEqual(n))throw e.Eu(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hf(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Eu(`Unsupported field value: ${Eg(t)}`)}(t,e)}function Kg(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof rh||t instanceof Fg||t instanceof Lg||t instanceof Ag||t instanceof xg)}const Hg=new RegExp("[~\\*/\\[\\]]");function Gg(t,e,n,i,r){const s=i&&!i.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${i}`),o&&(c+=` in document ${r}`),c+=")"),new zu(qu.INVALID_ARGUMENT,a+t+c)}class Wg{constructor(t,e,n,i,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new Ag(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Qg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Jg("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Qg extends Wg{data(){return super.data()}}function Jg(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Hg)>=0)throw Gg(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Mg(...e.split("."))._internalPath}catch(i){throw Gg(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Mg?e._internalPath:e._delegate._internalPath}class Xg{}class Yg extends Xg{}function Zg(t,e,...n){let i=[];e instanceof Xg&&i.push(e),i=i.concat(n),function(t){const e=t.filter((t=>t instanceof nm)).length,n=t.filter((t=>t instanceof tm)).length;if(e>1||e>0&&n>0)throw new zu(qu.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const e of i)t=e._apply(t);return t}class tm extends Yg{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new tm(t,e,n)}_apply(t){const e=this._parse(t);return lm(t._query,e),new kg(t.firestore,t.converter,jl(t._query,e))}_parse(t){const e=Bg(t.firestore),n=function(t,e,n,i,r,s,o){let a;if(r.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new zu(qu.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){hm(o,s);const e=[];for(const n of o)e.push(um(i,t,n));a={arrayValue:{values:e}}}else a=um(i,t,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||hm(o,s),a=qg(n,"where",o,"in"===s||"not-in"===s);return dl.create(r,s,a)}(t._query,0,e,t.firestore._databaseId,this._field,this._op,this._value);return n}}function em(t,e,n){const i=e,r=Jg("where",t);return tm._create(r,i,n)}class nm extends Xg{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new nm(t,e)}_parse(t){const e=this._queryConstraints.map((e=>e._parse(t))).filter((t=>t.getFilters().length>0));return 1===e.length?e[0]:fl.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return 0===e.getFilters().length?t:(function(t,e){let n=t;const i=e.getFlattenedFilters();for(const t of i)lm(n,t),n=jl(n,t)}(t._query,e),new kg(t.firestore,t.converter,jl(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class im extends Yg{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new im(t,e)}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new zu(qu.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new zu(qu.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const i=new ul(e,n);return function(t,e){if(null===Ml(t)){const n=xl(t);null!==n&&dm(0,n,e.field)}}(t,i),i}(t._query,this._field,this._direction);return new kg(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new Ol(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function rm(t,e="asc"){const n=e,i=Jg("orderBy",t);return im._create(i,n)}class sm extends Yg{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new sm(t,e,n)}_apply(t){return new kg(t.firestore,t.converter,$l(t._query,this._limit,this._limitType))}}function om(t){return function(t,e){if(e<=0)throw new zu(qu.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}("limit",t),sm._create("limit",t,"F")}class am extends Yg{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new am(t,e,n)}_apply(t){const e=function(t,e,n,i){if(n[0]=N(n[0]),n[0]instanceof Wg)return function(t,e,n,i,r){if(!i)throw new zu(qu.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const s=[];for(const n of Ul(t))if(n.field.isKeyField())s.push(Jh(e,i.key));else{const t=i.data.field(n.field);if(Fh(t))throw new zu(qu.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new zu(qu.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}s.push(t)}return new ol(s,r)}(t._query,t.firestore._databaseId,e,n[0]._document,i);{const r=Bg(t.firestore);return function(t,e,n,i,r,s){const o=t.explicitOrderBy;if(r.length>o.length)throw new zu(qu.INVALID_ARGUMENT,`Too many arguments provided to ${i}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let s=0;s<r.length;s++){const c=r[s];if(o[s].field.isKeyField()){if("string"!=typeof c)throw new zu(qu.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${i}(), but got a ${typeof c}`);if(!Fl(t)&&-1!==c.indexOf("/"))throw new zu(qu.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${i}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(ah.fromString(c));if(!hh.isDocumentKey(n))throw new zu(qu.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${i}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new hh(n);a.push(Jh(e,r))}else{const t=qg(n,i,c);a.push(t)}}return new ol(a,s)}(t._query,t.firestore._databaseId,r,e,n,i)}}(t,this.type,this._docOrFields,this._inclusive);return new kg(t.firestore,t.converter,function(t,e){return new Ol(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function cm(...t){return am._create("startAfter",t,!1)}function um(t,e,n){if("string"==typeof(n=N(n))){if(""===n)throw new zu(qu.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Fl(e)&&-1!==n.indexOf("/"))throw new zu(qu.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(ah.fromString(n));if(!hh.isDocumentKey(i))throw new zu(qu.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Jh(t,new hh(i))}if(n instanceof Ag)return Jh(t,n._key);throw new zu(qu.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Eg(n)}.`)}function hm(t,e){if(!Array.isArray(t)||0===t.length)throw new zu(qu.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function lm(t,e){if(e.isInequality()){const n=xl(t),i=e.field;if(null!==n&&!n.isEqual(i))throw new zu(qu.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${i.toString()}'`);const r=Ml(t);null!==r&&dm(0,i,r)}const n=function(t,e){for(const n of t)for(const t of n.getFlattenedFilters())if(e.indexOf(t.op)>=0)return t.op;return null}(t.filters,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new zu(qu.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new zu(qu.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function dm(t,e,n){if(!n.isEqual(e))throw new zu(qu.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class fm{convertValue(t,e="none"){switch(qh(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Mh(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(xh(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw ju()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Eh(t,((t,i)=>{n[t]=this.convertValue(i,e)})),n}convertGeoPoint(t){return new Fg(Mh(t.latitude),Mh(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Uh(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Vh(t));default:return null}}convertTimestamp(t){const e=Lh(t);return new rh(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ah.fromString(t);$u(Cf(n));const i=new $h(n.get(1),n.get(3)),r=new hh(n.popFirst(5));return i.isEqual(e)||Fu(`Document ${r} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}class pm{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class gm extends Wg{constructor(t,e,n,i,r,s){super(t,e,n,i,s),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new mm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Jg("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class mm extends gm{data(t={}){return super.data(t)}}class ym{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new pm(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new mm(this._firestore,this._userDataWriter,n.key,n,new pm(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new zu(qu.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>{const i=new mm(t._firestore,t._userDataWriter,n.doc.key,n.doc,new pm(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:e++}}))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const i=new mm(t._firestore,t._userDataWriter,e.doc.key,e.doc,new pm(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,s=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:vm(e.type),doc:i,oldIndex:r,newIndex:s}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function vm(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ju()}}class wm extends fm{constructor(t){super(),this.firestore=t}convertBytes(t){return new Lg(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Ag(this.firestore,null,e)}}function Im(t){t=Tg(t,kg);const e=Tg(t.firestore,Og),n=function(t){return t._firestoreClient||Pg(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),i=new wm(e);return function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new zu(qu.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query),wg(n,t._query).then((n=>new ym(e,i,t,n)))}!function(t,e=!0){!function(t){Pu=t}(wt),gt(new R("firestore",((t,{instanceIdentifier:n,options:i})=>{const r=t.getProvider("app").getImmediate(),s=new Og(new Qu(t.getProvider("auth-internal")),new Zu(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new zu(qu.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $h(t.options.projectId,e)}(r,n),r);return i=Object.assign({useFetchStreams:e},i),s._setSettings(i),s}),"PUBLIC").setMultipleInstances(!0)),bt(Ru,"4.1.0",t),bt(Ru,"4.1.0","esm2017")}();class _m extends Date{constructor(...t){super(...t)}toFormat(t){const e={S:this.getMilliseconds().toString(),SSS:this.getMilliseconds().toString().padStart(3,"0"),s:this.getSeconds().toString(),ss:this.getSeconds().toString().padStart(2,"0"),m:this.getMinutes().toString(),mm:this.getMinutes().toString().padStart(2,"0"),h:(this.getHours()%12||12).toString(),hh:(this.getHours()%12||12).toString().padStart(2,"0"),H:this.getHours().toString(),HH:this.getHours().toString().padStart(2,"0"),a:this.getHours()<12?"am":"pm",A:this.getHours()<12?"AM":"PM",d:this.getDate().toString(),dd:this.getDate().toString().padStart(2,"0"),ddd:1===this.getDate()?this.getDate().toString()+"st":2===this.getDate()?this.getDate().toString()+"nd":3===this.getDate()?this.getDate().toString()+"rd":21===this.getDate()?this.getDate().toString()+"st":22===this.getDate()?this.getDate().toString()+"nd":23===this.getDate()?this.getDate().toString()+"rd":31===this.getDate()?this.getDate().toString()+"st":this.getDate().toString()+"th",o:this.getDayOfYear().toString(),ooo:this.getDayOfYear().toString().padStart(3,"0"),E:(this.getDay()%7||7).toString(),EEE:this.toLocaleString("default",{weekday:"short"}),EEEE:this.toLocaleString("default",{weekday:"long"}),EEEEE:this.toLocaleString("default",{weekday:"narrow"}),W:this.getWeek().toString(),WW:this.getWeek().toString().padStart(2,"0"),M:(this.getMonth()+1).toString(),MM:(this.getMonth()+1).toString().padStart(2,"0"),MMM:this.toLocaleString("default",{month:"short"}),MMMM:this.toLocaleString("default",{month:"long"}),MMMMM:this.toLocaleString("default",{month:"narrow"}),y:this.getFullYear().toString(),yy:this.getFullYear().toString().slice(-2),yyyy:this.getFullYear().toString().padStart(4,"0")},n=t.split("{").flatMap((t=>t.split("}")));for(let t=1;t<n.length;t+=2)n[t]=e[n[t]];return n.join("")}getWeek(){var t=new Date(this.valueOf()),e=(this.getDay()+6)%7;t.setDate(t.getDate()-e+3);var n=t.valueOf();return t.setMonth(0,1),4!=t.getDay()&&t.setMonth(0,1+(4-t.getDay()+7)%7),1+Math.ceil((n-t)/6048e5)}getDayOfYear(){var t=new Date(this.getFullYear(),0,1);return Math.ceil((this-t)/864e5)}}const bm=10,Em=function(t,e){const n="string"==typeof t?t:"(default)",i=mt("object"==typeof t?t:_t(),"firestore").getImmediate({identifier:n});if(!i._initialized){const t=(t=>{const e=a("firestore");if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),i]:[e.substring(0,n),i]})();t&&function(t,e,n,i={}){var s;const o=(t=Tg(t,Cg))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==o.host&&o.host!==a&&Uu("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},o),{host:a,ssl:!1})),i.mockUserToken){let e,n;if("string"==typeof i.mockUserToken)e=i.mockUserToken,n=Ou.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[r(JSON.stringify({alg:"none",type:"JWT"})),r(JSON.stringify(o)),""].join(".")}(i.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=i.mockUserToken.sub||i.mockUserToken.user_id;if(!o)throw new zu(qu.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Ou(o)}t._authCredentials=new Wu(new Hu(e,n))}}(i,...t)}return i}(gn);let Tm,Sm;async function Cm(t){let e=t.split(" ")[0],n=t.split(" ")[1];if(e&&(e=km(e)),n&&(n=km(n)),e&&!n)try{const[t,n,i]=await Promise.all([{docs:[]},Im(Zg(Ng(Em,"Users"),em("firstName",">=",e),em("firstName","<=",e+""),rm("firstName"))),Im(Zg(Ng(Em,"Users"),em("lastName",">=",e),em("lastName","<=",e+""),rm("lastName")))]),r=[];return t.docs.forEach((t=>{const e=t.data();r.push({text:`${e.email} (${e.role})`,value:`${t.id}:${e.role}`})})),n.docs.forEach((t=>{const e=t.data();r.push({text:`${e.firstName} ${e.lastName} (${e.role})`,value:`${t.id}:${e.role}`})})),i.docs.forEach((t=>{const e=t.data();r.push({text:`${e.firstName} ${e.lastName} (${e.role})`,value:`${t.id}:${e.role}`})})),r}catch(t){return console.log(t),[]}else if(e&&n)try{const t=Zg(Ng(Em,"Users"),em("firstName","==",e),em("lastName",">=",n),em("lastName","<=",n+""),rm("lastName")),i=await Im(t),r=[];return i.docs.forEach((t=>{const e=t.data();r.push({text:`${e.firstName} ${e.lastName} (${e.role})`,value:`${t.id}:${e.role}`})})),r}catch(t){return console.log(t),[]}}function km(t){return t.charAt(0).toUpperCase()+t.slice(1).toLowerCase()}function Am(t){const[e,n]=t.split(":");switch(n){case"tutor":window.location.href=`/test-taker/${e}`;break;case"student":window.location.href=`/student-overview/${e}`}}async function Dm(){const t=Zg(Ng(Em,"Users"),rm("createdAt"),cm(Tm),om(11));let e=(await Im(t)).docs.toReversed();const n=11==e.length;e=e.slice(0,bm),Tm=e[0],Sm=e[e.length-1],Rm(e,n,!0)}async function Nm(){const t=Zg(Ng(Em,"Users"),rm("createdAt","desc"),cm(Sm),om(11));let e=(await Im(t)).docs;const n=11==e.length;e=e.slice(0,bm),Tm=e[0],Sm=e[e.length-1],Rm(e,!0,n)}function Rm(t,e=!0,n=!0){const i=document.getElementById("latestPrevious"),r=document.getElementById("latestNext"),s=document.getElementById("latestUsers");for(e?i.classList.remove("hidden"):i.classList.add("hidden"),n?r.classList.remove("hidden"):r.classList.add("hidden");s.firstChild;)s.removeChild(s.firstChild);const o=document.createElement("div");o.textContent="Name",o.className="grid-header",s.appendChild(o);const a=document.createElement("div");a.textContent="Created At",a.className="grid-header",s.appendChild(a),t.forEach((t=>{const e=t.data(),n=document.createElement("div");n.textContent=e.firstName+" "+e.lastName,s.appendChild(n);const i=document.createElement("div");i.textContent=new _m(e.createdAt.toDate()).toFormat("{MMMM} {ddd}, {yyyy} at {hh}:{mm} {A}"),s.appendChild(i)}))}document.addEventListener("DOMContentLoaded",(async function(){const t=document.getElementById("userSearch");t.minChars=3,t.onInput=Cm,t.onChange=Am,document.getElementById("latestPrevious").addEventListener("click",Dm),document.getElementById("latestNext").addEventListener("click",Nm),async function(){let t=(await Im(Zg(Ng(Em,"Users"),rm("createdAt","desc"),om(11)))).docs;const e=11==t.length;t=t.slice(0,bm),Tm=t[0],Sm=t[t.length-1],Rm(t,!1,e)}(),async function(){const t=(new Date).getHours(),e=(await new Promise((t=>{Gi(is,(e=>{t(e)}))}))).displayName;let n;n=t>=0&&t<6?`Go to bed, ${e}`:t>=6&&t<12?`Good morning, ${e}`:t>=12&&t<18?`Good afternoon, ${e}`:`Good evening, ${e}`,document.getElementById("salutation").textContent=n}()})),window.signOut=ls})();